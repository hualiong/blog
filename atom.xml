<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://hualiang.online</id>
    <title>Hualiang&apos;s Blog</title>
    <updated>2025-11-03T08:52:24.734Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://hualiang.online"/>
    <link rel="self" href="https://hualiang.online/atom.xml"/>
    <subtitle>&lt;i&gt;Unless I don&apos;t want to win, nobody can make me lose.&lt;/i&gt;&lt;br/&gt;&lt;br/&gt;I always believe å¤©é“é…¬å‹¤</subtitle>
    <logo>https://hualiang.online/images/avatar.png</logo>
    <icon>https://hualiang.online/favicon.ico</icon>
    <rights>All rights reserved 2025, Hualiang&apos;s Blog</rights>
    <entry>
        <title type="html"><![CDATA[Succinct Trie - åŸºäº LOUDS ç¼–ç çš„å‹ç¼©å­—å…¸æ ‘]]></title>
        <id>https://hualiang.online/post/java-shi-xian-ji-yu-louds-bian-ma-de-ya-suo-qian-zhui-shu/</id>
        <link href="https://hualiang.online/post/java-shi-xian-ji-yu-louds-bian-ma-de-ya-suo-qian-zhui-shu/">
        </link>
        <updated>2025-08-27T15:54:39.000Z</updated>
        <summary type="html"><![CDATA[<p>æœ€è¿‘åœ¨å­¦ä¹  ElasticSearch çš„ <strong>FST</strong> ç»“æ„å‘ç°ï¼Œè™½ç„¶å®ƒå‹ç¼©äº†å‰åç¼€å¯ä»¥è®©å ç”¨ç©ºé—´æå¤§ç¼©å°ï¼Œä½†ä¾ç„¶æœ‰å¯¹è±¡å¤´å’ŒæŒ‡é’ˆçš„å¼€é”€ï¼Œå¦‚æœèƒ½æŠŠè¿™éƒ¨åˆ†å¼€é”€å»æ‰ï¼Œå‹ç¼©ç‡è¿˜èƒ½å†ä¸Šä¸€å±‚æ¥¼ã€‚äºæ˜¯ç»è¿‡è°ƒç ”å‘ç°ä¸€ç§å«â€œ<strong>ç®€æ´æ•°æ®ç»“æ„</strong>â€ï¼ˆSuccinct Data Structureï¼‰çš„ä¸œè¥¿ï¼Œå®ƒåœ¨å ç”¨<strong>æå°ç©ºé—´</strong>ä¸‹è¿˜èƒ½æä¾›<strong>é«˜æ•ˆæŸ¥è¯¢</strong>æ“ä½œã€‚å¯¹æ­¤æ¯”è¾ƒå¥½å¥‡å®ƒçš„å®ç°åŸç†ï¼Œé‚æ·±å…¥æ¢ç´¢ï¼Œæƒ³ç”¨ Java å®ç°ä¸€ä¸ªæ¯” FST å ç”¨æ›´å°çš„ Trie ç»“æ„ï¼Œäºæ˜¯å°±æœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚</p>
<p><em>p.s. éƒ¨åˆ†å‚è€ƒå›¾å’Œä»£ç æºè‡ªã€Š<a href="https://blog.csdn.net/u014470403/article/details/147883426">åŸºäº LOUDS çš„ Succinct Set è¯¦è§£</a>ã€‹</em></p>
]]></summary>
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å­¦ä¹  ElasticSearch çš„ <strong>FST</strong> ç»“æ„å‘ç°ï¼Œè™½ç„¶å®ƒå‹ç¼©äº†å‰åç¼€å¯ä»¥è®©å ç”¨ç©ºé—´æå¤§ç¼©å°ï¼Œä½†ä¾ç„¶æœ‰å¯¹è±¡å¤´å’ŒæŒ‡é’ˆçš„å¼€é”€ï¼Œå¦‚æœèƒ½æŠŠè¿™éƒ¨åˆ†å¼€é”€å»æ‰ï¼Œå‹ç¼©ç‡è¿˜èƒ½å†ä¸Šä¸€å±‚æ¥¼ã€‚äºæ˜¯ç»è¿‡è°ƒç ”å‘ç°ä¸€ç§å«â€œ<strong>ç®€æ´æ•°æ®ç»“æ„</strong>â€ï¼ˆSuccinct Data Structureï¼‰çš„ä¸œè¥¿ï¼Œå®ƒåœ¨å ç”¨<strong>æå°ç©ºé—´</strong>ä¸‹è¿˜èƒ½æä¾›<strong>é«˜æ•ˆæŸ¥è¯¢</strong>æ“ä½œã€‚å¯¹æ­¤æ¯”è¾ƒå¥½å¥‡å®ƒçš„å®ç°åŸç†ï¼Œé‚æ·±å…¥æ¢ç´¢ï¼Œæƒ³ç”¨ Java å®ç°ä¸€ä¸ªæ¯” FST å ç”¨æ›´å°çš„ Trie ç»“æ„ï¼Œäºæ˜¯å°±æœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚</p>
<p><em>p.s. éƒ¨åˆ†å‚è€ƒå›¾å’Œä»£ç æºè‡ªã€Š<a href="https://blog.csdn.net/u014470403/article/details/147883426">åŸºäº LOUDS çš„ Succinct Set è¯¦è§£</a>ã€‹</em></p>
<!-- more -->
<h2 id="ç®€ä»‹">ç®€ä»‹</h2>
<p><strong>ä»€ä¹ˆæ˜¯ Succinct æ•°æ®ç»“æ„ï¼Ÿ</strong></p>
<p>ç®€æ´æ•°æ®ç»“æ„ï¼ˆSuccinct Data Structuresï¼‰æ˜¯æŒ‡ä¸€ç±»åœ¨å­˜å‚¨æ•°æ®æ—¶æ¥è¿‘ä¿¡æ¯ç†µä¸‹ç•Œï¼ŒåŒæ—¶ä¿æŒé«˜æ•ˆæŸ¥è¯¢æ€§èƒ½çš„æ•°æ®ç»“æ„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªç»“æ„è¡¨ç¤ºçš„æ‰€å ç©ºé—´<strong>æ¥è¿‘</strong>ä¿¡æ¯ç†µä¸‹é™ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç§°å…¶ä¸ºâ€œç®€æ´çš„â€ã€‚å…¶æ ¸å¿ƒåŸç†å°±æ˜¯ä½¿ç”¨ Bitmap æ¥è¡¨ç¤ºæ•°æ®ç»“æ„ä»¥èŠ‚çœå¤§é‡ç©ºé—´ã€‚</p>
<p>Succinct æ€æƒ³å¸¸è¢«åº”ç”¨äºå¯¹<strong>åˆ—è¡¨</strong>å’Œ<strong>æ ‘</strong>çš„å­˜å‚¨ä»¥å‹ç¼©ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯ â€œSuccinct Vectorâ€ å’Œ â€œ<strong>Succinct Tree</strong>â€</p>
<p>ä¸€äº›å¸¸è§çš„ç®€æ´æ•°æ®ç»“æ„å®ç°åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>å°æ³¢æ ‘</strong>ï¼šåœ¨å‹ç¼©çš„åºåˆ—ä¸Šæ”¯æŒä¸°å¯Œçš„<strong>åºåˆ—æŸ¥è¯¢</strong>æ“ä½œï¼Œå¦‚ç¬¬kå°æŸ¥è¯¢ï¼ŒåŒºé—´ç»Ÿè®¡</li>
<li><strong>FM-Index</strong>ï¼šåœ¨ä¸€ä¸ªå‹ç¼©åçš„æ–‡æœ¬ç´¢å¼•ä¸­ï¼Œæå¿«åœ°æŸ¥æ‰¾ä¸€ä¸ªæ¨¡å¼ä¸² P å‡ºç°çš„æ‰€æœ‰ä½ç½®ï¼ˆå…¨æ–‡ç´¢å¼•ï¼‰</li>
<li><strong>ç®€æ´æ ‘</strong>ï¼šç”¨æå°çš„ç©ºé—´å­˜å‚¨<strong>æ ‘ç»“æ„</strong>ï¼Œå¹¶æ”¯æŒé«˜æ•ˆçš„åŸºç¡€<strong>å¯¼èˆªæ“ä½œ</strong></li>
<li><strong>ç®€æ´å›¾</strong>ï¼šåŸºäº<strong>é‚»æ¥è¡¨</strong>çš„ç®€æ´è¡¨ç¤ºï¼Œä»¥æå°ç©ºé—´å ç”¨æ”¯æŒå›¾çš„å„ç§åŸºæœ¬æ“ä½œ</li>
<li><strong>ç®€æ´å‘é‡</strong>ï¼šå°±æ˜¯ç®€æ´æ•°ç»„ï¼Œæ¯”ä¸€èˆ¬çš„åŸºæœ¬æ•°æ®ç±»å‹æ•°ç»„è¿˜è¦å°</li>
</ul>
<h2 id="åŸç†">åŸç†</h2>
<blockquote>
<p><strong>Succinct Trie</strong> = Succinct Tree + Trie Label</p>
</blockquote>
<p>å› ä¸ºæˆ‘æ¢ç´¢çš„ä¸»è¦æ˜¯å¦‚ä½•è®© FST æ›´çœç©ºé—´ï¼ŒFST æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸ª Trie æ ‘ï¼Œå°±æ‰“ç®—ä» Trie å‡ºå‘ï¼Œç»“åˆä¸Šæ–‡ç®€ä»‹ä¸­è¯´åˆ°çš„ â€œSuccinct Treeâ€ï¼Œæ¢ç´¢èƒ½å¦å°† Trie æ ‘å’Œ Succinct Tree ç»“åˆåœ¨ä¸€èµ·ã€‚å½“ç„¶ï¼Œæœ€ç»ˆç»“æœå½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œå·²ç»æœ‰å¾ˆå¤šç¯‡æ–‡ç« å®ç°äº†ã€‚å› æ­¤æ¥ä¸‹æ¥æˆ‘å°†ä»æ ¸å¿ƒåŸç†å¼€å§‹è®²èµ·ï¼Œä¸€æ­¥æ­¥å»å®ç°ä¸€ä¸ªå ç”¨æå°ç©ºé—´åˆèƒ½é«˜æ•ˆæŸ¥è¯¢çš„ <strong>Succinct Trie</strong></p>
<h3 id="ç¼–ç ">ç¼–ç </h3>
<p>ç»“åˆç®€æ´æ•°æ®ç»“æ„çš„æ ¸å¿ƒæ€æƒ³ï¼Œæˆ‘ä»¬ä¸éš¾æ¨æµ‹ï¼šSuccinct Trie æ ¸å¿ƒåŸç†æ˜¯ä½¿ç”¨ <strong>Bitmap</strong> æ¥è¡¨ç¤º Trie æ ‘ç»“æ„ï¼Œå› æ­¤æˆ‘ä»¬å…ˆè¦å°†<strong>æ ‘ç»“æ„</strong>ç¼–ç æˆ <strong>bit åºåˆ—</strong></p>
<p>ç›®å‰æœ‰ä¸¤ç§ä¸»æµç¼–ç æ–¹å¼ï¼ŒDFOUS æ”¯æŒæ›´å¤šçš„åŠŸèƒ½ï¼ŒLOUDS æœ‰æ›´å¿«çš„æ€§èƒ½ï¼š</p>
<ul>
<li><strong>LOUDS</strong>ï¼šæŒ‰ BFS éå†æ ‘ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œç”¨ä¸€å…ƒç¼–ç ï¼ˆä¸€ä¸² 1 åŠ ä¸€ä¸ª 0ï¼‰è¡¨ç¤ºå®ƒçš„åº¦æ•°ã€‚é€‚ç”¨äº<strong>åº¦æ•°å¤§ã€æ·±åº¦æµ…</strong>çš„æ ‘ï¼Œå¦‚ <strong>Trie</strong> <strong>æ ‘</strong></li>
<li><strong>DFUDS</strong>ï¼šæŒ‰ DFS éå†æ ‘ï¼Œå¯¹æ¯ä¸ªæœ‰ d ä¸ªå­èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œç”¨ä¸€ä¸ª â€œ<strong>(</strong>â€ å’Œ d ä¸ª â€œ<strong>)</strong>â€ æ¥è¡¨ç¤ºï¼Œä½†æ•´ä¸ªåºåˆ—ç”¨é¢å¤–çš„ â€œ<strong>(</strong>â€œ å¼€å¤´ä»¥ä¿è¯å¹³è¡¡ã€‚å¯ä»¥ç†è§£ä¸ºç‰¹æ®Šçš„æ‹¬å·åºåˆ—ï¼Œç¼–ç æ—¶ â€œ<strong>(</strong>â€ ä¸º 1ï¼Œâ€œ<strong>)</strong>â€ ä¸º 0ã€‚é€‚ç”¨äºè¦æ·±åº¦ä¼˜å…ˆéå†çš„åœºæ™¯ï¼Œå¦‚<strong>è¯­æ³•åˆ†ææ ‘ã€DOM æ ‘</strong></li>
</ul>
<p>å› ä¸ºæˆ‘ä»¬çš„ç›®æ ‡åœ¨ Trie æ ‘ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä¸»è¦æ¢è®¨ LOUDS ç¼–ç æ–¹å¼</p>
<hr>
<p><strong>ä»€ä¹ˆæ˜¯ LOUDS ç¼–ç ï¼Ÿ</strong></p>
<p><strong>L</strong>evel-<strong>O</strong>rder <strong>U</strong>nary <strong>D</strong>egree <strong>S</strong>equenceï¼Œå±‚åºä¸€å…ƒåº¦åºåˆ—ï¼Œç®€ç§° LOUDSã€‚å¬èµ·æ¥é«˜å¤§ä¸Šï¼Œå®é™…å†…å®¹éå¸¸ç®€å•</p>
<p>ä»¥ä¸‹å›¾è¿™ä¸€é¢— Trie æ ‘ä¸ºä¾‹ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œç”¨ <code>0</code> è¡¨ç¤ºå­èŠ‚ç‚¹ï¼Œ<code>1</code> è¡¨ç¤ºç»“æŸã€‚æ¯”å¦‚ï¼ŒèŠ‚ç‚¹ 1 æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºæˆ <code>001</code>ã€‚ æœ€ç»ˆæŒ‰ç…§ BFS é¡ºåºæŠŠæ‰€æœ‰ç¼–ç æ’åˆ—ä¸€èµ·å°±æ˜¯è¿™æ£µæ ‘çš„ LOUDS ç¼–ç </p>
<p>ç»¼ä¸Šï¼Œè¯¥æ ‘çš„ LOUDS ç¼–ç ä¸º <code>001 001 01 01 01 01 01 1 1 1</code></p>
<figure data-type="image" tabindex="1"><img src="https://hualiang.online/post-images/1757527679745.png" alt="å›¾ä¸€" loading="lazy"></figure>
<p><em>æ³¨ 1ï¼šèŠ‚ç‚¹æ ‡ç­¾ï¼Œå³å›¾ä¸­èŠ‚ç‚¹é—´è¾¹ä¸Šçš„é‚£äº›å­—ç¬¦ï¼Œæœ¬èº«å¹¶ä¸å±äºæ ‘ç»“æ„çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥éœ€è¦å¦å¤–ä½¿ç”¨ä¸€ä¸ªæ•°ç»„ <code>labels</code> å­˜å‚¨</em></p>
<p><em>æ³¨ 2ï¼šåŸè®ºæ–‡ä¸­çš„æ ‡å‡†å½¢å¼åº”è¯¥æ˜¯ç”¨ <strong>1</strong> è¡¨ç¤ºå­èŠ‚ç‚¹ï¼Œ<strong>0</strong> è¡¨ç¤ºç»“æŸ</em></p>
<h3 id="å¯¼èˆª">å¯¼èˆª</h3>
<p>ç°åœ¨æˆ‘ä»¬æŠŠä¸€ä¸ª Trie æ ‘å‹æˆä¸€ä¸² bit åºåˆ—è£…è¿›ä½å›¾é‡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å¦‚ä½•ä»è¿™ä¸€å¨åºåˆ—ä¸­è¿˜åŸå‡º Trie æ ‘å‘¢ï¼Ÿæˆ–è€…è¯´æˆ‘ä»¬å¦‚ä½•åœ¨è¿™ä¸€å¨è¢«å‹ç¼©çš„ Trie æ ‘ä¸­è¿›è¡Œå¯¼èˆªæ“ä½œï¼Ÿ</p>
<p>è¿™æ—¶å€™å°±éœ€è¦é¢å¤–å®šä¹‰<strong>å››ä¸ªè¾…åŠ©æ–¹æ³•</strong>æ¥æ“ä½œï¼š</p>
<p><code>rank1(pos)</code>ï¼šè¿”å›ä½å›¾ <code>[0, pos]</code> ä¸‹æ ‡èŒƒå›´å†… <code>1</code> çš„ä¸ªæ•°ï¼›<code>rank0</code> åˆ™æ˜¯ <code>0</code> çš„ä¸ªæ•°</p>
<p><code>select1(k)</code>ï¼šè¿”å›ä½å›¾é‡Œç¬¬ <code>k</code> ä¸ª <code>1</code> çš„ä¸‹æ ‡ä½ç½®ï¼›<code>select0</code> åˆ™æ˜¯ <code>0</code> çš„ä½ç½®</p>
<p>å®é™…è¿›è¡Œå¯¼èˆªä¸­ä¼šé¢‘ç¹è°ƒç”¨è¿™å‡ ä¸ªæ–¹æ³•ï¼Œå› æ­¤ä¸ºäº†æé«˜æ€§èƒ½ï¼Œæˆ‘ä»¬ä¼š<strong>é¢„è®¡ç®—</strong>è¿™äº›æ–¹æ³•çš„å€¼</p>
<hr>
<p>æˆ‘ä»¬ç”¨ä¸Šæ–‡å›¾ä¸€çš„ Trie æ ‘æ¥å±•ç¤ºå¦‚ä½•é€šè¿‡è¿™å››ä¸ªæ–¹æ³•æ¥åœ¨æ ‘èŠ‚ç‚¹ä¹‹é—´éšæ„è½¬ç§»</p>
<figure data-type="image" tabindex="2"><img src="https://hualiang.online/post-images/1757527757315.png" alt="å›¾äºŒ" loading="lazy"></figure>
<p>ä¸Šå›¾æ˜¯è¯¥ Trie æ ‘ç»è¿‡ LOUDS ç¼–ç å‡ºçš„ <strong>bit åºåˆ—ä¸å…¶æºèŠ‚ç‚¹çš„å¯¹åº”å…³ç³»</strong>ï¼Œå¯ä»¥å¸®åŠ©ç†è§£</p>
<p>ä»¥<strong>èŠ‚ç‚¹</strong> <strong>1</strong> ä¸ºä¾‹ï¼Œå®ƒçš„å­èŠ‚ç‚¹æ˜¯ <strong>3</strong>ã€<strong>4</strong>ï¼Œçˆ¶èŠ‚ç‚¹æ˜¯ <strong>0</strong>ï¼Œé‚£ä¹ˆï¼š</p>
<ul>
<li>èŠ‚ç‚¹ 1 èµ·å§‹ bit ä½ç½® = <code>select1(1)</code> + <code>1</code> = <code>3</code></li>
<li>èŠ‚ç‚¹ 1 ç¬¬ä¸€å­èŠ‚ç‚¹ç¼–å· = <code>rank0(3 + 0)</code> = <code>3</code></li>
<li>èŠ‚ç‚¹ 1 ç¬¬äºŒå­èŠ‚ç‚¹ç¼–å· = <code>rank0(3 + 1)</code> = <code>4</code></li>
<li>èŠ‚ç‚¹ 1 çš„çˆ¶èŠ‚ç‚¹èµ·å§‹ bit ä½ç½® = <code>select0(1)</code> = <code>0</code>ï¼Œçˆ¶èŠ‚ç‚¹ç¼–å· = <code>rank1(select0(1))</code> = <code>rank1(0)</code> = <code>0</code></li>
<li>å¦‚æœçŸ¥é“<strong>å½“å‰èŠ‚ç‚¹ç¼–ç </strong>å’Œ<strong>å½“å‰ bit ä½ç½®</strong>ï¼Œé‚£ä¹ˆ<strong>å½“å‰èŠ‚ç‚¹æ ‡ç­¾</strong> = <code>labels[index - nodeId]</code></li>
</ul>
<p>ä»¥ä¸Šæ“ä½œè¯´æ˜å¦‚ä½•ä»èŠ‚ç‚¹ 1 å‘ä¸Šï¼ˆå›æº¯ï¼‰å’Œå‘ä¸‹ï¼ˆé€’å½’ï¼‰ä¸¤ä¸ªæ–¹å‘çš„å¯¼èˆªï¼Œå¹¶ä¸”å±•ç¤ºäº†å½“è·å–åˆ°<strong>å½“å‰èŠ‚ç‚¹ç¼–ç </strong>å’Œ<strong>å½“å‰ bit ä½ç½®</strong>ï¼Œå¦‚ä½•è·å–<strong>å½“å‰èŠ‚ç‚¹æ ‡ç­¾</strong>ã€‚æ—¢ç„¶ä¸Šä¸‹èŠ‚ç‚¹éƒ½èƒ½éå†ï¼Œé‚£éå†æ•´æ£µæ ‘è‡ªç„¶ä¸åœ¨è¯ä¸‹</p>
<h2 id="å®ç°">å®ç°</h2>
<p>æˆ‘ä»¬åœ¨ä¸Šæ–‡å·²ç»ç®€å•è®²è§£äº† Succinct Trie çš„å‹ç¼©æ–¹å¼ï¼ˆç¼–ç ï¼‰å’Œéå†æ–¹æ³•ï¼ˆå¯¼èˆªï¼‰ï¼Œè¯´ç™½äº†å°±æ˜¯é€šè¿‡ä¸€ç§ç²¾å¿ƒè®¾è®¡è¿‡çš„ç¼–ç æ–¹å¼å°†æ ‘å‹ç»“æ„çš„èŠ‚ç‚¹ä¿¡æ¯å­˜å‚¨åˆ° bit åºåˆ—ä¸­ï¼Œç„¶åé€šè¿‡å››ä¸ªè¾…åŠ©æ–¹æ³•æå–è¿™äº›ä¿¡æ¯ç›´æ¥è®¡ç®—å‡ºåŸå§‹ä¿¡æ¯ï¼Œç†è§£åå…¶å®ä¹Ÿæ²¡é‚£ä¹ˆéš¾</p>
<p>ä¸‹é¢æ˜¯ç”¨ Java ç®€å•å®ç°çš„ä¸€ä¸ªåŸºäº LOUDS ç¼–ç çš„é™æ€å‹ç¼© Trie æ ‘ï¼ŒæŒ‰ç…§ç®€æ´æ•°æ®ç»“æ„çš„åˆ†ç±»ï¼Œå¯ä»¥è¢«ç§°ä¸º <strong>Succinct Trie</strong>ã€‚è¯¥å®ç°æ— ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œåˆ›å»ºåä¸å¯æ›´æ”¹ç»“æ„ï¼Œç†è®ºä¸Šæ”¯æŒå„ç§å‰ç¼€æ ‘ç‰¹æ€§ï¼Œç›®å‰åªå®ç°ä¸€äº›ä¸»è¦åŠŸèƒ½ï¼š</p>
<ul>
<li><code>boolean contains(String key)</code>ï¼šåˆ¤æ–­ key æ˜¯å¦å­˜åœ¨</li>
<li><code>int index(String key)</code>ï¼šè‹¥ key å­˜åœ¨ï¼Œåˆ™ä¼šè¿”å›å†…éƒ¨å¯¹åº”çš„èŠ‚ç‚¹ IDï¼›å¦åˆ™ï¼Œè¿”å› -1</li>
<li><code>String get(int nodeId)</code>ï¼šé€šè¿‡ç»™å®šèŠ‚ç‚¹ ID åå‘æœç´¢ key</li>
<li><code>Iterator&lt;String&gt; iterator(boolean orderly)</code>ï¼šä»¥å­—å…¸åºæˆ–å±‚åºçš„é¡ºåºéå† Trie ä¸­æ‰€æœ‰çš„ key</li>
<li><code>Iterator&lt;String&gt; prefixKeysOf(String str)</code>ï¼šæŸ¥è¯¢ç»™å®šå­—ç¬¦ä¸²åœ¨ Trie å†…æ‰€æœ‰çš„å‰ç¼€</li>
<li><code>Iterator&lt;String&gt; prefixSearch(String prefix)</code>ï¼šæŸ¥è¯¢æ‰€æœ‰ä»¥ç»™å®šå‰ç¼€å¼€å¤´çš„ key</li>
</ul>
<pre><code class="language-java">import java.nio.CharBuffer;
import java.util.*;

public class SuccinctTrie {
    private final char[] labels;         // å­˜å‚¨ Trie æ ‘çš„å­—ç¬¦æ ‡ç­¾
    private final BitVector labelBitmap; // å­˜å‚¨ LOUDS ç¼–ç çš„ä½å‘é‡
    private final BitVector isLeaf;      // å­˜å‚¨æ‰€æœ‰å¶å­èŠ‚ç‚¹æ ‡è®°çš„ä½å‘é‡

    public static SuccinctTrie of(String... keys) {
        return new SuccinctTrie(keys);
    }

    private SuccinctTrie(String[] keys) {
        for (int i = 1; i &lt; keys.length; i++) {
            assert keys[i].compareTo(keys[i - 1]) &gt;= 0 : &quot;The inputs are not ordered!&quot;;
        }
        List&lt;Character&gt; labelsList = new ArrayList&lt;&gt;();
        BitVector.Builder labelBitmapBuilder = new BitVector.Builder();
        BitVector.Builder isLeafBuilder = new BitVector.Builder();

        Queue&lt;Range&gt; queue = new ArrayDeque&lt;&gt;();
        queue.add(new Range(0, keys.length, 0));
        int bitPos = 0, nodeId = 0;
        while (!queue.isEmpty()) {
            Range range = queue.poll();
            int L = range.L, R = range.R, index = range.index;
            isLeafBuilder.set(nodeId, keys[L].length() == index);
            // å¤„ç†å­èŠ‚ç‚¹
            int start = L;
            while (start &lt; R) {
                // è·³è¿‡é•¿åº¦ä¸è¶³çš„é”®
                if (keys[start].length() &lt;= index) {
                    start++;
                    continue;
                }
                char currentChar = keys[start].charAt(index);
                int end = start + 1;
                while (end &lt; R) {
                    if (keys[end].length() &lt;= index || keys[end].charAt(index) != currentChar) {
                        break;
                    }
                    end++;
                }
                // æ·»åŠ å­èŠ‚ç‚¹æ ‡ç­¾
                labelsList.add(currentChar);
                // è®¾ç½®å­èŠ‚ç‚¹æ ‡è®°(0)
                // labelBitmapBuilder.set(bitPos, false);
                bitPos++;
                // å°†å­èŠ‚ç‚¹èŒƒå›´åŠ å…¥é˜Ÿåˆ—
                queue.add(new Range(start, end, index + 1));
                start = end;
            }
            // è®¾ç½®èŠ‚ç‚¹ç»“æŸæ ‡è®°(1)
            labelBitmapBuilder.set(bitPos++, true);
            nodeId++;
        }
        // è½¬æ¢å¹¶åˆå§‹åŒ–ä½å›¾
        this.labels = new char[labelsList.size()];
        for (int i = 0; i &lt; labelsList.size(); i++) {
            labels[i] = labelsList.get(i);
        }
        this.labelBitmap = labelBitmapBuilder.build(true);
        this.isLeaf = isLeafBuilder.build(false);
    }

    /**
     * å­˜å‚¨çš„ key çš„ä¸ªæ•°
     */
    public int size() {
        return isLeaf.oneCount;
    }

    /**
     * è¯¥ Trie æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°
     */
    public int nodeCount() {
        return isLeaf.size;
    }

    /**
     * åˆ¤æ–­ key æ˜¯å¦å­˜åœ¨
     *
     * @param key è¦æŸ¥è¯¢çš„é”®å€¼
     * @return æ˜¯å¦å­˜åœ¨
     */
    public boolean contains(String key) {
        return index(key) &gt;= 0;
    }

    /**
     * ç²¾ç¡®æŸ¥è¯¢ç»™å®š key åœ¨å†…éƒ¨å”¯ä¸€å¯¹åº”çš„èŠ‚ç‚¹ ID
     *
     * @param key è¦æŸ¥è¯¢çš„ key
     * @return å¦‚æœ key å­˜åœ¨ï¼Œåˆ™è¿”å›å¯¹åº”çš„èŠ‚ç‚¹ IDï¼›å¦åˆ™ï¼Œè¿”å› -1
     */
    public int index(String key) {
        int nodeId = extract(key);
        return nodeId &gt;= 0 &amp;&amp; isLeaf.get(nodeId) ? nodeId : -1;
    }

    /**
     * åå‘æŸ¥è¯¢ç»™å®šèŠ‚ç‚¹ ID åœ¨å†…éƒ¨å”¯ä¸€å¯¹åº”çš„ key
     *
     * @param nodeId è¦æŸ¥è¯¢çš„èŠ‚ç‚¹ ID
     * @return å¦‚æœèŠ‚ç‚¹ ID åœ¨åˆæ³•èŒƒå›´å†…ï¼Œåˆ™è¿”å›å¯¹åº”çš„ keyï¼›å¦åˆ™ï¼Œè¿”å› null
     */
    public String get(int nodeId) {
        if (isLeaf.get(nodeId)) {
            StringBuilder str = new StringBuilder();
            int bitmapIndex;
            while ((bitmapIndex = labelBitmap.select0(nodeId)) &gt;= 0) {
                nodeId = labelBitmap.rank1(bitmapIndex);
                str.append(labels[bitmapIndex - nodeId]);
            }
            return str.reverse().toString();
        }
        return null;
    }

    /**
     * &lt;p&gt;ä»¥å­—å…¸åºæˆ–å±‚åºçš„æ–¹å¼éå† Trie ä¸­æ‰€æœ‰çš„ key&lt;/p&gt;
     * &lt;b&gt;æ³¨æ„&lt;/b&gt;ï¼šå±‚åºéå†çš„æ€§èƒ½è¦ä¼˜äºå­—å…¸åºéå†ï¼Œå¦‚æœä¸è¿½æ±‚æœ‰åºï¼Œè¯·å°† {@code orderly} è®¾ä¸º false ä»¥è·å¾—æœ€ä½³æ€§èƒ½
     *
     * @param orderly å¦‚æœä¸º trueï¼Œåˆ™æŒ‰ï¼ˆDFSï¼‰å­—å…¸åºéå†ï¼›å¦‚æœä¸º falseï¼Œåˆ™æŒ‰å±‚åºéå†ã€‚
     * @return ä¸€ä¸ªç”¨äºéå†æ‰€æœ‰ key çš„è¿­ä»£å™¨
     */
    public Iterator&lt;String&gt; iterator(boolean orderly) {
        if (orderly) {
            return traverse(0, &quot;&quot;);
        } else {
            return new Iterator&lt;&gt;() {
                private int index = isLeaf.nextSetBit(0);

                @Override
                public boolean hasNext() {
                    return index &gt;= 0;
                }

                @Override
                public String next() {
                    String str = get(index);
                    index = isLeaf.nextSetBit(index + 1);
                    return str;
                }
            };
        }
    }

    /**
     * æŸ¥è¯¢ç»™å®šå­—ç¬¦ä¸²åœ¨ Trie å†…æ‰€æœ‰çš„å‰ç¼€
     *
     * @param str è¦æŸ¥è¯¢çš„å­—ç¬¦ä¸²
     * @return ä¸€ä¸ªç”¨äºéå†æ‰€æœ‰å‰ç¼€çš„è¿­ä»£å™¨
     */
    public Iterator&lt;String&gt; prefixKeysOf(String str) {
        return new TermIterator() {
            private final char[] chars = str.toCharArray();
            private int pos = 0;
            private int nodeId = 0;
            private int bitmapIndex = 0;

            {
                advance(); // åˆå§‹åŒ–æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå‰ç¼€
            }

            @Override
            protected void advance() {
                while (pos &lt; chars.length) {
                    int index = labelSearch(nodeId, bitmapIndex, chars[pos]);
                    if (index &lt; 0) {
                        break;
                    }
                    nodeId = index + 1 - nodeId;
                    bitmapIndex = labelBitmap.select1(nodeId) + 1;
                    pos++;
                    if (isLeaf.get(nodeId)) {
                        next = new String(chars, 0, pos);
                        return;
                    }
                }
                next = null;
            }
        };
    }

    /**
     * æŸ¥è¯¢æ‰€æœ‰ä»¥ç»™å®šå‰ç¼€å¼€å¤´çš„ key
     *
     * @param prefix è¦æœç´¢çš„å‰ç¼€
     * @return ä¸€ä¸ªç”¨äºéå†æ‰€æœ‰åŒ¹é…å‰ç¼€çš„ key çš„è¿­ä»£å™¨
     */
    public Iterator&lt;String&gt; prefixSearch(String prefix) {
        return traverse(extract(prefix), prefix);
    }

    private int extract(String key) {
        int nodeId = 0, bitmapIndex = 0;
        for (char c : key.toCharArray()) {
            if ((bitmapIndex = labelSearch(nodeId, bitmapIndex, c)) &lt; 0) {
                return -1;
            }
            // å‘å­èŠ‚ç‚¹è½¬ç§»
            nodeId = bitmapIndex + 1 - nodeId;
            bitmapIndex = labelBitmap.select1(nodeId) + 1;
        }
        return nodeId;
    }

    private Iterator&lt;String&gt; traverse(int rootId, String prefix) {
        return new TermIterator() {
            private final CharBuffer charBuffer = CharBuffer.allocate(256);
            private int nodeId = rootId;
            private int bitmapIndex = rootId &lt; 0 ? labelBitmap.size : labelBitmap.select1(rootId) + 1;

            {
                charBuffer.append(prefix);
                charBuffer.flip();
                if (!isLeaf.get(rootId)) {
                    advance();
                }
            }

            @Override
            protected void advance() {
                // åˆ‡æ¢å†™æ¨¡å¼
                charBuffer.position(charBuffer.limit());
                charBuffer.limit(charBuffer.capacity());
                while (true) {
                    // æ’å¢™
                    while (bitmapIndex &gt;= labelBitmap.size || labelBitmap.get(bitmapIndex)) {
                        // åˆ°è¾¾æ ¹èŠ‚ç‚¹ï¼Œéå†ç»“æŸ
                        if (nodeId == rootId) {
                            next = null;
                            return;
                        }
                        // å›æº¯å¹¶å‘å³è½¬ç§»
                        bitmapIndex = labelBitmap.select0(nodeId) + 1;
                        nodeId = bitmapIndex - nodeId;
                        charBuffer.position(charBuffer.position() - 1);
                    }
                    charBuffer.put(labels[bitmapIndex - nodeId]);
                    // å‘ä¸‹è½¬ç§»
                    nodeId = bitmapIndex + 1 - nodeId;
                    bitmapIndex = labelBitmap.select1(nodeId) + 1;
                    if (isLeaf.get(nodeId)) {
                        charBuffer.flip();
                        next = charBuffer.toString();
                        return;
                    }
                }
            }
        };
    }

    /**
     * æœç´¢æ ‡ç­¾å‘ä¸‹å±‚è½¬ç§»
     *
     * @param nodeId      å½“å‰èŠ‚ç‚¹ID
     * @param bitmapIndex å½“å‰èŠ‚ç‚¹åœ¨ {@code labelBitmap} ä¸­çš„èµ·å§‹ä¸‹æ ‡
     * @param b           è¦æœç´¢çš„æ ‡ç­¾
     * @return ç›®æ ‡æ ‡ç­¾åœ¨ {@code labelBitmap} ä¸­çš„ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å› -1
     */
    private int labelSearch(int nodeId, int bitmapIndex, char b) {
        while (true) {
            if (bitmapIndex &gt;= labelBitmap.size || labelBitmap.get(bitmapIndex)) {
                return -1;
            }
            int labelIndex = bitmapIndex - nodeId;
            if (labelIndex &lt; labels.length &amp;&amp; labels[labelIndex] == b) {
                break;
            }
            bitmapIndex++;
        }
        return bitmapIndex;
    }

    // è¾…åŠ©ç±»ï¼šè¡¨ç¤ºé”®èŒƒå›´
    private record Range(int L, int R, int index) {
    }

    // è¯é¡¹è¿­ä»£å™¨
    private abstract static class TermIterator implements Iterator&lt;String&gt; {
        String next = &quot;&quot;;

        @Override
        public boolean hasNext() {
            return next != null;
        }

        @Override
        public String next() {
            if (next == null) {
                throw new NoSuchElementException();
            }
            String term = next;
            advance();
            return term;
        }

        abstract void advance();
    }

    // è‡ªå®ç°ä½å‘é‡ï¼ˆä½å›¾ï¼‰
    public static class BitVector {
        /**
         * æ•°å€¼è¶Šå°ï¼Œselects é¢„è®¡ç®—çš„é—´è·è¶Šå°ï¼Œå ç”¨æ›´é«˜ï¼Œselect1 çš„æ€§èƒ½è¶Šå¥½
         * ç»æµ‹è¯•ï¼Œè®¾ä¸º 1 æˆ– 2 æ—¶ï¼Œæ€§èƒ½æå‡æ˜æ˜¾ï¼Œä½†å ç”¨æé«˜ï¼Œå…¶ä½™æ•°å€¼å½±å“ä¸å¤§
         */
        private static final int GAP = 64;

        private final long[] bits;
        private final int[] ranks;   // é¢„è®¡ç®—rank1
        private final int[] selects; // éƒ¨åˆ†é¢„è®¡ç®—select1
        public final int oneCount;
        public final int size;

        // æ„å»ºå™¨æ¨¡å¼
        public static class Builder {
            private final List&lt;Long&gt; bits = new ArrayList&lt;&gt;();
            private int size = 0;
            private int count = 0;

            public void set(int position, boolean value) {
                ensureCapacity(position);
                int block = position &gt;&gt; 6;
                int offset = position &amp; 0x3F;
                long mask = 1L &lt;&lt; offset;
                long oldBlock = bits.get(block);
                if (value) {
                    bits.set(block, oldBlock | mask); // è®¾ç½®ä½ä¸º1
                } else {
                    bits.set(block, oldBlock &amp; ~mask); // è®¾ç½®ä½ä¸º0
                }
                // ä»…å½“ä½çš„å€¼å®é™…å‘ç”Ÿå˜åŒ–æ—¶æ›´æ–°è®¡æ•°å™¨
                if ((oldBlock &amp; mask) == 0 == value) {
                    count += value ? 1 : 0;
                }
            }

            private void ensureCapacity(int position) {
                int requiredBlocks = (position &gt;&gt; 6) + 1;
                while (bits.size() &lt; requiredBlocks) {
                    bits.add(0L);
                }
                size = Math.max(size, position + 1);
            }

            public BitVector build(boolean rankSelect) {
                long[] array = new long[bits.size()];
                for (int i = 0; i &lt; bits.size(); i++) {
                    array[i] = bits.get(i);
                }
                return new BitVector(array, size, count, rankSelect);
            }
        }

        private BitVector(long[] bits, int size, int count, boolean rankSelect) {
            this.bits = bits;
            this.size = size;
            this.oneCount = count;

            // é¢„è®¡ç®—rankå’Œselect
            if (rankSelect) {
                int totalOnes = 0;
                int oneCount = 0;
                this.ranks = new int[bits.length + 1];
                List&lt;Integer&gt; selectList = new ArrayList&lt;&gt;();
                for (int i = 0; i &lt; bits.length; i++) {
                    ranks[i] = totalOnes;
                    int blockOnes = Long.bitCount(bits[i]);
                    totalOnes += blockOnes;

                    long block = bits[i];
                    for (int j = 0; j &lt; 64; j++) {
                        if ((block &amp; (1L &lt;&lt; j)) != 0) {
                            oneCount++;
                            if (oneCount % GAP == 0) {
                                selectList.add(i * 64 + j);
                            }
                        }
                    }
                }
                ranks[bits.length] = totalOnes;

                this.selects = new int[selectList.size()];
                for (int i = 0; i &lt; selectList.size(); i++) {
                    selects[i] = selectList.get(i);
                }
            } else {
                this.ranks = null;
                this.selects = null;
            }
        }

        public int nextSetBit(int from) {
            if (from &lt; 0 || from &gt;= size) {
                return -1;
            }
            int u = from &gt;&gt; 6;
            long word;
            for (word = this.bits[u] &amp; -1L &lt;&lt; from; word == 0L; word = this.bits[u]) {
                if (++u == bits.length) {
                    return -1;
                }
            }
            return (u &lt;&lt; 6) + Long.numberOfTrailingZeros(word);
        }

        public boolean get(int pos) {
            if (pos &gt;= size) return false;
            int block = pos &gt;&gt; 6;
            int offset = pos &amp; 0x3F;
            return (bits[block] &amp; (1L &lt;&lt; offset)) != 0;
        }

        public int rank1(int pos) {
            if (pos &lt; 0 || pos &gt;= size) {
                return 0;
            }
            int block = pos + 1 &gt;&gt; 6;
            int offset = pos + 1 &amp; 0x3F;
            int count = ranks[block];

            if (offset &gt; 0) {
                long mask = (1L &lt;&lt; offset) - 1;
                count += Long.bitCount(bits[block] &amp; mask);
            }
            return count;
        }

        // æ€§èƒ½è¾ƒå·®
        public int select1(int k) {
            if (k &lt;= 0 || k &gt; ranks[bits.length]) {
                return -1;
            }
            // ä½¿ç”¨é¢„è®¡ç®—çš„selectåŠ é€Ÿ
            if (k % GAP == 0) {
                int idx = k / GAP - 1;
                if (idx &lt; selects.length)
                    return selects[idx];
            }
            // äºŒåˆ†æŸ¥æ‰¾å—
            int low = 0, high = ranks.length - 1;
            while (low &lt; high) {
                int mid = low + high &gt;&gt;&gt; 1;
                if (ranks[mid] &lt; k) {
                    low = mid + 1;
                } else {
                    high = mid;
                }
            }
            int block = low - 1;
            // åœ¨å—å†…æŸ¥æ‰¾
            int remaining = k - ranks[block];
            long word = bits[block];
            for (int i = 0; i &lt; 64; i++) {
                if ((word &amp; (1L &lt;&lt; i)) != 0) {
                    if (--remaining == 0) {
                        return block * 64 + i;
                    }
                }
            }
            return -1;
        }

        public int rank0(int pos) {
            if (pos &gt;= size) {
                pos = size - 1;
            }
            return pos + 1 - rank1(pos);
        }

        // æ€§èƒ½æå·®
        public int select0(int k) {
            if (k &lt;= 0 || k &gt; ranks[bits.length]) {
                return -1;
            }
            int low = 0, high = size - 1;
            while (low &lt;= high) {
                int mid = (low + high) &gt;&gt;&gt; 1;
                // è®¡ç®—[0, mid]åŒºé—´å†…çš„0çš„ä¸ªæ•°
                if (rank0(mid) &lt; k) {
                    low = mid + 1;
                } else {
                    high = mid - 1;
                }
            }
            // æ»¡è¶³rank0(low) &gt;= kçš„æœ€å°ä½ç½®å³ç¬¬kä¸ª0çš„ä½ç½®
            return low;
        }
    }
}
</code></pre>
<p>æ²¡æœ‰å…¨é¢çš„æµ‹è¯•ï¼Œç®€å•æµ‹è¯•å¤§è‡´ç»“æœå¦‚ä¸‹ï¼Œæµ‹è¯•å¾ˆç²—ç³™ï¼Œä»…ä¾›å‚è€ƒï¼š</p>
<ul>
<li><strong>ä¸­æ–‡ key</strong>ï¼šå†…å­˜å ç”¨æ¯” FSA å° <strong>40%</strong> å·¦å³ï¼ŒæŸ¥è¯¢æ€§èƒ½æ¯” FSA è¦ä½ <strong>76%</strong></li>
<li><strong>è‹±æ–‡ key</strong>ï¼šå†…å­˜å ç”¨æ¯” FSA å¤§ <strong>8.8%</strong> å·¦å³ï¼ŒæŸ¥è¯¢æ€§èƒ½æ¯” FSA è¦ä½ <strong>64%</strong>ï¼ˆè‹±æ–‡å­—ç¬¦åœ¨ char ç±»å‹ä¹Ÿæ˜¯ç”¨ 2 å­—èŠ‚å­˜ï¼Œæ¯”è¾ƒåƒäºï¼‰</li>
</ul>
<p>å› ä¸ºæ˜¯æœ€ç®€å®ç°ï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•ä¼˜åŒ–ï¼Œä½†ç¡®å®èƒ½çœ‹å‡ºåœ¨å†…å­˜æ–¹é¢æœ‰ä¸€å®šä¼˜åŠ¿ï¼Œåç»­å¼•å…¥ç¬¬ä¸‰æ–¹åº“ï¼ˆSux4Jï¼‰ä¼˜åŒ–ï¼Œè¡¨ç°è‚¯å®šä¼šå¼ºä¸Šä¸å°‘ï¼Œæœ‰å¾ˆå¤§çš„å‘å±•æ½œåŠ›</p>
<p><em>æ³¨ï¼šFSA æ˜¯æ²¡æœ‰è¾“å‡º FSTï¼Œå³ä¸å­˜ Value çš„ FSTï¼Œå› ä¸º Succinct Trie åªèƒ½å­˜ Keyï¼Œç›¸å½“äº Set é›†åˆï¼Œç›´æ¥è·Ÿå­˜å‚¨é”®å€¼å¯¹çš„ FST å¯¹æ¯”ä¸åˆé€‚</em></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å…³äºæˆ‘è„‘æ´å¤§å¼€å»ç”¨å¤šçº¿ç¨‹ä¼˜åŒ–å¿«é€Ÿæ’åºè¿™ä»¶äº‹]]></title>
        <id>https://hualiang.online/post/guan-yu-nao-dong-da-kai-qu-yong-duo-xian-cheng-you-hua-kuai-su-pai-xu-zhe-jian-shi/</id>
        <link href="https://hualiang.online/post/guan-yu-nao-dong-da-kai-qu-yong-duo-xian-cheng-you-hua-kuai-su-pai-xu-zhe-jian-shi/">
        </link>
        <updated>2024-10-25T14:50:34.000Z</updated>
        <summary type="html"><![CDATA[<p>ä»Šæ™šåœ¨å¤ä¹  TopK é—®é¢˜æ‰‹å†™å¿«æ’æ—¶ï¼Œçªå‘å¥‡æƒ³ï¼šâ€œæ—¢ç„¶å¿«æ’æ¯æ¬¡éƒ½è¦åˆ’åˆ†å‡ºä¸¤ä¸ªåŒºé—´é‡å¤è¿›è¡Œå¿«æ’ï¼Œé‚£ä¹ˆæˆ‘å¯ä¸å¯ä»¥å°†æ–°åˆ’åˆ†å‡ºçš„ä¸¤ä¸ªåŒºé—´ç”¨ä¸¤ä¸ªæ–°çº¿ç¨‹å»è·‘ ? â€ äºæ˜¯å°±æœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>ä»Šæ™šåœ¨å¤ä¹  TopK é—®é¢˜æ‰‹å†™å¿«æ’æ—¶ï¼Œçªå‘å¥‡æƒ³ï¼šâ€œæ—¢ç„¶å¿«æ’æ¯æ¬¡éƒ½è¦åˆ’åˆ†å‡ºä¸¤ä¸ªåŒºé—´é‡å¤è¿›è¡Œå¿«æ’ï¼Œé‚£ä¹ˆæˆ‘å¯ä¸å¯ä»¥å°†æ–°åˆ’åˆ†å‡ºçš„ä¸¤ä¸ªåŒºé—´ç”¨ä¸¤ä¸ªæ–°çº¿ç¨‹å»è·‘ ? â€ äºæ˜¯å°±æœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚</p>
<!-- more -->
<h1 id="åˆæ¬¡å°è¯•">åˆæ¬¡å°è¯•</h1>
<p>å¦‚æœæ¯æ¬¡åˆ’åˆ†æ–°åŒºé—´éƒ½å¼€çº¿ç¨‹è·‘ï¼Œé‚£æœ€åçš„çº¿ç¨‹æ•°è‚¯å®šä¼šçˆ†ç‚¸å¼å¢é•¿ï¼Œæ‰€ä»¥æˆ‘é¦–å…ˆæƒ³åˆ°ç”¨çº¿ç¨‹æ± å»è·‘ã€‚åœ¨çº¿ç¨‹æ± ä¸­ï¼Œå¤šä½™çš„ä»»åŠ¡æ”¾åœ¨é˜»å¡é˜Ÿåˆ—æ‰§è¡Œï¼Œä¿è¯æœ€å¤§æ‰§è¡Œçº¿ç¨‹æ•°ä¸è¶…è¿‡ CPU æ ¸å¿ƒæ•°ã€‚æ—¢èƒ½æœ€å¤§åˆ©ç”¨ CPU å¤šæ ¸ï¼Œåˆä¸è‡³äºè®©çº¿ç¨‹æ•°æº¢å‡ºï¼Œä¸€ä¸¾ä¸¤å¾—ã€‚</p>
<p>ç†è®ºå¯è¡Œï¼Œå¼€å§‹å®è·µï¼</p>
<h1 id="ä»£ç ">ä»£ç </h1>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŸç”Ÿçš„å¿«æ’ï¼Œæˆ‘çš„å†™æ³•å¯èƒ½è·Ÿå¸¸è§„å†™æ³•ä¸ä¸€æ ·ï¼Œä¸è¿‡æ•ˆç‡æ˜¯ä¸€æ ·çš„ï¼š</p>
<pre><code class="language-java">public static void quickSort(int nums, int l, int r) {
    if (l &gt;= r) return;
    int x = nums[i], i = l, j = r + 1;
    while (i &lt; j) {
        while (nums[--j] &gt; x &amp;&amp; i != j);
        if (i == j) nums[j] = x;
        else {
            nums[i] = nums[j];
            while (nums[++i] &lt; x &amp;&amp; i != j);
            if (i == j) nums[i] = x;
            else nums[j] = nums[i];
        }
    }
    quickSort(nums, l, j - 1);
    quickSort(nums, j + 1, r);
}
</code></pre>
<p>é‚£å¦‚ä½•å°†çº¿ç¨‹æ± ç”¨åˆ°å¿«æ’é‡Œå»å‘¢ï¼Ÿå…¶å®ç”¨æ ˆå®ç°è¿­ä»£å†™æ³•ä¼šæ›´æ˜“äºç†è§£ã€‚</p>
<p>è¿™é‡Œçº¿ç¨‹æ± ä¹Ÿèµ·åˆ°äº†ä¸€ä¸ªå­˜å‚¨ä»»åŠ¡çš„ä½œç”¨ï¼Œå³ä»»åŠ¡é˜Ÿåˆ—ã€‚æ¯æ¬¡å¯¹åŒºé—´è¿›è¡Œåˆ’åˆ†åï¼Œå°†åˆ’åˆ†çš„åŒºé—´çš„å·¦å³ä½ç½®å­˜åˆ°é˜Ÿåˆ—ä¸­ï¼Œç•™åˆ°ä¹‹åæ‰§è¡Œï¼Œç±»ä¼¼äºè¿­ä»£æ³•ä¸­çš„æ ˆã€‚ä¸è¿‡çº¿ç¨‹æ± çš„å¥½å¤„å°±æ˜¯ï¼Œå®ƒä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œè€Œä¸éœ€è¦æˆ‘ä»¬é€šè¿‡å¾ªç¯å»å–ä»»åŠ¡æ‰§è¡Œã€‚</p>
<p>é‚£ä¹ˆå…ˆå†™ä¸€ä¸ªçº¿ç¨‹éœ€è¦æ‰§è¡Œçš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿”å›å€¼ï¼Œæ‰€ä»¥å®ç° Runnableï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">class Task implements Runnable {

    private int left;

    private int right;

    private int[] nums;

    private AtomicInteger count;

    private ExecutorService executor;

    // ä¼ å‚
    public Task(int left, int right, int[] nums, AtomicInteger count, ExecutorService executor) {
        this.left = left;
        this.right = right;
        this.nums = nums;
        this.count = count;
        this.executor = executor;
    }

    @Override
    public void run() {
        // åˆ’åˆ†åŒºé—´å‰çš„ç§»ä½æ“ä½œ
        int x = nums[left], i = left, j = right + 1;
        while (i &lt; j) {
            while (nums[--j] &gt; x &amp;&amp; i != j);
            if (i == j) nums[j] = x;
            else {
                nums[i] = nums[j];
                while (nums[++i] &lt; x &amp;&amp; i != j);
                if (i == j) nums[i] = x;
                else nums[j] = nums[i];
            }
        }
        if (left &lt; i - 1) {
            count.getAndIncrement(); // å°†æœªå®Œæˆä»»åŠ¡æ•° + 1
            // å°†ä¸‹ä¸ªåŒºé—´çš„æ’åºä»»åŠ¡äº¤ç»™æ–°çº¿ç¨‹æ‰§è¡Œ
            executor.execute(new Task(left, i - 1, nums, count, executor));
        }
        if (i + 1 &lt; right) {
            count.getAndIncrement();
            executor.execute(new Task(i + 1, right, nums, count, executor));
        }
        count.getAndDecrement(); // æœ€åè®°å¾—æ‰£é™¤ä»»åŠ¡æ•°
    }
}
</code></pre>
<p>å› ä¸ºçº¿ç¨‹éœ€è¦ä¼ å‚ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡æ„é€ å‡½æ•°ç»™å­—æ®µèµ‹å€¼æ¥ä¼ ï¼Œè¿™é‡Œä¸€ä¸ªä¸ªè§£é‡Šï¼š</p>
<ul>
<li><code>left</code> å’Œ <code>right</code> ï¼šåŒºé—´å·¦å³ä¸¤è¾¹çš„ç´¢å¼•</li>
<li><code>nums</code> ï¼šæ•°ç»„</li>
<li><code>count</code> ï¼šè®¡æ•°å™¨ï¼Œç”¨æ¥åˆ¤æ–­çº¿ç¨‹æ± ä½•æ—¶å°†æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæˆ</li>
<li><code>executor</code> ï¼šçº¿ç¨‹æ± </li>
</ul>
<p>æ¥ç€ï¼Œæˆ‘ä»¬æ¥å†™å‡ºä¸»ç±»çš„ç»“æ„ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public class ParallelQuickSort {
    public static void main(String[] args) {
        // ç”Ÿæˆéšæœºæ•°æ®
        int[] nums = generateRandomArray(10000000);
        double start = System.currentTimeMillis();
        // Arrays.sort(nums);
        parallelQuickSort(nums);
        double end = System.currentTimeMillis();
        System.out.println(((end - start) / 1000) + &quot; seconds&quot;);
        // éªŒè¯æ’åºç»“æœ
        for (int i = 1; i &lt; nums.length; i++) {
            if (nums[i] &lt; nums[i - 1]) {
                System.out.println(&quot;æ’åºå¤±è´¥ï¼&quot;);
                break;
            }
        }
    }

    public static void parallelQuickSort(int[] nums) {
        if (nums == null || nums.length == 0) return;
        // è¿™é‡Œå›¾ç®€å•ï¼Œç›´æ¥ç”¨å†…ç½®çº¿ç¨‹æ± 
        ExecutorService executor = Executors.newFixedThreadPool(20);
        // countå…¶å®ä»£è¡¨äº†æœªå®Œæˆçš„ä»»åŠ¡æ•°ï¼ŒåŒ…æ‹¬æ­£åœ¨æ‰§è¡Œå’Œç­‰å¾…æ‰§è¡Œçš„
        AtomicInteger count = new AtomicInteger(1);
        executor.execute(new Task(0, nums.length - 1, nums, count, executor));
        // è‡ªæ—‹åˆ¤æ–­æ˜¯å¦å·²ç»æ‰§è¡Œå®Œæ¯•
        while (count.get() &gt; 0) {
            try {
                System.out.println(&quot;countï¼š&quot; + count.get());
                Thread.sleep(10);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        // ä»¥ä¸‹çš†ä¸ºå…³é—­çº¿ç¨‹æ± çš„æªæ–½
        executor.shutdown();
        try {
            executor.awaitTermination(60, TimeUnit.SECONDS);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }

    // éšæœºç”Ÿæˆæ•°æ®
    public static int[] generateRandomArray(int size) {
        Random random = new Random();
        int[] array = new int[size];
        for (int i = 0; i &lt; size; i++) {
            array[i] = random.nextInt(size) + 1;
        }
        return array;
    }
}
</code></pre>
<p>æ•´ä¸ªæµç¨‹å…¶å®å°±æ˜¯å°†è¿­ä»£æ³•ä¸­çš„é˜Ÿåˆ—æ¢æˆäº†å¯ä»¥è‡ªåŠ¨æ‰§è¡Œçš„çº¿ç¨‹æ± ï¼Œè€Œè®¡æ•°å™¨å› ä¸ºå­˜åœ¨å¹¶å‘æ“ä½œï¼Œæ‰€ä»¥ä½¿ç”¨åŸå­ç±»ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚</p>
<h1 id="æµ‹è¯•">æµ‹è¯•</h1>
<p>æˆ‘ä»¬åˆ©ç”¨éšæœºå‡½æ•°ç”Ÿæˆéšæœºæ•´å‹æ•°æ®ï¼Œåˆ†åˆ«ä½¿ç”¨åŸç”Ÿçš„ <code>Arrays.sort</code> å’Œæˆ‘ä»¬çš„å¤šçº¿ç¨‹å¿«æ’æ¥æµ‹è¯•ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>æ•°æ®é‡</th>
<th>Arrays.sort</th>
<th>ParallelQuickSort</th>
</tr>
</thead>
<tbody>
<tr>
<td>10000000</td>
<td>1.466 ç§’</td>
<td>2.305 ç§’</td>
</tr>
<tr>
<td>1000000</td>
<td>0.112 ç§’</td>
<td>0.208 ç§’</td>
</tr>
</tbody>
</table>
<p>å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬çš„å¤šçº¿ç¨‹ç«Ÿç„¶æ¯”å•çº¿ç¨‹çš„åŸç”Ÿæ–¹æ³•è¿˜æ…¢ï¼Œå‡ ä¹å·®äº†ä¸€å€ï¼Œè¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ</p>
<p>ç»è¿‡æˆ‘çš„ä¸€æ³¢åˆ†æå’ŒæŸ¥é˜…èµ„æ–™ï¼ŒåŸºæœ¬é”å®šåŸå› ï¼šå¤šçº¿ç¨‹çš„é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p>
<p>åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘å¹¶æ²¡æœ‰å¯¹â€œåˆ’åˆ†åŒºé—´ç»™æ–°çº¿ç¨‹è·‘â€è¿™ä¸€è¡Œä¸ºåšé™åˆ¶ï¼Œä»¥è‡³äºå³ä½¿åŒºé—´å†å°ä¹Ÿä¼šæ‰”åˆ°çº¿ç¨‹æ± å»æ‰§è¡Œã€‚è€Œè¿™ä¹‹é—´æ¶ˆè€—çš„çº¿ç¨‹åˆ‡æ¢æ—¶é—´å¯è¦æ¯”ç›´æ¥ç”¨å•çº¿ç¨‹è·‘è¦å¤šã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é’ˆå¯¹è¿™ä¸€ç‚¹è¿›è¡Œä¼˜åŒ–ã€‚</p>
<h1 id="äºŒæ¬¡ä¼˜åŒ–">äºŒæ¬¡ä¼˜åŒ–</h1>
<p>æˆ‘ä»¬åªéœ€è¦å¯¹ <code>run()</code> ä½œä»¥ä¸‹ä¿®æ”¹å¹¶ä¸”æ·»åŠ ä¸€ä¸ªæ™®é€šçš„å¿«æ’æ–¹æ³•å³å¯ï¼Œç»è¿‡æˆ‘æµ‹è¯•ï¼Œå½“åŒºé—´é•¿åº¦å°äº 10000 æ—¶ç›´æ¥ä½¿ç”¨å¿«æ’æ•ˆæœæœ€å¥½ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">@Override
public void run() {
    int x = nums[left], i = left, j = right + 1;
    while (i &lt; j) {
        while (nums[--j] &gt; x &amp;&amp; i != j);
        if (i == j) nums[j] = x;
        else {
            nums[i] = nums[j];
            while (nums[++i] &lt; x &amp;&amp; i != j);
            if (i == j) nums[i] = x;
            else nums[j] = nums[i];
        }
    }
    // å½“åŒºé—´é•¿åº¦å°äº 10000 æ—¶ç›´æ¥ä½¿ç”¨å¿«æ’æ•ˆæœ
    if (right - left &lt;= 10000) {
        quicksort(nums, left, i - 1);
        quicksort(nums, i + 1, right);
    } else {
        if (left &lt; i - 1) {
            count.getAndIncrement();
            executor.execute(new MyRunnable(left, i - 1, nums, count, executor));
        }
        if (i + 1 &lt; right) {
            count.getAndIncrement();
            executor.execute(new MyRunnable(i + 1, right, nums, count, executor));
        }
    }
    count.getAndDecrement();
}

public static void quicksort(int[] nums, int l, int r) {
    if (l &gt;= r) return;
    int x = nums[l], i = l, j = r + 1;
    while (i &lt; j) {
        while (nums[--j] &gt; x &amp;&amp; i != j);
        if (i == j) nums[j] = x;
        else {
            nums[i] = nums[j];
            while (nums[++i] &lt; x &amp;&amp; i != j);
            if (i == j) nums[i] = x;
            else nums[j] = nums[i];
        }
    }
    quicksort(nums, l, j - 1);
    quicksort(nums, j + 1, r);
}
</code></pre>
<h1 id="æœ€ç»ˆæµ‹è¯•">æœ€ç»ˆæµ‹è¯•</h1>
<p>ä¼˜åŒ–å®Œåï¼Œæˆ‘ä»¬å†æ¥æµ‹è¯•ï¼Œä¾æ—§æ˜¯äº”æ¬¡ç»“æœå–å¹³å‡ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>æ•°æ®é‡</th>
<th>Arrays.sort</th>
<th>ParallelQuickSort</th>
</tr>
</thead>
<tbody>
<tr>
<td>10000000</td>
<td>1.544 ç§’</td>
<td>0.339 ç§’</td>
</tr>
<tr>
<td>1000000</td>
<td>0.111 ç§’</td>
<td>0.054 ç§’</td>
</tr>
</tbody>
</table>
<p>å¯ä»¥çœ‹å‡ºï¼Œåœ¨åƒä¸‡çº§æ•°æ®é‡ä¸‹å¿«äº†å°†è¿‘äº”å€ï¼Œåªèƒ½è¯´æˆæ•ˆéå¸¸æ˜æ˜¾ã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æœ€åæˆ‘æ€è€ƒäº†ä¸€ä¸‹ï¼Œ<s>ä¸ºä»€ä¹ˆåŸç”Ÿçš„å¿«æ’æ–¹æ³•ä¸ä½¿ç”¨å¤šçº¿ç¨‹</s>ï¼Œå¯èƒ½çš„åŸå› åˆå¦‚ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>å¤§é‡æ•°æ®æ”¾åœ¨å†…å­˜ä¸­å¾ˆå ç©ºé—´çš„ï¼Œæ›´å¤šä¼šé‡‡ç”¨å¤šè·¯å½’å¹¶æ’åºï¼ˆå¤–éƒ¨æ’åºï¼‰</li>
<li>å¤šçº¿ç¨‹ä¼šæ¶ˆè€— CPU èµ„æºï¼Œä»…ä»…ç”¨æ¥æ’åºæ„Ÿè§‰å¤šå°‘æœ‰ç‚¹æµªè´¹</li>
<li>ä¸¤è€…çš„å·®è·åœ¨åƒä¸‡çº§æ•°æ®é‡ä¸‹æ‰å¼€å§‹æœ‰æ˜æ˜¾å·®è·ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸ä¼šæœ‰è¿™ä¹ˆé«˜</li>
</ul>
<p>p.s. æˆ‘åæ¥æ‰çŸ¥é“ Java çš„ <code>Arrays.parallelSort()</code> æ–¹æ³•å°±æ˜¯åŸç”Ÿçš„å¤šçº¿ç¨‹å¿«æ’ğŸ˜‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Javascript é€†å‘ä¹‹ woff å­—ä½“åçˆ¬ç ´è§£]]></title>
        <id>https://hualiang.online/post/python-pa-chong-js-ni-xiang-zhi-woff-zi-ti-fan-pa-po-jie/</id>
        <link href="https://hualiang.online/post/python-pa-chong-js-ni-xiang-zhi-woff-zi-ti-fan-pa-po-jie/">
        </link>
        <updated>2024-08-25T09:56:36.000Z</updated>
        <summary type="html"><![CDATA[<p>è½¬è‡ªä¸ªäººåšå®¢ â€œ<a href="https://home.cnblogs.com/u/Eeyhan">Eeyhan</a>â€ çš„<a href="https://www.cnblogs.com/Eeyhan/p/15576450.html">ã€Špythonçˆ¬è™« - jsé€†å‘ä¹‹woffå­—ä½“åçˆ¬ç ´è§£ã€‹</a></p>
]]></summary>
        <content type="html"><![CDATA[<p>è½¬è‡ªä¸ªäººåšå®¢ â€œ<a href="https://home.cnblogs.com/u/Eeyhan">Eeyhan</a>â€ çš„<a href="https://www.cnblogs.com/Eeyhan/p/15576450.html">ã€Špythonçˆ¬è™« - jsé€†å‘ä¹‹woffå­—ä½“åçˆ¬ç ´è§£ã€‹</a></p>
<!-- more -->
<h1 id="ä¸€-å‰è¨€">ä¸€ã€å‰è¨€</h1>
<p>æœ¬ç¯‡åšæ–‡çš„ä¸»é¢˜å°±æ˜¯å¤„ç†å­—ä½“åçˆ¬çš„ï¼Œå…¶å®è¿™ç§ç½‘ä¸Šå·²ç»å¾ˆå¤šäº†ï¼Œé‚£ä¸ºä»€ä¹ˆæˆ‘è¿˜è¦å†™å‘¢ï¼Ÿå› ä¸ºæ— èŠå•Šï¼Œæœ€è¿‘æ˜¯çœŸæ²¡å•¥äº‹ï¼Œå¹¶ä¸”æˆ‘çœ‹äº†ä¸‹ï¼Œè¿˜æ˜¯æœ‰ç‚¹éš¾åº¦çš„ï¼Œç„¶åè¿™ä¸ªå­—ä½“åçˆ¬ç³»åˆ—ä¼šå‡ºä¸¤åˆ°ä¸‰ç¯‡åšæ–‡ï¼Œé’ˆå¯¹å¸‚é¢ä¸Šä¸»æµçš„å­—ä½“åçˆ¬ï¼Œä¸€ä¸€è®²æ¸…æ¥š</p>
<p>ä¸å¤šbbï¼Œå…ˆçœ‹ç›®æ ‡ç«™</p>
<blockquote>
<p>http://www.dianping.com/member/79399592/reviews</p>
</blockquote>
<h1 id="äºŒ-åˆ†æ">äºŒã€åˆ†æ</h1>
<p>æ‰“å¼€ç½‘ç«™å‘ç°ï¼Œå¦‚ä¸‹åœ°å€åœ¨æºç é‡Œä¸æ˜¾ç¤º</p>
<figure data-type="image" tabindex="1"><img src="https://hualiang.online/post-images/1724637148523.png" alt="img" loading="lazy"></figure>
<p>å†çœ‹ä¸‹é¢çš„æ–‡å­—ï¼Œç½‘é¡µæºç é‡Œé¢ä¹Ÿæ²¡æœ‰æ­£å¸¸æ˜¾ç¤º</p>
<figure data-type="image" tabindex="2"><img src="https://hualiang.online/post-images/1724637202451.png" alt="img" loading="lazy"></figure>
<p>è¿™ç§å°±å¾ˆç§€äº†å•Šï¼Œå¯¹äºæ²¡æè¿‡å­—ä½“åçˆ¬çš„æœ‹å‹æ¥è¯´ï¼Œä¼°è®¡å°±è¿·ç³Šäº†ï¼Œä¸ç”¨æ€•ï¼Œè·Ÿç€æˆ‘çš„æ€è·¯æ¥</p>
<p>å…ˆçœ‹åœ°å€æ ï¼Œç‚¹ä¸‹é‚£ä¸ªæ ‡ç­¾ï¼Œçœ‹å³è¾¹çš„cssæ ·å¼ï¼ˆå¯¹è¿™ä¸ªä¸ç†è§£çš„ï¼Œçœ‹çœ‹htmlå‰ç«¯åŸºç¡€å§ï¼Œæœ€å¤šä¸€å‘¨å°±æ‡‚äº†ï¼‰ï¼Œæˆ–è€…çœ‹çœ‹æˆ‘çš„ä¹‹å‰çš„åšæ–‡ï¼Œhttps://www.cnblogs.com/Eeyhan/category/1339041.html</p>
<figure data-type="image" tabindex="3"><img src="https://hualiang.online/post-images/1724637280564.png" alt="img" loading="lazy"></figure>
<p>åœ¨çœ‹ä¸‹é¢çš„å†…å®¹ï¼š</p>
<figure data-type="image" tabindex="4"><img src="https://hualiang.online/post-images/1724637365331.png" alt="img" loading="lazy"></figure>
<p>è¿™ç§å•¥æ„æ€å‘¢ï¼Œé¦–å…ˆå“ˆï¼Œçœ‹åˆ°è¿™ç§æºç é‡Œé¢çœ‹ä¸åˆ°çš„ï¼Œé‚£ä¸€å®šæ˜¯åœ¨cssæ ·å¼é‡Œï¼Œç”¨çš„@font-faceè‡ªå®šä¹‰çš„å­—ä½“ï¼Œæ‰€ä»¥ï¼Œä¸Šé¢åœˆå‡ºæ¥çš„ä¸¤ä¸ªcsså°±å¾ˆé‡è¦äº†ï¼Œç‚¹è¿›å»çœ‹çœ‹ï¼Œç‚¹è¿™ä¸ª</p>
<figure data-type="image" tabindex="5"><img src="https://hualiang.online/post-images/1724637386208.png" alt="img" loading="lazy"></figure>
<p>è¿›å»ä¹‹åï¼Œæ ¼å¼åŒ–ä¸€ä¸‹ï¼Œç„¶åå°±çœ‹åˆ°å¦‚ä¸‹ï¼š</p>
<figure data-type="image" tabindex="6"><img src="https://hualiang.online/post-images/1724637415873.png" alt="img" loading="lazy"></figure>
<p>æœç„¶æœ‰ä¸ª@font-faceï¼Œå°±çœ‹è¿™ä¸ªåé¢çš„urlå¼•å…¥äº†å•¥æ ·å¼çš„å­—ä½“æ–‡ä»¶ï¼Œå¾€åé¢æ‹‰ä¸‹æ»šåŠ¨æ¡ï¼Œæœç„¶çœ‹åˆ°ä¸€ä¸ªwoffçš„å­—ä½“æ–‡ä»¶</p>
<p>è¡¥å……ä¸€ä¸‹ï¼Œå­—ä½“æ–‡ä»¶æ ¼å¼æœ‰å“ªå‡ ç§å‘¢ï¼Ÿå¸¸è§çš„æœ‰woffï¼Œsvgï¼Œttfï¼Œå…¶ä»–çš„å°±ä¸ç»†è¯´äº†ï¼Œå¥½çš„ï¼Œå…ˆæŠŠè¿™ä¸ªå­—ä½“ä¸‹è½½ä¸‹æ¥ï¼Œå¤åˆ¶é“¾æ¥æµè§ˆå™¨æ‰“å¼€ç›´æ¥ä¸‹è½½ï¼Œä¸ç”¨è¡¥é½httpåè®®ç›´æ¥ä¸‹è½½ï¼š</p>
<figure data-type="image" tabindex="7"><img src="https://hualiang.online/post-images/1724637439593.png" alt="img" loading="lazy"></figure>
<p>è¿™ä¸ªå­—ä½“å…ˆæ”¾ç€ï¼Œç›®å‰è¿™ä¸ªæ˜¯åœ°å€ç›¸å…³çš„ï¼Œå†çœ‹å†…å®¹çš„å­—ä½“æ–‡ä»¶ï¼ŒåŒæ ·çš„æ–¹å¼ç‚¹å‡»é‚£ä¸ªcssï¼Œè¿›å…¥é‡Œé¢æŠŠé“¾æ¥å¤åˆ¶å‡ºæ¥ä¸‹è½½ï¼š</p>
<figure data-type="image" tabindex="8"><img src="https://hualiang.online/post-images/1724637462046.png" alt="img" loading="lazy"></figure>
<p>å› ä¸ºæˆ‘ä¹‹å‰åˆ†æçš„æ—¶å€™å·²ç»ä¸‹è½½è¿‡äº†ï¼Œæ‰€ä»¥ï¼Œæ–‡ä»¶åä¼šæœ‰ä¸ªï¼ˆ1ï¼‰ã€‚</p>
<p>å¥½çš„ï¼Œè¿™ä¸¤ä¸ªå­—ä½“æ–‡ä»¶ï¼Œæ¢³ç†ä¸€ä¸‹ï¼Œf76çš„æ˜¯åœ°å€çš„ï¼Œ924çš„æ˜¯å†…å®¹çš„ï¼Œè¿™ç§æ–‡ä»¶æ€ä¹ˆæ‰“å¼€å‘¢ï¼Ÿç”¨è¿™ä¸ªåœ°å€ï¼š<a href="http://font.qqe2.com/index-en.html">ç‚¹æˆ‘</a> ï¼Œï¼ˆç™¾åº¦çš„åœ¨çº¿å­—ä½“ç¼–è¾‘å™¨ç½‘å€å·²ç»æ‰“ä¸å¼€äº†ï¼Œå¦å¤–æ‰¾çš„ä¸€ä¸ªï¼‰åœ¨çº¿æ‰“å¼€ï¼š</p>
<figure data-type="image" tabindex="9"><img src="https://hualiang.online/post-images/1724637481773.png" alt="img" loading="lazy"></figure>
<p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨fontcreatorè½¯ä»¶æ‰“å¼€ï¼š</p>
<figure data-type="image" tabindex="10"><img src="https://hualiang.online/post-images/1724637502129.png" alt="img" loading="lazy"></figure>
<p>æœç„¶å“ˆï¼Œè¿™é‡Œé¢å°±æ˜¯å®šä¹‰å¥½çš„å­—ä½“äº†ï¼Œè€Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§æœ‰ç¼–ç ï¼Œæœ‰å®é™…å­—ä½“çš„ï¼Œåªè¦æ‰¾åˆ°æ˜ å°„å…³ç³»ï¼Œå°±å¯ä»¥æŠŠæˆ‘ä»¬è¦çš„å†…å®¹ç»™æ˜ å°„å‡ºæ¥äº†ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬æ€ä¹ˆå»æ‰¾æ˜ å°„å…³ç³»å‘¢ï¼Ÿ</p>
<p>å…ˆçœ‹çœ‹è§„å¾‹å“ˆï¼Œæå‰è¯´ä¸‹ï¼Œè¿™é‡Œç›´æ¥æ˜¯ä¸­æ–‡å­—ï¼Œè€Œä¸æ˜¯ç½‘ä¸Šæœ‰äº›è€å“¥é’ˆå¯¹å­—ä½“åçˆ¬è®²è§£çš„æ•°å­—ï¼Œç„¶åæ‰¾åˆ°æ˜ å°„å…³ç³»ä¹‹åå‡2å“ˆï¼Œæ‰€ä»¥è¿˜æ˜¯è¦è‡ªå·±å»æ‰¾é‚£å¥—æ˜ å°„é€»è¾‘</p>
<p>æ€ä¹ˆæ‰¾ï¼Ÿç›´æ¥ç”¨ä¸€ä¸ªå­—æ¥çœ‹å§ï¼Œå°±æ‰¾è¿™ä¸ªã€å¹¿ã€‘å­—</p>
<figure data-type="image" tabindex="11"><img src="https://hualiang.online/post-images/1724637525609.png" alt="img" loading="lazy"></figure>
<p>å…ˆçœ‹ç½‘é¡µæºç é‡Œè¿™ä¸ªå¹¿æ˜¯å•¥ç¼–ç ï¼Œå¥½çš„ï¼Œ<code>&amp;#xe2c9</code>ï¼Œå…ˆæ”¾ä¸€æ”¾</p>
<figure data-type="image" tabindex="12"><img src="https://hualiang.online/post-images/1724637550423.png" alt="img" loading="lazy"></figure>
<p>çœ‹è¿™è¾¹woffå­—ä½“é‡Œè¿™ä¸ªå¹¿æ˜¯å•¥</p>
<p>åœ¨çº¿ç½‘ç«™çœ‹åˆ°çš„ï¼Œè¿˜å¥½ï¼Œç¬¬ä¸€é¡µå°±æœ‰ï¼Œæ˜¯ <code>unie2c9</code></p>
<figure data-type="image" tabindex="13"><img src="https://hualiang.online/post-images/1724637587200.png" alt="img" loading="lazy"></figure>
<p><code>unie2c9</code> è·Ÿ <code>&amp;#xe2c9</code>ï¼Œå¥½åƒæœ‰ç‚¹åƒï¼Œå…ˆä¸æ€¥ï¼Œçœ‹ä¸‹ï¼ŒfontCreator è½¯ä»¶é‡Œæ˜¯å•¥ï¼š</p>
<figure data-type="image" tabindex="14"><img src="https://hualiang.online/post-images/1724637652821.png" alt="img" loading="lazy"></figure>
<p>çœ‹ç€æœ‰ç‚¹ä¸ä¸€æ ·å“ˆï¼Œè¿™ä¸é‡è¦ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨ Python çš„åº“çœ‹çœ‹ï¼Œæœ‰ä¸€ä¸ªå¤§ä½¬å†™å¥½çš„å­—ä½“æ˜ å°„æ–‡ä»¶åº“ï¼ŒfontToolsï¼ˆè‡ªå·±ç”¨pipå®‰è£…ï¼Œä¸å¤šä»‹ç»äº†ï¼‰</p>
<figure data-type="image" tabindex="15"><img src="https://hualiang.online/post-images/1724637670683.png" alt="img" loading="lazy"></figure>
<p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼Œç„¶åå®ƒç”Ÿæˆäº†ä¸€ä¸ª font çš„ xml æ–‡ä»¶ï¼Œæ‰“å¼€çœ‹çœ‹ï¼š</p>
<figure data-type="image" tabindex="16"><img src="https://hualiang.online/post-images/1724637687037.png" alt="img" loading="lazy"></figure>
<p>é‡Œé¢æœ‰ä¸¤ä¸ªå…³é”®çš„èŠ‚ç‚¹å°±æ˜¯ <code>GlyphOrder</code> å’Œ <code>cmap</code>ï¼Œè€Œè¿™ä¸¤ä¸ªï¼Œåˆšæ‰çš„ä»£ç é‡Œå·²ç»æ‰“å°å‡ºæ¥äº†ï¼Œç»“æœï¼š</p>
<figure data-type="image" tabindex="17"><img src="https://hualiang.online/post-images/1724637734981.png" alt="img" loading="lazy"></figure>
<p>é‚£è¡Œï¼Œæˆ‘ä»¬æ‰¾ä¸‹è¿™ä¸ªã€å¹¿ã€‘åœ¨å“ªï¼Œæœä»åœ¨çº¿å­—ä½“æ–‡ä»¶ç¼–è¾‘ç½‘é‡Œæ‹¿åˆ°çš„ <code>unie2c9</code>ï¼Œå‘ç°æœ‰ä¸¤ä¸ªï¼š</p>
<figure data-type="image" tabindex="18"><img src="https://hualiang.online/post-images/1724637753741.png" alt="img" loading="lazy"></figure>
<figure data-type="image" tabindex="19"><img src="https://hualiang.online/post-images/1724637776491.png" alt="img" loading="lazy"></figure>
<p>å“ªä¸ªæ‰æ˜¯å‘¢ï¼Ÿå†æœä¸‹ï¼Œå­—ä½“æ–‡ä»¶æ‹¿åˆ°çš„ <code>glyph86</code>ï¼Œå‘ç°æ²¡æœ‰</p>
<figure data-type="image" tabindex="20"><img src="https://hualiang.online/post-images/1724638532426.png" alt="img" loading="lazy"></figure>
<p>ä½†æ˜¯ï¼Œç›®å‰æ„Ÿè§‰æœ‰ç‚¹è”ç³»ï¼Œ<code>&amp;#xe2c9</code> - <code>unie2c9</code> - <code>86</code></p>
<p>è¿™ç§æ˜¯å•¥å‘€ï¼Œå°±ä¸å¤šè¯´äº†ï¼Œ<code>unie2c9</code> å‰é¢çš„ <code>uni</code> å°±æ˜¯ unicode ç¼–ç çš„æ„æ€ï¼Œå§‘ä¸”è®¤å®šä¸º &amp;<code>#xe2c9</code> = <code>unie2c9</code> ï¼Œé‚£ 86 å‘¢ï¼Œæ€ä¹ˆæ˜ å°„å‡ºã€å¹¿ã€‘å­—çš„ï¼Œå¤§èƒ†çŒœæµ‹ï¼Œè¿™ä¸ª 86 å°±æ˜¯ç´¢å¼•ä½ç½®ï¼Œåœ¨é‚£ä¸ª woff æ–‡ä»¶é‡Œæ•°ä¸€ä¸‹ï¼Œçœ‹æ˜¯ä¸æ˜¯ç¬¬ 86 ä¸ªï¼Œå…ˆçœ‹è¿™ä¸ªï¼Œä¸€è¡Œæ˜¯ 10 ä¸ªï¼Œç„¶åç¬¬ä¸€è¡Œæ˜¯æ²¡æœ‰ä»»ä½•ç¼–ç çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€è¡Œåªæœ‰ 9 ä¸ªï¼Œ</p>
<figure data-type="image" tabindex="21"><img src="https://hualiang.online/post-images/1724637801401.png" alt="img" loading="lazy"></figure>
<p>å¾€ä¸‹æ•°ï¼Œæ•°åˆ°ç¬¬8è¡Œå€’æ•°ç¬¬å››ä¸ªï¼Œä¹Ÿå°±æ˜¯87ï¼Œä½†æ˜¯ç¬¬ä¸€è¡Œåªæœ‰9ä¸ªï¼Œé‚£å°±æ˜¯86äº†</p>
<figure data-type="image" tabindex="22"><img src="https://hualiang.online/post-images/1724637916709.png" alt="img" loading="lazy"></figure>
<p>å“ˆå“ˆå“ˆï¼Œåˆšå¥½å¯¹ä¸Šï¼Œé‚£ç°åœ¨å°±è¯´å¾—é€šäº†ï¼Œé‚£æˆ‘ä»¬å…ˆæ‹¿åˆ°æºç ï¼Œç„¶åå»æ‰¾æ˜ å°„å…³ç³»ï¼Œæ‰¾åˆ°ç´¢å¼•ä½ç½®ï¼Œå†ä»ç´¢å¼•ä½ç½®é‡Œæ‰¾åˆ°çœŸå®çš„æ–‡å­—å†…å®¹å°±è¡Œäº†ã€‚</p>
<p>ä½†æœ‰ä¸ªå¾ˆç¹ççš„ï¼Œè¿™äº›å®é™…çš„æ–‡å­—å†…å®¹ï¼Œæˆ‘ä»¬è¦ä¸€ä¸ªä¸€ä¸ªçš„æ‰‹å†™æ˜ å°„å…³ç³»ï¼ˆå“­äº†ï¼‰ï¼Œæ²¡æ³•å•Šï¼Œæ‰¾å¥½ä¹‹åï¼Œå†™æˆä¸€ä¸ª jsonï¼Œç„¶å load å§</p>
<figure data-type="image" tabindex="23"><img src="https://hualiang.online/post-images/1724638148671.png" alt="img" loading="lazy"></figure>
<h1 id="ä¸‰-è°ƒè¯•">ä¸‰ã€è°ƒè¯•</h1>
<p>å…ˆæŠŠåˆšæ‰æ‰“å¼€ç½‘é¡µæºç ï¼Œç›´æ¥copyåˆ°æœ¬åœ°ä¿å­˜æˆhtmlæ–‡ä»¶æµ‹è¯•å§ï¼Œå…å¾—ä¸€æ”¹ä»€ä¹ˆå°±è¯·æ±‚ä¸‹ï¼Œå› ä¸ºè¿™ä¸ªç«™çš„é£æ§è¿˜æŒºå¼ºçš„</p>
<p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥å¤„ç†ä¿å­˜åœ¨æœ¬åœ°çš„htmlï¼Œç„¶åæˆ‘åªæ‰“å°äº†åœ°å€ä¿¡æ¯</p>
<figure data-type="image" tabindex="24"><img src="https://hualiang.online/post-images/1724638167364.png" alt="img" loading="lazy"></figure>
<p>æ„Ÿè§‰è·Ÿåœ¨æºç é‡Œçœ‹åˆ°çš„&amp;#å¼€å¤´çš„æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œå¥½åƒç»™å¤„ç†æˆäº†ã€\uã€‘ï¼Œå…ˆçœ‹çœ‹èƒ½ä¸èƒ½å¤„ç†å§ï¼š</p>
<p>å¤åˆ¶ä¸€ä¸ª <code>['\ue2c9', '\uef20', '\ue801', '5', '\ued77', '\ue150', '42']</code> ï¼Œæ‹¿æ¥å¤„ç†ä¸‹ï¼Œ</p>
<figure data-type="image" tabindex="25"><img src="https://hualiang.online/post-images/1724638205464.png" alt="img" loading="lazy"></figure>
<p>å§æ§½ï¼Œè¿™å’‹å›äº‹ï¼Œæ‰“æ–­ç‚¹ä¸€çœ‹ï¼Œè¿™ä¸ªå‚æ•°å¹¶ä¸æ˜¯æˆ‘ä»¬é¢„æœŸçš„ï¼Œ</p>
<figure data-type="image" tabindex="26"><img src="https://hualiang.online/post-images/1724638222729.png" alt="img" loading="lazy"></figure>
<p>é‚£å¤šåŠå°±æ˜¯é‚£ä¸ªè¢«è½¬ä¹‰æˆã€\uã€‘çš„é—®é¢˜äº†ï¼Œé‚£æˆ‘ä»¬ç›´æ¥åœ¨è¯»å–å†…å®¹çš„æ—¶å€™ï¼Œç›´æ¥å°±æ›¿æ¢ä¸€ä¸‹ï¼š</p>
<figure data-type="image" tabindex="27"><img src="https://hualiang.online/post-images/1724638245820.png" alt="img" loading="lazy"></figure>
<p>æ‰§è¡Œä¸‹ï¼š</p>
<figure data-type="image" tabindex="28"><img src="https://hualiang.online/post-images/1724638266448.png" alt="img" loading="lazy"></figure>
<p>ç„¶ååŒæ ·çš„ï¼Œæ‹¿ç¬¬ä¸€ä¸ªæ¥å¤„ç†ï¼š</p>
<figure data-type="image" tabindex="29"><img src="https://hualiang.online/post-images/1724638286373.png" alt="img" loading="lazy"></figure>
<p>å®Œç¾ï¼Œè·ŸåŸç½‘ç«™çš„æ•°æ®å¯¹ä¸Š</p>
<figure data-type="image" tabindex="30"><img src="https://hualiang.online/post-images/1724638302887.png" alt="img" loading="lazy"></figure>
<p>æ¥ç€å†å¤„ç†å†…å®¹çš„ï¼Œè¿™ä¸ªå†…å®¹åŸç†ä¸€æ ·ï¼Œåªæ˜¯æŠŠwoffæ–‡ä»¶æ›¿æ¢ä¸‹å³å¯</p>
<p>æ‰“å°ä¸‹å†…å®¹çš„ï¼š</p>
<figure data-type="image" tabindex="31"><img src="https://hualiang.online/post-images/1724638321482.png" alt="img" loading="lazy"></figure>
<p>é€‰ç¬¬ä¸€ä¸ªï¼Œç„¶åæ‰§è¡Œï¼š</p>
<figure data-type="image" tabindex="32"><img src="https://hualiang.online/post-images/1724638339615.png" alt="img" loading="lazy"></figure>
<p>å¯¹æ¯”åŸç½‘ç«™ï¼š</p>
<figure data-type="image" tabindex="33"><img src="https://hualiang.online/post-images/1724638355148.png" alt="img" loading="lazy"></figure>
<p>ç„¶åï¼Œæœ‰æœ‹å‹è¦é—®äº†ï¼Œé‚£åé¢çš„emojiæ€ä¹ˆæ²¡æœ‰æå‡ºæ¥ï¼Œçœ‹çœ‹æºç å“ˆï¼š</p>
<figure data-type="image" tabindex="34"><img src="https://hualiang.online/post-images/1724638369168.png" alt="img" loading="lazy"></figure>
<p>è¿™ä¸ªemojiï¼Œæ˜¯ä¸ªå›¾ç‰‡èµ„æºï¼Œä½ è¦å¤„ç†è‚¯å®šæ˜¯å¯ä»¥çš„ï¼Œæ‹¼æ¥ä¸€ä¸‹å°±å¯ä»¥äº†</p>
<h1 id="å››-python-å®ç°">å››ã€Python å®ç°</h1>
<p>æä¸€å¥ï¼Œé‚£ä¸¤ä¸ªå­—ä½“æ–‡ä»¶ç»è¿‡æˆ‘çš„å‘ç°ï¼Œæ˜¯ä¼šä¸å®šæœŸå˜çš„ï¼Œæ‰€ä»¥ä½ éœ€è¦å»è¯·æ±‚æºç ï¼Œç”¨æ­£åˆ™åŒ¹é…æŒ‡å®šä½ç½®ï¼Œç„¶åè¯·æ±‚cssæ–‡ä»¶ï¼Œå†å»æŠŠwoffæ–‡ä»¶urlåŒ¹é…å‡ºæ¥ï¼Œå•ç‹¬è¯·æ±‚ï¼Œä¸‹è½½ä¸‹æ¥ï¼Œæ¥ç€å®Œæˆåç»­çš„å·¥ä½œå³å¯</p>
<p>æœ€åç”¨ Python å®Œæ•´å®ç°ï¼Œå®Œæ•´çš„ä»£ç å°±ä¸è´´å‡ºæ¥äº†ï¼Œåç»­çš„éƒ½æ˜¯ä¸€äº›å¸¸è§„ä¸”ç®€å•çš„æ“ä½œäº†ï¼Œå†ä¸€ä¸ªå°±æ˜¯ï¼Œæˆ‘æ ¹æœ¬å°±æ²¡å†™å®Œæ•´çš„ä»£ç ï¼ˆå“ˆå“ˆå“ˆå“ˆå“ˆï¼‰ï¼Œåªè´´å‡ºéƒ¨åˆ†ï¼š</p>
<pre><code class="language-python">from fontTools.ttLib import TTFont
import re
import requests
from lxml import etree
import json


def parser_woff_font(font='4375cf76.woff', something=None):
    font = TTFont(font)
    glyph = font.getReverseGlyphMap()
    f = open('font_template.json', encoding='utf-8')
    font_template = json.load(f)
    f.close()
    new_str = ''
    for item in something:
        if not item:
            continue
        if item.endswith(';'):
            item = item.replace(';', '')
        if item in glyph:
            index = glyph.get(item)
            if index:
                real = font_template.get(str(index))
                if real:
                    new_str += real
        else:
            new_str += item
    print(12312312, new_str)
    return new_str


def get_real_data():
    f = open('content.html', encoding='utf-8')
    source_data = f.read()
    source_data = source_data.replace('&amp;#x', 'uni')
    f.close()
    html = etree.HTML(source_data)
    data = html.xpath('//div[@class=&quot;txt J_rptlist&quot;]')
    for item in data:
        temp_dict = dict()
        shop_name = item.xpath('./div[1]/h6//text()')
        shop_addr = item.xpath('.//div[@class=&quot;mode-tc addres&quot;]/p//text()')
        shop_score = item.xpath('.//div[@class=&quot;mode-tc comm-rst&quot;]/span/@class')
        shop_comment = item.xpath('.//div[@class=&quot;mode-tc comm-entry&quot;]//text()')
        comment_photo_url = item.xpath('.//div[@class=&quot;mode-tc comm-photo&quot;]/a/@href')
        comment_photo_url = ''.join(comment_photo_url) if comment_photo_url else ''
        create_time = item.xpath('.//div[@class=&quot;mode-tc info&quot;]/span[1]/text()')
        create_time = ''.join(create_time) if create_time else ''
        if create_time:
            create_time = create_time.replace('å‘è¡¨äº', '')
        temp_dict['shop_name'] = shop_name
        temp_dict['shop_addr'] = shop_addr
        temp_dict['shop_score'] = shop_score
        temp_dict['shop_comment'] = shop_comment
        temp_dict['comment_photo_url'] = comment_photo_url
        temp_dict['create_time'] = create_time
        print(123123, temp_dict['shop_comment'])


# get_real_data()


s = ['unif1af;', 'unif147;', 'uniecc0;', 'unie635;', 'unif083;', 'unie3c5;', 'unif802;', ' ', 'unie931;', 'uniea55;', 'unif534;', 'unied79;', 'unie1bd;', ' ', 'unie1e4;', 'unie7b0;', 'unie65d;', 'unif534;', 'unie3c5;', 'unie66f;', 'unif52d;', ' ', 'unif765;', 'unif49d;', 'unieb19;', 'unie2de;', 'unie66f;', 'é—¹', 'unie8ee;', 'unie3a4;', 'unif759;', ' ', 'unif195;', 'unif195;', 'unif195;', 'unif195;']

parser_woff_font('2f66e924.woff', s)
</code></pre>
<p>é‚£ä¸ªæ˜ å°„çš„font_template.jsonæ–‡ä»¶ï¼Œ<a href="https://files.cnblogs.com/files/Eeyhan/font_template.json">ç‚¹æˆ‘</a></p>
<p>è¯´æ˜ä¸€ä¸‹ï¼Œè¿™ä¸ªjsonæ˜ å°„å…³ç³»æ˜¯åªé’ˆå¯¹è¿™ä¸€ä¸ªç«™ï¼Œå¹¶ä¸é€šç”¨ç½‘ä¸Šæ‰€æœ‰çš„å­—ä½“åçˆ¬å“ˆï¼Œè€Œä¸”ï¼Œè¿™ä¸ªç«™çš„æ˜ å°„ï¼Œè¯´ä¸å®šä»¥åè¿˜ä¼šæ”¹å˜ï¼Œæ‰€ä»¥ï¼Œä½ æ‡‚æˆ‘æ„æ€å§</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è®°ä¸€æ¬¡å¯¹ DataX å‘ ES åŒæ­¥å¯¹è±¡å‹æ•°æ®çš„æ¢ç´¢è¿‡ç¨‹]]></title>
        <id>https://hualiang.online/post/ji-yi-ci-dui-datax-xiang-es-tong-bu-dui-xiang-xing-shu-ju-de-jie-jue-guo-cheng/</id>
        <link href="https://hualiang.online/post/ji-yi-ci-dui-datax-xiang-es-tong-bu-dui-xiang-xing-shu-ju-de-jie-jue-guo-cheng/">
        </link>
        <updated>2024-08-12T08:02:10.000Z</updated>
        <summary type="html"><![CDATA[<p>ä»Šå¤©å¼€å®Œäº§å“å®¡è®®ä¼šï¼ŒLeader è¡¨ç¤ºè®©æˆ‘æ¥è´Ÿè´£å·¥ä½œå°æ¨¡å—è‡ªå®šä¹‰åœ°ç†æŸ¥è¯¢çš„åŠŸèƒ½å¼€å‘æ—¶ï¼Œå·²ç»å­¦å®Œ ES çš„åœ°ç†æŸ¥è¯¢çš„æˆ‘å½“å³è¡¨ç¤ºè«å¾—é—®é¢˜ğŸ‘Œã€‚å¯å°±åœ¨æˆ‘æƒ³å…ˆåŒæ­¥åæ ‡åœ¨å†™ä¸šåŠ¡ä»£ç æ—¶æ‰å‘ç°ï¼Œâ€œè¿™ä¸ª DataX æ€ä¹ˆåŒæ­¥å¯¹è±¡å‹æ•°æ®å˜ï¼Ÿâ€ğŸ¤”</p>
]]></summary>
        <content type="html"><![CDATA[<p>ä»Šå¤©å¼€å®Œäº§å“å®¡è®®ä¼šï¼ŒLeader è¡¨ç¤ºè®©æˆ‘æ¥è´Ÿè´£å·¥ä½œå°æ¨¡å—è‡ªå®šä¹‰åœ°ç†æŸ¥è¯¢çš„åŠŸèƒ½å¼€å‘æ—¶ï¼Œå·²ç»å­¦å®Œ ES çš„åœ°ç†æŸ¥è¯¢çš„æˆ‘å½“å³è¡¨ç¤ºè«å¾—é—®é¢˜ğŸ‘Œã€‚å¯å°±åœ¨æˆ‘æƒ³å…ˆåŒæ­¥åæ ‡åœ¨å†™ä¸šåŠ¡ä»£ç æ—¶æ‰å‘ç°ï¼Œâ€œè¿™ä¸ª DataX æ€ä¹ˆåŒæ­¥å¯¹è±¡å‹æ•°æ®å˜ï¼Ÿâ€ğŸ¤”</p>
<!-- more -->
<h1 id="ä»‹ç»">ä»‹ç»</h1>
<p>DataX æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€ä¸ªå¼‚æ„æ•°æ®æºç¦»çº¿åŒæ­¥å·¥å…·ï¼Œè‡´åŠ›äºå®ç°åŒ…æ‹¬å…³ç³»å‹æ•°æ®åº“(MySQLã€Oracleç­‰)ã€HDFSã€Hiveã€ODPSã€HBaseã€FTPç­‰å„ç§å¼‚æ„æ•°æ®æºä¹‹é—´ç¨³å®šé«˜æ•ˆçš„æ•°æ®åŒæ­¥åŠŸèƒ½ã€‚ä½¿ç”¨æ’ä»¶å¢å¼ºåŠŸèƒ½ï¼Œè¿™é‡Œæˆ‘éœ€è¦ä» MySQL åŒæ­¥æ•°æ®åˆ° ESï¼Œå°±è¦ç”¨åˆ° MySQL çš„è¾“å…¥ç«¯æ’ä»¶å’Œ ES çš„è¾“å‡ºç«¯æ’ä»¶ã€‚</p>
<h1 id="ç”¨æ³•">ç”¨æ³•</h1>
<p>è¿™é‡Œæ¼”ç¤ºä» MySQL åŒæ­¥åˆ° ESï¼ŒDataX çš„åŒæ­¥å¾ˆç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªé…ç½®è„šæœ¬å¹¶è¿è¡Œä¸‹é¢åœ°å‘½ä»¤å³å¯</p>
<pre><code>python /datax/bin/datax.py job.json
</code></pre>
<p>DataX å°±ä¼šè‡ªåŠ¨æŒ‰ç…§é…ç½®æ–‡ä»¶é‡Œçš„ä¿¡æ¯è¿æ¥å¯¹åº”æœåŠ¡è·å–å’ŒåŒæ­¥æ•°æ®ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-json">// job.json
{
  &quot;job&quot;: {
    &quot;setting&quot;: {
      &quot;speed&quot;: {
        &quot;channel&quot;: 2
      }
    },
    &quot;content&quot;: [
      {
        &quot;reader&quot;: {
          &quot;name&quot;: &quot;mysqlreader&quot;,
          &quot;parameter&quot;: {
            &quot;username&quot;: &quot;root&quot;,
            &quot;password&quot;: &quot;123456&quot;,
            &quot;connection&quot;: [
              {
                &quot;querySql&quot;: [&quot;select * from user_t&quot;],
                &quot;jdbcUrl&quot;: [&quot;jdbc:mysql://127.0.0.1:3306/db_user&quot;]
              }
            ]
          }
        },
        &quot;writer&quot;: {
          &quot;name&quot;: &quot;elasticsearchwriter&quot;,
          &quot;parameter&quot;: {
            &quot;endpoint&quot;: &quot;http://127.0.0.1:9200&quot;,
            &quot;accessId&quot;: &quot;elastic&quot;,
            &quot;accessKey&quot;: &quot;123456&quot;,
            &quot;index&quot;: &quot;user&quot;,
            &quot;column&quot;: [
              { &quot;name&quot;: &quot;pk&quot;, &quot;type&quot;: &quot;id&quot; },
              { &quot;name&quot;: &quot;col_ip&quot;, &quot;type&quot;: &quot;ip&quot; },
              { &quot;name&quot;: &quot;col_double&quot;, &quot;type&quot;: &quot;double&quot; },
              { &quot;name&quot;: &quot;col_long&quot;, &quot;type&quot;: &quot;long&quot; },
              { &quot;name&quot;: &quot;col_integer&quot;, &quot;type&quot;: &quot;integer&quot; },
              { &quot;name&quot;: &quot;col_keyword&quot;, &quot;type&quot;: &quot;keyword&quot; },
              { &quot;name&quot;: &quot;col_text&quot;, &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_max_word&quot; },
              { &quot;name&quot;: &quot;col_geo_point&quot;, &quot;type&quot;: &quot;geo_point&quot; },
              { &quot;name&quot;: &quot;col_date&quot;, &quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot; },
              { &quot;name&quot;: &quot;col_nested1&quot;, &quot;type&quot;: &quot;nested&quot; },
              { &quot;name&quot;: &quot;col_nested2&quot;, &quot;type&quot;: &quot;nested&quot; },
              { &quot;name&quot;: &quot;col_object1&quot;, &quot;type&quot;: &quot;object&quot; },
              { &quot;name&quot;: &quot;col_object2&quot;, &quot;type&quot;: &quot;object&quot; },
              { &quot;name&quot;: &quot;col_integer_array&quot;, &quot;type&quot;: &quot;integer&quot;, &quot;array&quot;: true },
              { &quot;name&quot;: &quot;col_geo_shape&quot;, &quot;type&quot;: &quot;geo_shape&quot;, &quot;tree&quot;: &quot;quadtree&quot;, &quot;precision&quot;: &quot;10m&quot; }
            ]
          }
        }
      }
    ]
  }
}
</code></pre>
<h1 id="é—®é¢˜">é—®é¢˜</h1>
<p>çœ‹èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿå¦‚æœåªæ˜¯é’ˆå¯¹æ™®é€šå­—ç¬¦ä¸²ï¼Œæ•°å­—ï¼Œæˆ–æ˜¯æ—¥æœŸå­—æ®µï¼Œé‚£ç¡®å®æ²¡å•¥é—®é¢˜ï¼Œé€šè¿‡ SQL è¯­å¥ éƒ½èƒ½æ­£ç¡®åœ°æŸ¥å‡ºå¹¶åŒæ­¥ã€‚ä½†é—®é¢˜å°±å‡ºåœ¨æœ€åä¸€ä¸ªå­—æ®µ <code>col_geo_shape</code>ï¼Œå®ƒçš„ç±»å‹æ˜¯ <code>geo_shape</code>ã€‚äº†è§£ ES çš„äººéƒ½çŸ¥é“ï¼Œè¿™æ˜¯ ES ç”¨äºåœ°ç†æŸ¥è¯¢çš„ä¸€ä¸ªé‡è¦ç±»å‹ï¼Œç”¨å®ƒæˆ‘ä»¬å¯ä»¥å®ç°åˆ¤æ–­åæ ‡å’Œåæ ‡ï¼Œåæ ‡å’ŒåŒºåŸŸä»¥åŠåŒºåŸŸå’ŒåŒºåŸŸä¹‹é—´çš„ç©ºé—´å…³ç³»ã€‚</p>
<p>ä½†é—®é¢˜æ˜¯ï¼Œåœ¨ ES ä¸­ï¼Œgeo_shape ç±»å‹çš„æ•°æ®é•¿ä¸‹é¢è¿™æ ·ï¼š</p>
<pre><code class="language-json">&quot;col_geo_shape&quot;: {
    &quot;type&quot;: &quot;point&quot;,
    &quot;coordinates&quot;: [
        108.374854,
        30.809156
    ]
}
</code></pre>
<p>æ²¡é”™ï¼Œå®ƒæ˜¯ä¸€ä¸ªéµå¾ª GeoJson æ ¼å¼çš„ Json å¯¹è±¡ï¼Œè¿™é‡Œçš„ç±»å‹é™¤äº† <code>point</code> å¤–ï¼Œè¿˜æœ‰ <code>circle</code>ï¼Œ<code>envelope</code>ï¼Œ<code>polygon</code> ç­‰ç­‰</p>
<p>å¯¹äº SQL è¯­å¥çš„æŸ¥è¯¢ç»“æœï¼Œæˆ‘ä»¬éƒ½çŸ¥é“æ˜¯ä¸€ä¸ªä¸ªå­—æ®µï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬éƒ½å¯ä»¥ä½œä¸ºå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯å¯¹åº” ES çš„ <code>keyword</code> æˆ– <code>text</code> ç±»å‹ã€‚ä½† SQL å¦‚ä½•æŸ¥å‡ºä¸€ä¸ªå¯¹è±¡ï¼Ÿ</p>
<p>æˆ‘ç›¸ä¿¡åˆ°å¤šæ•°äººçš„ç¬¬ä¸€ååº”æ‹¼å‡ºæ¥ä¸€ä¸ª json ä¸²ã€‚å¦‚æœä½ æƒ³åˆ°äº†ï¼Œé‚£ä¹ˆæ­å–œä½ ç­”å¯¹äº†ï¼å¯æƒœçš„æ˜¯ï¼Œå½“æ—¶çš„æˆ‘å¹¶æ²¡æœ‰é‚£ä¹ˆèªæ˜ï¼Œå†åŠ ä¸Šæ¯ä¸€æ¬¡æµ‹è¯•åŒæ­¥æ•°æ®éƒ½è¦ç­‰å¾ˆé•¿çš„æ—¶é—´ï¼Œæˆ‘å¯ä¸æƒ³ä¸ºäº†ä¸€ä¸ªçŒœæµ‹å»å†’è¿™ä¹ˆå¤§çš„æ—¶é—´æˆæœ¬ï¼ˆå…¶å®å°±æ˜¯æƒ³è¿½æ±‚ä¸€æ¬¡é€šè¿‡ï¼‰</p>
<p>äºæ˜¯ï¼Œæ¼«é•¿çš„æ¢ç´¢è¿‡ç¨‹å°±å¼€å§‹äº†......</p>
<h1 id="æ¢ç´¢">æ¢ç´¢</h1>
<p>åŸæœ¬æˆ‘ä»¥ä¸ºè¿™æ ·ä¸€ä¸ªå°é—®é¢˜ï¼Œå¹¿å¤§ç½‘å‹åº”è¯¥å·²ç»è¸©è¿‡å‘äº†ï¼Œå¤§ä¸äº†å®˜æ–¹æ–‡æ¡£åº”è¯¥æœ‰å†™æ€ä¹ˆç”¨å§ã€‚</p>
<p>ä½†ç›´åˆ°æˆ‘æœç´¢äº†æ— æ•°æ¬¡ï¼Œå°±æ˜¯æ²¡æœ‰æ‰¾åˆ°å‘ ES åŒæ­¥å¯¹è±¡å‹æ•°æ®çš„å…·ä½“ç¤ºä¾‹ã€‚å¤§éƒ¨åˆ†éƒ½æ˜¯åœ¨åŒæ­¥æ™®é€šç±»å‹ï¼Œå¦‚ï¼š<code>integer</code>ï¼Œ<code>date</code>ï¼Œ<code>keyword</code>ï¼Œ<code>long</code> ç­‰ç­‰ã€‚è¿˜æœ‰ä¸€äº›ä»‹ç»ä¹Ÿåªæ˜¯æäº†ä¸€å˜´èƒ½åŒæ­¥ <code>geo_shape</code> ç±»å‹ï¼Œä½†å´ä¾ç„¶æ²¡æœ‰ç»™å‡ºå…·ä½“çš„ç¤ºä¾‹ã€‚</p>
<p>è¿™æ—¶ï¼Œæˆ‘æƒ³åˆ°ï¼Œæ—¢ç„¶å®˜æ–¹æœ‰æä¾›è¿™æ ·ä¸€ä¸ªç±»å‹ï¼Œé‚£ä¹ˆä¸€å®šæœ‰åŒæ­¥å®ƒçš„åŠæ³•ã€‚æ‰€ä»¥æˆ‘å†³å®šå» GitHub æ‰¾æ‰¾<a href="https://github.com/alibaba/DataX/blob/master/elasticsearchwriter/doc/elasticsearchwriter.md">å®˜æ–¹æ–‡æ¡£</a>ã€‚ä»¤æˆ‘å¤§å¤±æ‰€æœ›çš„æ˜¯ï¼Œå®˜æ–¹ä»…æä¾›äº† ES è¾“å‡ºç«¯çš„é…ç½®ä¿¡æ¯ï¼Œæˆ‘ä»ä¸æ¸…æ¥š mysql åˆ°åº•æ€ä¹ˆåŒæ­¥å¯¹è±¡ç»™ ESã€‚</p>
<p>æœ€ç»ˆï¼Œæˆ‘å†³å®šçœ‹æºç ã€‚</p>
<h1 id="åˆ†æ">åˆ†æ</h1>
<p>ç»è¿‡ä¸€ç•ªå¯»æ‰¾ï¼Œæˆ‘æœ€ç»ˆæ‰¾åˆ°äº†ç›¸å…³çš„ä»£ç ï¼Œä½äº <a href="https://github.com/alibaba/DataX/blob/master/elasticsearchwriter/src/main/java/com/alibaba/datax/plugin/writer/elasticsearchwriter/ElasticSearchWriter.java#L301">ElasticSearchWriter.java</a> å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">// ElasticSearchWriter.java
switch (colType) {
    case STRING:
        // å…¼å®¹stringç±»å‹,ES5ä¹‹å‰ç‰ˆæœ¬
        break;
    case KEYWORD:
        // https://www.elastic.co/guide/en/elasticsearch/reference/current/tune-for-search-speed.html#_warm_up_global_ordinals
        field.put(&quot;eager_global_ordinals&quot;, jo.getBoolean(&quot;eager_global_ordinals&quot;));
        break;
    case TEXT:
        field.put(&quot;analyzer&quot;, jo.getString(&quot;analyzer&quot;));
        // ä¼˜åŒ–diskä½¿ç”¨,ä¹ŸåŒæ­¥ä¼šæé«˜indexæ€§èƒ½
        // https://www.elastic.co/guide/en/elasticsearch/reference/current/tune-for-disk-usage.html
        field.put(&quot;norms&quot;, jo.getBoolean(&quot;norms&quot;));
        field.put(&quot;index_options&quot;, jo.getBoolean(&quot;index_options&quot;));
        if(jo.getString(&quot;fields&quot;) != null) {
            field.put(&quot;fields&quot;, jo.getJSONObject(&quot;fields&quot;));
        }
        break;
    case DATE:
        if (Boolean.TRUE.equals(jo.getBoolean(&quot;origin&quot;))) {
            if (jo.getString(&quot;format&quot;) != null) {
                field.put(&quot;format&quot;, jo.getString(&quot;format&quot;));
            }
            // esåŸç”Ÿformatè¦†ç›–åŸå…ˆæ¥çš„format
            if (jo.getString(&quot;dstFormat&quot;) != null) {
                field.put(&quot;format&quot;, jo.getString(&quot;dstFormat&quot;));
            }
            if(jo.getBoolean(&quot;origin&quot;) != null) {
                columnItem.setOrigin(jo.getBoolean(&quot;origin&quot;));
            }
        } else {
            columnItem.setTimeZone(jo.getString(&quot;timezone&quot;));
            columnItem.setFormat(jo.getString(&quot;format&quot;));
        }
        break;
    case GEO_SHAPE:
        field.put(&quot;tree&quot;, jo.getString(&quot;tree&quot;));
        field.put(&quot;precision&quot;, jo.getString(&quot;precision&quot;));
        break;
    case OBJECT:
    case NESTED:
        if (jo.getString(&quot;dynamic&quot;) != null) {
            field.put(&quot;dynamic&quot;, jo.getString(&quot;dynamic&quot;));
        }
        break;
    default:
        break;
}
if (jo.containsKey(&quot;other_params&quot;)) {
    field.putAll(jo.getJSONObject(&quot;other_params&quot;));
}
</code></pre>
<p>æ³¨æ„çœ‹æœ€åä¸€ä¸ª if è¯­å¥ï¼Œå®ƒä¼šå°†é™¤å›ºå®šé…ç½®å¤–çš„å…¶ä½™å‚æ•°å½“æˆ json ä¸²è¿›è¡Œååºåˆ—åŒ–ã€‚è¿™ä¹Ÿåå®äº†ï¼Œä½ åªéœ€è¦åœ¨ SQL è¯­å¥ä¸­é€šè¿‡ <code>CONCAT</code> ç­‰å­—ç¬¦ä¸²å‡½æ•°æ‹¼å‡ºä¸€ä¸ªå­—ç¬¦ä¸²å³å¯åŒæ­¥å¯¹è±¡å‹æ•°æ®ã€‚</p>
<h1 id="ç»“å°¾">ç»“å°¾</h1>
<p>æ€»ä¹‹ï¼Œè¿™ä»¶äº‹ç»™æˆ‘çš„å¯å‘å°±æ˜¯ï¼š<strong>åœ¨è¡ŒåŠ¨å‰ä¸€å®šè¦åšå¥½å¯è¡Œæ€§åˆ†æ</strong>ï¼Œå¦åˆ™åˆ°æ—¶å€™ä»£ç å†™ä¸€åŠå‘ç°æ–¹æ³•è¡Œä¸é€šï¼Œé‚£å°±ç™½å†™äº†ğŸ¤£</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è®°ä¸€æ¬¡ Wrangler CLI åˆ›å»º Cloudflare Worker æ¨¡æ¿å¯åŠ¨å¤±è´¥åŸå› ]]></title>
        <id>https://hualiang.online/post/ji-yi-ci-wrangler-cli-chuang-jian-cloudflare-worker-mo-ban-qi-dong-shi-bai-yuan-yin/</id>
        <link href="https://hualiang.online/post/ji-yi-ci-wrangler-cli-chuang-jian-cloudflare-worker-mo-ban-qi-dong-shi-bai-yuan-yin/">
        </link>
        <updated>2024-08-04T07:46:57.000Z</updated>
        <summary type="html"><![CDATA[<p>å› ä¸ºæƒ³ç”¨ Worker API ç»‘å®š Cloudflare R2 ä¾¿äºä½¿ç”¨ï¼Œæ‰€æœ‰éµå¾ª<a href="https://developers.cloudflare.com/r2/api/workers/workers-api-usage/">å®˜æ–¹æ–‡æ¡£</a>åˆ›å»ºæ¨¡æ¿ã€‚</p>
<p>ä½†æ˜¯é‡ä¸Šäº†ä¸€ä¸ªè«åå…¶å¦™çš„ Bug æŠ¥é”™...</p>
]]></summary>
        <content type="html"><![CDATA[<p>å› ä¸ºæƒ³ç”¨ Worker API ç»‘å®š Cloudflare R2 ä¾¿äºä½¿ç”¨ï¼Œæ‰€æœ‰éµå¾ª<a href="https://developers.cloudflare.com/r2/api/workers/workers-api-usage/">å®˜æ–¹æ–‡æ¡£</a>åˆ›å»ºæ¨¡æ¿ã€‚</p>
<p>ä½†æ˜¯é‡ä¸Šäº†ä¸€ä¸ªè«åå…¶å¦™çš„ Bug æŠ¥é”™...</p>
<!-- more -->
<h1 id="æŠ¥é”™è¿‡ç¨‹">æŠ¥é”™è¿‡ç¨‹</h1>
<p>ä½¿ç”¨è„šæ‰‹æ¶åˆ›å»ºæ¨¡æ¿</p>
<pre><code class="language-shell">npm create cloudflare@latest r2-worker
</code></pre>
<p>æŒ‰æ­¥éª¤åˆ›å»ºå¥½åï¼Œè¿è¡Œ <code>npm run dev</code> é­é‡ä¸€ä¸‹æŠ¥é”™ï¼š</p>
<figure data-type="image" tabindex="1"><img src="https://hualiang.online/post-images/1722760104914.png" alt="Bug" loading="lazy"></figure>
<p>é€šè¿‡æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶è¯¦ç»†ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<pre><code>--- 2024-06-30T19:28:07.425Z debug
ğŸªµ  Writing logs to &quot;C:\Users\...\.wrangler\logs\wrangler-2024-06-30_19-28-07_302.log&quot;
---

--- 2024-06-30T19:28:07.425Z debug
Failed to load .env file &quot;.env&quot;: Error: ENOENT: no such file or directory, open 'C:\Cycles of Seasons\100 - Virtues\110 - Demiourgia\test-wrangler\hello-world-js\.env'
    at Object.openSync (node:fs:573:18)
    at Object.readFileSync (node:fs:452:35)
    at tryLoadDotEnv (C:\...\test-wrangler\hello-world-js\node_modules\wrangler\wrangler-dist\cli.js:158768:72)
    at loadDotEnv (C:\...\test-wrangler\hello-world-js\node_modules\wrangler\wrangler-dist\cli.js:158777:12)
    at C:\...\test-wrangler\hello-world-js\node_modules\wrangler\wrangler-dist\cli.js:202740:20
    at C:\...\test-wrangler\hello-world-js\node_modules\wrangler\wrangler-dist\cli.js:162911:16
    at maybeAsyncResult (C:\...\test-wrangler\hello-world-js\node_modules\wrangler\wrangler-dist\cli.js:161132:44)
    at C:\...\test-wrangler\hello-world-js\node_modules\wrangler\wrangler-dist\cli.js:162910:14
    at C:\...\test-wrangler\hello-world-js\node_modules\wrangler\wrangler-dist\cli.js:161119:22
    at Array.reduce (&lt;anonymous&gt;) {
  errno: -4058,
  code: 'ENOENT',
  syscall: 'open',
  path: 'C:\\...\\test-wrangler\\hello-world-js\\.env'
}
---

--- 2024-06-30T19:28:07.432Z log

 â›…ï¸ wrangler 3.62.0
[38;2;255;136;0m-------------------[39m

---

--- 2024-06-30T19:28:07.450Z debug
Metrics dispatcher: Posting data {&quot;type&quot;:&quot;event&quot;,&quot;name&quot;:&quot;run dev&quot;,&quot;properties&quot;:{&quot;local&quot;:true,&quot;usesTypeScript&quot;:false}}
---

--- 2024-06-30T19:28:07.455Z debug
Failed to load .env file &quot;C:\...\test-wrangler\hello-world-js\.dev.vars&quot;: Error: ENOENT: no such file or directory, open 'C:\...\test-wrangler\hello-world-js\.dev.vars'
    at Object.openSync (node:fs:573:18)
    at Object.readFileSync (node:fs:452:35)
    at tryLoadDotEnv (C:\...\test-wrangler\hello-world-js\node_modules\wrangler\wrangler-dist\cli.js:158768:72)
    at loadDotEnv (C:\...\test-wrangler\hello-world-js\node_modules\wrangler\wrangler-dist\cli.js:158777:12)
    at getVarsForDev (C:\...\test-wrangler\hello-world-js\node_modules\wrangler\wrangler-dist\cli.js:200152:18)
    at getBindings (C:\...\test-wrangler\hello-world-js\node_modules\wrangler\wrangler-dist\cli.js:207740:10)
    at getBindingsAndAssetPaths (C:\...\test-wrangler\hello-world-js\node_modules\wrangler\wrangler-dist\cli.js:207621:20)
    at getDevReactElement (C:\...\test-wrangler\hello-world-js\node_modules\wrangler\wrangler-dist\cli.js:207276:40)
    at startDev (C:\...\test-wrangler\hello-world-js\node_modules\wrangler\wrangler-dist\cli.js:207343:60)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  errno: -4058,
  code: 'ENOENT',
  syscall: 'open',
  path: 'C:\\...\\test-wrangler\\hello-world-js\\.dev.vars'
}
---

--- 2024-06-30T19:28:07.571Z log
[2mâ” Starting local server...[22m
---

--- 2024-06-30T19:28:07.580Z debug
*** Received structured exception #0xc0000005: access violation; stack: 7ffcf4ed2f57 7ff7e9e1643b 7ff7e9e16503 7ff7e9e0588c 7ff7e9e05837 7ff7e9649c1e 7ff7e9649f2f 7ff7e8531ad6 7ff7e85318ba 7ff7e97cb6ef 7ff7e97d28a6 7ff7e97cbc0c 7ff7e97d28a6 7ff7e97c957c 7ff7e8521551 7ff7eaf00f7f 7ffd07c2257c 7ffd0824af27
---

--- 2024-06-30T19:28:07.632Z debug
*** Received structured exception #0xc0000005: access violation; stack: 7ffcf4ed2f57 7ff7e9e1643b 7ff7e9e16503 7ff7e9e0588c 7ff7e9e05837 7ff7e9649c1e 7ff7e9649f2f 7ff7e8531ad6 7ff7e85318ba 7ff7e97cb6ef 7ff7e97d28a6 7ff7e97cbc0c 7ff7e97d28a6 7ff7e97c957c 7ff7e8521551 7ff7eaf00f7f 7ffd07c2257c 7ffd0824af27
---
</code></pre>
<p>æ˜æ˜¾å¯ä»¥çœ‹åˆ°å› ç¼ºå°‘ <code>.env</code> å’Œ <code>.dev.vars</code> æŠ¥é”™ï¼Œä½†è¿™ä¸æ˜¯é‡ç‚¹ï¼Œå³ä½¿æ·»åŠ äº†æ–‡ä»¶ä¾æ—§æŠ¥é”™ã€‚</p>
<p>é—®é¢˜å‡ºåœ¨è¿™ï¼š</p>
<pre><code>--- 2024-06-30T19:28:07.580Z debug
*** Received structured exception #0xc0000005: access violation; stack: 7ffcf4ed2f57 7ff7e9e1643b 7ff7e9e16503 7ff7e9e0588c 7ff7e9e05837 7ff7e9649c1e 7ff7e9649f2f 7ff7e8531ad6 7ff7e85318ba 7ff7e97cb6ef 7ff7e97d28a6 7ff7e97cbc0c 7ff7e97d28a6 7ff7e97c957c 7ff7e8521551 7ff7eaf00f7f 7ffd07c2257c 7ffd0824af27
---

--- 2024-06-30T19:28:07.632Z debug
*** Received structured exception #0xc0000005: access violation; stack: 7ffcf4ed2f57 7ff7e9e1643b 7ff7e9e16503 7ff7e9e0588c 7ff7e9e05837 7ff7e9649c1e 7ff7e9649f2f 7ff7e8531ad6 7ff7e85318ba 7ff7e97cb6ef 7ff7e97d28a6 7ff7e97cbc0c 7ff7e97d28a6 7ff7e97c957c 7ff7e8521551 7ff7eaf00f7f 7ffd07c2257c 7ffd0824af27
---
</code></pre>
<p>è¿™ä¸ªæŠ¥é”™æœ‰ç‚¹ä¸æ˜æ‰€ä»¥ï¼Œåªèƒ½å»å®˜æ–¹ Github ä»“åº“ <a href="https://github.com/cloudflare/workers-sdk">woker-sdk</a> ä¸‹çš„ issues å¯»æ‰¾è§£å†³æ–¹æ³•ã€‚</p>
<h1 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h1>
<p>ç»è¿‡ä¸€ç•ªæŸ¥æ‰¾ï¼Œæœ€ç»ˆåœ¨ <a href="https://github.com/cloudflare/workers-sdk/issues/6170">#6170</a> ä¸‹æ‰¾åˆ°äº†è§£å†³æ–¹æ³•ã€‚</p>
<p>è¯¥æŠ¥é”™å¯èƒ½æ˜¯ç”±äºç”µè„‘çš„ Microsoft Visual C++ ä¸ wrangler çš„ä¾èµ–åŒ…ç‰ˆæœ¬ä¸å…¼å®¹å¯¼è‡´çš„ï¼Œå¤§å¤šå‘ç”Ÿåœ¨ Windows 11 ç³»ç»Ÿï¼Œæ‰€ä»¥æœ‰ä¸¤ç§è§£å†³æ–¹æ³•ã€‚</p>
<hr>
<h2 id="ä½¿ç”¨æ›´ä½ç‰ˆæœ¬çš„-wrangler">ä½¿ç”¨æ›´ä½ç‰ˆæœ¬çš„ wrangler</h2>
<p>ç»æµ‹è¯•ï¼Œä½¿ç”¨ 3.57.1 ç‰ˆæœ¬çš„ wranglerï¼Œå¯ä»¥æ­£å¸¸è¿è¡Œã€‚å¯ä»¥ç›´æ¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥é™çº§ï¼š</p>
<pre><code class="language-shell">npm uninstall wrangler &amp;&amp; npm install wrangler@3.57.1 -D
</code></pre>
<p>ä¸è¿‡è¯¥æ–¹æ³•æŒ‡æ ‡ä¸æ²»æœ¬ï¼Œåªèƒ½ç”¨äºä¸´æ—¶åº”æ€¥ï¼Œä¸å¤ªæ¨èã€‚</p>
<hr>
<h2 id="æ›´æ–°-microsoft-visual-c-åˆ°æœ€æ–°ç‰ˆæœ¬">æ›´æ–° Microsoft Visual C++ åˆ°æœ€æ–°ç‰ˆæœ¬</h2>
<p>wrangler å¼•ç”¨çš„æ˜¯ä¸‹é¢ä¸¤ä¸ªç‰ˆæœ¬çš„åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ›´æ–°å®ƒä»¬å³å¯ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://hualiang.online/post-images/1722759393446.png" alt="Microsoft Visual C++" loading="lazy"></figure>
<p>å›¾ä¸­æ˜¯ wrangler èƒ½å¤Ÿæ­£å¸¸è¿è¡Œçš„ç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯æˆ‘ç°åœ¨çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå»ºè®®æ›´æ–°æ—¶é€‰æ‹©è¯¥ç‰ˆæœ¬åŠä»¥ä¸Šç‰ˆæœ¬ã€‚</p>
<p>è¿™é‡Œæ¨èç›´æ¥å»â€œ<a href="https://learn.microsoft.com/zh-cn/cpp/windows/latest-supported-vc-redist?view=msvc-170#latest-microsoft-visual-c-redistributable-version">å®˜æ–¹ä¸‹è½½åœ°å€</a>â€ä¸‹è½½æœ€æ–°è½¯ä»¶åŒ…æ›´æ–°ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ElasticSearch å®ç°åœ°ç†ä½ç½®æœç´¢]]></title>
        <id>https://hualiang.online/post/elasticsearch-java-api-shi-xian-di-li-wei-zhi-cha-xun/</id>
        <link href="https://hualiang.online/post/elasticsearch-java-api-shi-xian-di-li-wei-zhi-cha-xun/">
        </link>
        <updated>2024-08-03T02:34:55.000Z</updated>
        <summary type="html"><![CDATA[<p>æœ€è¿‘ï¼Œå®ä¹ æ—¶æ¶‰åŠåˆ°äº†åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºå®¢æˆ·é”šç‚¹çš„éœ€æ±‚ï¼Œæƒ³åˆ° ES æœ‰è¿™ä¹ˆä¸ªåŠŸèƒ½å¯ä»¥ç”¨ï¼Œä¾¿æƒ³æ¥è¯•è¯•ã€‚ä½†ç½‘ä¸Šçš„æ•™ç¨‹å¤ªå°‘äº†ï¼Œæˆ‘è‡ªå·±ä¹Ÿæ˜¯ç¢ç£¨åŠç‚¹æ‰çœ‹æ‡‚çš„ï¼Œåœ¨æ­¤åˆ†äº«ä¸€ä¸‹ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æœ€è¿‘ï¼Œå®ä¹ æ—¶æ¶‰åŠåˆ°äº†åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºå®¢æˆ·é”šç‚¹çš„éœ€æ±‚ï¼Œæƒ³åˆ° ES æœ‰è¿™ä¹ˆä¸ªåŠŸèƒ½å¯ä»¥ç”¨ï¼Œä¾¿æƒ³æ¥è¯•è¯•ã€‚ä½†ç½‘ä¸Šçš„æ•™ç¨‹å¤ªå°‘äº†ï¼Œæˆ‘è‡ªå·±ä¹Ÿæ˜¯ç¢ç£¨åŠç‚¹æ‰çœ‹æ‡‚çš„ï¼Œåœ¨æ­¤åˆ†äº«ä¸€ä¸‹ã€‚</p>
<!-- more -->
<h1 id="åˆ›å»ºæ˜ å°„å’Œæ–‡æ¡£">åˆ›å»ºæ˜ å°„å’Œæ–‡æ¡£</h1>
<p>ES çš„åœ°ç†ä½ç½®ç±»å‹åˆ†ä¸º <code>geo_point</code> å’Œ <code>geo_shape</code> ä¸¤ç§ã€‚å‰è€…è¡¨ç¤ºä¸€ä¸ªåœ°å›¾ä¸Šçš„ç‚¹ï¼Œå³åæ ‡ï¼›åè€…åˆ™è¡¨ç¤ºå¤šä¸ªç‚¹æ¡†å‡ºçš„ä¸€ç¯‡åŒºåŸŸã€‚åŠŸèƒ½ä¸Šè®²ï¼Œåè€…çš„åŠŸèƒ½æ›´å¼ºã€‚</p>
<p>æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªå¸¦æœ‰è¿™ä¸¤ç§ç±»å‹çš„ç´¢å¼•æ˜ å°„ï¼š</p>
<pre><code class="language-json">{
    &quot;properties&quot;: {
        &quot;location&quot;: {
            &quot;type&quot;: &quot;geo_point&quot;
        },
        &quot;area&quot;: {
            &quot;type&quot;: &quot;geo_shape&quot;
        }
    }
}
</code></pre>
<h2 id="geo_point">geo_point</h2>
<p>å¯¹äº geo_point ç±»å‹æ’å…¥æ–‡æ¡£å¾ˆç®€å•ï¼Œæœ‰ä¸‰ç§æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-json">&quot;location&quot;: &quot;34.247232,108.945872&quot; // ç¬¬ä¸€ç§ï¼Œç›´æ¥æ’å…¥è¯¥æ ¼å¼çš„å­—ç¬¦ä¸²

&quot;location&quot;: [108.945872, 34.247232] // ç¬¬äºŒç§ï¼Œå¯ä»¥ç”¨æ•°ç»„ [lon, lat] çš„å½¢å¼è¡¨ç¤º

&quot;location&quot;: { // ç¬¬ä¸‰ç§ï¼Œä»¥å¯¹è±¡å½¢å¼æ’å…¥
    &quot;lat&quot;: 34.247232,
    &quot;lon&quot;: 108.945872
}
</code></pre>
<h2 id="geo_shape">geo_shape</h2>
<p>å¯¹äº geo_shape ç±»å‹æ’å…¥æ–‡æ¡£è¾ƒå¤æ‚ï¼Œå› ä¸ºå®ƒæœ‰å¾ˆå¤šå­ç±»å‹ï¼Œå¦‚ï¼Œ<code>point</code>ï¼Œ<code>circle</code>ï¼Œ<code>envelope</code>ï¼Œ<code>linestring</code>ï¼Œ<code>polygon</code>ï¼Œ<code>multipoint</code>ï¼Œ<code>multilinestring</code>ï¼Œ<code>multipolygon</code> ç­‰ã€‚</p>
<p>ä¸‹é¢å°±ä»‹ç»å‡ ç§å¸¸ç”¨çš„ç±»å‹ï¼š</p>
<pre><code class="language-json">&quot;area&quot;: {
    &quot;type&quot;: &quot;point&quot;, // ç‚¹
    &quot;coordinates&quot;: [108.945872, 34.247232]
}

&quot;area&quot;: {
    &quot;type&quot;: &quot;circle&quot;, // åœ†
    &quot;radius&quot;: &quot;10km&quot;,
    &quot;coordinates&quot;: [-74.0059, 40.7128]
}

&quot;area&quot;: {
    &quot;type&quot;: &quot;envelope&quot;, // çŸ©å½¢
    &quot;coordinates&quot; : [
        [108.945872, 34.247232],
        [108.374854, 30.809156]
    ]
}

&quot;area&quot;: {
    &quot;type&quot;: &quot;linestring&quot;, // çº¿ï¼Œè‡³å°‘ä¸¤ä¸ªç‚¹
    &quot;coordinates&quot;: [
        [108.945872, 34.247232],
        [108.374854, 30.809156],
        [108.378368, 30.809938]
    ]
}

&quot;area&quot;: {
    &quot;type&quot;: &quot;polygon&quot;, // å°é—­å¤šè¾¹å½¢ï¼Œå…¶é¦–ç‚¹å’Œæœ«ç‚¹å¿…é¡»åŒ¹é…ï¼Œæœ€å°‘éœ€è¦ 4 ä¸ªé¡¶ç‚¹
    &quot;coordinates&quot;: [
        [ // ç¬¬ä¸€ä¸ªå¤šè¾¹å½¢ï¼Œä½œä¸ºä¸»ä½“
            [-77.03653, 38.897676],
            [-77.03653, 37.897676],
            [-76.03653, 38.897676],
            [-77.03653, 38.997676],
            [-77.03653, 38.897676]
        ]
        // è‹¥å­˜åœ¨ç¬¬äºŒä¸ªåŠä»¥åçš„å¤šè¾¹å½¢ï¼Œåˆ™ä½œä¸ºä¸»ä½“ä¸­çš„â€œæ´â€ï¼Œæ’é™¤ä¸»ä½“ä¸­ä¸éœ€è¦åŒ…å«çš„é¢ç§¯
    ]
}
</code></pre>
<p>å…¶ä½™çš„ multi ç±»å‹å°±æ˜¯åœ¨å¤–å›´å¤šåŠ ä¸€ä¸ªä¸­æ‹¬å·å³å¯ã€‚</p>
<h1 id="åœ°ç†ä½ç½®æœç´¢">åœ°ç†ä½ç½®æœç´¢</h1>
<p>geo_point çš„æŸ¥è¯¢æ–¹å¼ä¸ geo_shape ä¸åŒï¼Œä¸¤è€…å¸¸ç”¨çš„æŸ¥è¯¢æ–¹å¼æœ‰åŠå¾„ï¼ŒçŸ©å½¢å’Œå¤šè¾¹å½¢æŸ¥è¯¢ã€‚ä½† geo_shape æŸ¥è¯¢å¯ä»¥å…¼å®¹ geo_point ç±»å‹ï¼Œè€Œä¸” geo_shape ä¸ä»…å¯ä»¥æœç´¢é€‰å®šåŒºåŸŸçš„ç‚¹ï¼Œè¿˜å¯ä»¥æœç´¢åŒºåŸŸï¼ŒæŸ¥è¯¢çš„ç©ºé—´å…³ç³»å¦‚ä¸‹ï¼š</p>
<ul>
<li>INTERSECTS -ï¼ˆé»˜è®¤ï¼‰è¿”å›å…¶ geo_shape æˆ– geo_point å­—æ®µä¸æŸ¥è¯¢å‡ ä½•ç›¸äº¤çš„æ‰€æœ‰æ–‡æ¡£ã€‚</li>
<li>DISJOINT - è¿”å›å…¶ geo_shape æˆ– geo_point å­—æ®µä¸æŸ¥è¯¢å‡ ä½•æ²¡æœ‰å…±åŒç‚¹çš„æ‰€æœ‰æ–‡æ¡£ã€‚</li>
<li>WITHIN - è¿”å›å…¶ geo_shape æˆ– geo_point å­—æ®µåœ¨æŸ¥è¯¢å‡ ä½•å†…çš„æ‰€æœ‰æ–‡æ¡£ã€‚ ä¸æ”¯æŒçº¿å‡ ä½•ã€‚</li>
<li>CONTAINS - è¿”å›å…¶ geo_shape æˆ– geo_point å­—æ®µåŒ…å«æŸ¥è¯¢å‡ ä½•çš„æ‰€æœ‰æ–‡æ¡£ã€‚</li>
</ul>
<h2 id="åŠå¾„æœç´¢">åŠå¾„æœç´¢</h2>
<p>geo_point çš„åŠå¾„æœç´¢å°±æ˜¯åœ¨åœ°å›¾ä¸Šæ ‡å®šä¸€ä¸ªä¸­å¿ƒç‚¹ï¼Œå†æ ‡å‡ºåŠå¾„ï¼ŒæŸ¥è¯¢åœ¨è¿™ä¸ªåœ†å†…çš„åæ ‡ç‚¹ã€‚</p>
<pre><code class="language-json">{
    &quot;query&quot;: {
        &quot;geo_distance&quot;: {
            &quot;distance&quot;: &quot;500km&quot;, // åŠå¾„ï¼Œå¯ä»¥é™„å¸¦å•ä½
            &quot;location&quot;: { // ä¸­å¿ƒç‚¹ï¼Œæ­¤å¤„ä½¿ç”¨çš„æ˜¯ç¬¬ä¸‰ç§å†™æ³•
                &quot;lat&quot;: &quot;38.993443&quot;,
                &quot;lon&quot;: &quot;117.158558&quot;
            }
        }
    }
}
</code></pre>
<p>geo_shape ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œä¸è¿‡å®ƒè·Ÿæ’å…¥æ–‡æ¡£æ—¶çš„æ ¼å¼ä¸€æ ·ã€‚</p>
<pre><code class="language-json">{
    &quot;query&quot;: {
        &quot;geo_shape&quot;: {
            &quot;location&quot;: {
                &quot;shape&quot;: {
                    &quot;type&quot;: &quot;circle&quot;,
                    &quot;radius&quot;: &quot;10km&quot;,
                    &quot;coordinates&quot;: [-74.0059, 40.7128]
                }
            }
        }
    }
}
</code></pre>
<h2 id="çŸ©å½¢æœç´¢">çŸ©å½¢æœç´¢</h2>
<p>geo_point çš„çŸ©å½¢æœç´¢åªè¦ç»™å‡ºå·¦ä¸Šè§’å’Œå³ä¸‹è§’ä¸¤ä¸ªåæ ‡å³å¯ã€‚</p>
<pre><code class="language-json">{
    &quot;query&quot;: {
        &quot;geo_bounding_box&quot;: {
          &quot;location&quot;: {
            &quot;top_left&quot;: {
              &quot;lat&quot;: 47.7328,
              &quot;lon&quot;: -122.448
            },
            &quot;bottom_right&quot;: {
              &quot;lat&quot;: 47.468,
              &quot;lon&quot;: -122.0924
            }
          }
        }
    }
}
</code></pre>
<p>geo_shape ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œä¸è¿‡å®ƒè·Ÿæ’å…¥æ–‡æ¡£æ—¶çš„æ ¼å¼ä¸€æ ·ã€‚</p>
<pre><code class="language-json">{
    &quot;query&quot;: {
        &quot;geo_shape&quot;: {
            &quot;location&quot;: {
                &quot;shape&quot;: {
                    &quot;type&quot;: &quot;envelope&quot;, // çŸ©å½¢
                    &quot;coordinates&quot; : [
                        [108.945872, 34.247232],
                        [108.374854, 30.809156]
                    ]
                }
            }
        }
    }
}
</code></pre>
<h2 id="å¤šè¾¹å½¢æœç´¢">å¤šè¾¹å½¢æœç´¢</h2>
<p>geo_point çš„å¤šè¾¹å½¢æœç´¢éœ€è¦ç»™å‡ºç»„æˆå¤šè¾¹å½¢çš„æ‰€æœ‰è¾¹ç•Œç‚¹ã€‚</p>
<pre><code class="language-json">{
    &quot;query&quot;: {
        &quot;geo_polygon&quot;: {  
          &quot;location&quot;: {  
            &quot;points&quot; : [  
              {&quot;lat&quot; : 40, &quot;lon&quot; : -70},  
              {&quot;lat&quot; : 30, &quot;lon&quot; : -80},  
              {&quot;lat&quot; : 20, &quot;lon&quot; : -90}  
            ]  
          }  
        } 
    }
}
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šgeo_point çš„å¤šè¾¹å½¢ï¼Œå…¶é¦–ç‚¹å’Œæœ«ç‚¹æ˜¯æ— éœ€åŒ¹é…çš„ï¼Œè€Œ geo_shape çš„å¿…é¡»è¦åŒ¹é…ã€‚</p>
<p>geo_shape ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œä¸è¿‡å®ƒè·Ÿæ’å…¥æ–‡æ¡£æ—¶çš„æ ¼å¼ä¸€æ ·ã€‚</p>
<pre><code class="language-json">{
    &quot;query&quot;: {
        &quot;geo_shape&quot;: {
            &quot;location&quot;: {
                &quot;shape&quot;: {
                    &quot;type&quot;: &quot;polygon&quot;,
                    &quot;coordinates&quot;: [
                        [
                            [-77.03653, 38.897676],
                            [-77.03653, 37.897676],
                            [-76.03653, 38.897676],
                            [-77.03653, 38.997676],
                            [-77.03653, 38.897676]
                        ]
                    ]
                }
            }
        }
    }
}
</code></pre>
<h1 id="java-api-å®ç°åœ°ç†ä½ç½®æœç´¢">Java API å®ç°åœ°ç†ä½ç½®æœç´¢</h1>
<p>ElasticSearch æä¾›äº†ä¸€å¥— API ç»™ Java ç”¨äºæ“ä½œï¼Œéœ€è¦å¼•å…¥ä¸‹é¢çš„ä¾èµ–ï¼š</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;
    &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt;
    &lt;version&gt;7.15.2&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>å› ä¸ºä¸šåŠ¡åœºæ™¯ä¸­ï¼ŒES ä¸­çš„æ•°æ®å¤§å¤šæ˜¯ä»å…¶ä»–æ•°æ®æºåŒæ­¥è¿‡æ¥çš„ï¼Œè€Œéç”¨ Java æ‰‹åŠ¨åˆ›å»ºï¼Œæ‰€ä»¥ä¸‹é¢ä»…ä»‹ç»å¦‚ä½•å®ç°åœ°ç†ä½ç½®æœç´¢ã€‚</p>
<p>é¦–å…ˆï¼Œæ­å»ºå¥½æ¡†æ¶ï¼Œä¾¿äºæµ‹è¯•:</p>
<pre><code class="language-java">@SuppressWarnings(&quot;deprecation&quot;)
public class ESTest_Doc_Geo_Query {

    public static final double[][][][] coordinates = {
        {
            {
                { 116.53, 39.67 },
                { 117.05, 39.67 },
                { 116.39, 39.42 },
                { 117.48, 39.16 },
                { 116.53, 39.67 }
            }
        },
        {
            {
                { 116.53, 39.67 },
                { 117.05, 39.67 },
                { 116.39, 39.42 },
                { 117.48, 39.16 },
                { 116.53, 39.67 }
            }
        }
    };

    public static void main(String[] args) {
        RestClientBuilder builder = RestClient.builder(new HttpHost(&quot;127.0.0.1&quot;, 9200, &quot;http&quot;));
        try (RestHighLevelClient client = new RestHighLevelClient(builder)) {
            // æ¥ä¸‹æ¥ï¼Œåªéœ€è¦è°ƒç”¨ä¸åŒçš„æ–¹æ³•å°±è¡Œå®ç°ä¸åŒçš„æœç´¢
            QueryBuilder geoShapeQuery = geoShapePolygonQuery(coordinates);

            BoolQueryBuilder boolQuery = QueryBuilders.boolQuery().must(QueryBuilders.matchAllQuery())
                    .filter(geoShapeQuery);
            SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder().query(boolQuery);
            SearchRequest request = new SearchRequest().indices(&quot;geo&quot;).source(searchSourceBuilder);
            SearchResponse response = client.search(request, RequestOptions.DEFAULT);
            SearchHits hits = response.getHits();

            System.out.println(response.getTook());

            for (SearchHit hit : hits) {
                System.out.println(hit.getSourceAsString());
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

}
</code></pre>
<p>å› ä¸ºåŠå¾„æœç´¢å’Œå¤šè¾¹å½¢æœç´¢æ›´å¸¸ç”¨ï¼Œæ‰€ä»¥å°±ä¸ä»‹ç»çŸ©å½¢æœç´¢äº†ï¼Œæ„Ÿå…´è¶£è‡ªè¡Œæœç´¢ã€‚</p>
<h2 id="åŠå¾„æœç´¢-2">åŠå¾„æœç´¢</h2>
<p>æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªæ–¹æ³• <code>geoPointCircleQuery</code>ï¼Œ<code>geoShapeCircleQuery</code> æ¥ä»£è¡¨ä¸¤ç§ç±»å‹çš„æœç´¢ï¼š</p>
<pre><code class="language-java">public static GeoDistanceQueryBuilder geoPointCircleQuery(String name, double lon, double lat, String distance) {
    return QueryBuilders.geoDistanceQuery(name).distance(distance).point(lat, lon);
}

public static GeoShapeQueryBuilder geoShapeCircleQuery(String name, double lon, double lat, double radius) throws IOException {
    return QueryBuilders.geoIntersectionQuery(name, new Circle(lon, lat, radius * 1000));
}
</code></pre>
<p>geo_point çš„æ¯ç§æœç´¢éƒ½ä¼šæœ‰ä¸€ä¸ªä¸“é—¨çš„ Builder ç±»ï¼Œè€Œ geo_shape åªæœ‰ä¸€ç§ã€‚</p>
<p><code>geoIntersectionQuery</code> ç­‰ä»·äº ä½¿ç”¨ <code>builder.relation(ShapeRelation.INTERSECTS)</code> è®¾ç½®ç©ºé—´å…³ç³»ä¸º<strong>ç›¸äº¤</strong>çš„ <code>geoShapeQuery</code>ã€‚åŒç†ï¼Œå…¶ä½™å…³ç³»ä¹Ÿæœ‰ä¸“é—¨çš„æŸ¥è¯¢ç±»ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©æ‰‹åŠ¨è®¾ç½®ã€‚</p>
<h2 id="å¤šè¾¹å½¢æœç´¢-2">å¤šè¾¹å½¢æœç´¢</h2>
<p>åŒä¸Šï¼Œè¿˜æ˜¯å°è£…ä¸¤ä¸ªæ–¹æ³•å®ç°ï¼š</p>
<pre><code class="language-java">public static GeoPolygonQueryBuilder geoPointPolygonQuery(String name, double[][] points) {
    List&lt;GeoPoint&gt; geoPoints = Arrays.stream(points).map(point -&gt; new GeoPoint(point[1], point[0]))
            .collect(Collectors.toList());
    return QueryBuilders.geoPolygonQuery(name, geoPoints);
}

public static GeoShapeQueryBuilder geoShapePolygonQuery(String name, double[][] points) throws IOException {
    double[] lat = Arrays.stream(points).mapToDouble(point -&gt; point[1]).toArray();
    double[] lon = Arrays.stream(points).mapToDouble(point -&gt; point[0]).toArray();
    return QueryBuilders.geoIntersectionQuery(name, new Polygon(new LinearRing(lon, lat)));
}
</code></pre>
<p><code>LinearRing</code> ä»£è¡¨ä¸€ä¸ªé—­åˆçš„çº¿ï¼Œä»…ä½œä¸ºåˆ›å»º <code>Polygon</code> çš„è¾¹ç•Œï¼Œä¸èƒ½ç›´æ¥åº”ç”¨äºæœç´¢ã€‚</p>
<p><em>p.s. <code>Polygon</code> è¿˜æä¾›äº† <code>Polygon(LinearRing polygon, List&lt;LinearRing&gt; holes)</code> çš„æ„é€ æ–¹æ³•æ¥åˆ›å»ºå…·æœ‰â€œæ´â€çš„å¤šè¾¹å½¢ã€‚</em></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¦‚ä½•ç”¨è¶…æ˜Ÿäº‘ç›˜åšå¤–é“¾ç›´é“¾]]></title>
        <id>https://hualiang.online/post/ru-he-yong-chao-xing-yun-pan-zuo-wai-lian-zhi-lian/</id>
        <link href="https://hualiang.online/post/ru-he-yong-chao-xing-yun-pan-zuo-wai-lian-zhi-lian/">
        </link>
        <updated>2024-06-29T04:56:19.000Z</updated>
        <summary type="html"><![CDATA[<p>è½¬è‡ªä¸ªäººåšå®¢ â€œ<a href="https://zxz.ee">å°è¨€u</a>â€ çš„<a href="https://zxz.ee/100.html">ã€Šç”¨è¶…æ˜Ÿäº‘ç›˜åšå¤–é“¾ç›´é“¾ã€‹</a></p>
]]></summary>
        <content type="html"><![CDATA[<p>è½¬è‡ªä¸ªäººåšå®¢ â€œ<a href="https://zxz.ee">å°è¨€u</a>â€ çš„<a href="https://zxz.ee/100.html">ã€Šç”¨è¶…æ˜Ÿäº‘ç›˜åšå¤–é“¾ç›´é“¾ã€‹</a></p>
<!-- more -->
<h1 id="æ³¨æ„">æ³¨æ„</h1>
<p>ä»…æ˜¯å°è¯•é˜¶æ®µï¼Œå…·ä½“ä»€ä¹ˆæ—¶å€™ä¼šæ—¶æ•ˆæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œä»…ä¾›å‚è€ƒä½¿ç”¨ï¼Œå¦‚æœæƒ³è¦çœŸæ­£çš„æŠ•å…¥åˆ°æ—¥å¸¸ä½¿ç”¨è¿˜æ˜¯å»ºè®®é€‰æ‹©è´­ä¹°å¯¹è±¡å­˜å‚¨ã€‚</p>
<h1 id="å›¾ç‰‡æ–¹æ³•æ­¥éª¤">å›¾ç‰‡æ–¹æ³•æ­¥éª¤</h1>
<p>â‘  æ‰“å¼€è¶…æ˜Ÿäº‘ç›˜ç½‘å€ï¼šhttp://pan-yz.chaoxing.com/ è¿›è¡Œç™»å…¥</p>
<p>â‘¡ éšä¾¿ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡ -&gt; åŒå‡»é¢„è§ˆ -&gt; å³é”® -&gt; åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€ -&gt; å¤åˆ¶æ–°æ ‡ç­¾é¡µä¸­çš„å›¾ç‰‡ç½‘å€</p>
<figure data-type="image" tabindex="1"><a href="https://p.itxe.net/images/2022/11/14/cx1.gif"><img src="https://p.itxe.net/images/2022/11/14/cx1.gif" alt="img" loading="lazy"></a></figure>
<p>å¤åˆ¶å‡ºæ¥çš„ç½‘å€ï¼š<code>https://imageproxy.chaoxing.com/0x0,q15,jpeg,soE2Z31QoUXrtu-Pp15uwU6Lyr-Jk4wc01pXMqFqLG_I/http://p.ananas.chaoxing.com/star3/origin/093846f84d5608bb6d995a8828f4eb8b.png</code></p>
<p>ä½ ä¼šå‘ç°å›¾ç‰‡è¢«å‹ç¼©äº†ï¼Œæ¥ä¸‹æ¥è¿›è¡ŒçœŸå®å›¾ç‰‡ç›´é“¾æå–ã€‚</p>
<p>åœ¨å¤åˆ¶å‡ºæ¥çš„é“¾æ¥å°¾éƒ¨é‡Œæ‰¾åˆ°ç±»ä¼¼äº <code>https://p.ananas.chaoxing.com/XXXXXXXX</code> ä¸Šé¢çš„é“¾æ¥é‡Œçš„å°±æ˜¯ï¼š<code>https://p.ananas.chaoxing.com/star3/origin/093846f84d5608bb6d995a8828f4eb8b.png</code></p>
<p>è¿™ä¸ªé“¾æ¥å°±æ˜¯å›¾ç‰‡ç›´é“¾äº†ï¼Œè€Œä¸”æ˜¯æ²¡æœ‰è¢«å‹ç¼©è¿‡çš„åŸå›¾</p>
<h1 id="è§†é¢‘æ–¹æ³•æ­¥éª¤">è§†é¢‘æ–¹æ³•æ­¥éª¤</h1>
<p>ä¸Šä¼ é‚£äº›æ“ä½œæˆ‘å°±ä¸é˜è¿°äº†ï¼Œç›´æ¥å¼€å§‹æå–æ­¥éª¤ã€‚</p>
<p>ç‚¹å‡»è§†é¢‘æ–‡ä»¶è¿›è¡Œé¢„è§ˆï¼Œç„¶åæŒ‰F12å®¡æŸ¥å…ƒç´  -&gt; æ•æ‰å‡ºè§†é¢‘çš„çœŸå®é“¾æ¥</p>
<figure data-type="image" tabindex="2"><a href="https://p.itxe.net/images/2022/11/14/cx2.gif"><img src="https://p.itxe.net/images/2022/11/14/cx2.gif" alt="img" loading="lazy"></a></figure>
<p>å¤åˆ¶å‡ºæ¥çš„è§†é¢‘ç›´é“¾ç½‘å€ï¼š<code>https://s1.ananas.chaoxing.com/video/51/6e/5d/c13198119fd05ddc7c7966b6c20b7af7/sd.mp4?at_=1605929018942&amp;ak_=d8b1f503f6ba01b1f60995a2e38471f9&amp;ad_=e794ddb198db30558298ddbc8c564b2a</code></p>
<p>ç„¶ååˆ é™¤è¿™æ¡é“¾æ¥é‡Œçš„æ²¡ç”¨ä¿¡æ¯ï¼š<code>sd.mp4</code> åé¢çš„ï¼Œå¹¶å°†å‰é¢çš„ <code>s1.ananas</code> æ”¹ä¸º <code>s138.ananas</code>ã€‚</p>
<p>åˆ é™¤æ— ç”¨ä¿¡æ¯åçš„é“¾æ¥ï¼š<code>https://s138.ananas.chaoxing.com/video/51/6e/5d/c13198119fd05ddc7c7966b6c20b7af7/sd.mp4</code></p>
<h1 id="æ–‡ä»¶æ–¹æ³•æ­¥éª¤">æ–‡ä»¶æ–¹æ³•æ­¥éª¤</h1>
<p>txtã€zipã€7zç­‰æ ¼å¼æ— æ³•ç›´æ¥åœ¨æµè§ˆå™¨é¢„è§ˆçš„æ–‡ä»¶ç›´é“¾æå–æ–¹æ³•</p>
<p>éœ€ä½¿ç”¨IDMé…åˆæå–ï¼Œå°†IDMæ•æ‰æ–‡ä»¶ç±»å‹ä¸­åŠ å…¥è‡ªå·±æƒ³è¦æå–çš„æ–‡ä»¶æ ¼å¼åç¼€ï¼Œå¹¶ç‚¹å‡»ä¸‹è½½ï¼Œå°±ä¼šå¼¹å‡ºä¸‹è½½æç¤ºæ¡†</p>
<figure data-type="image" tabindex="3"><a href="https://p.itxe.net/images/2022/11/14/cx3.png"><img src="https://p.itxe.net/images/2022/11/14/cx3.png" alt="img" loading="lazy"></a></figure>
<figure data-type="image" tabindex="4"><a href="https://p.itxe.net/images/2022/11/14/cx4.gif"><img src="https://p.itxe.net/images/2022/11/14/cx4.gif" alt="img" loading="lazy"></a></figure>
<p>å¤åˆ¶å‡ºæ¥çš„é“¾æ¥ï¼š<code>https://d0.ananas.chaoxing.com/download/270d7c5a4776acf040a285208c52934f?fn=Test</code>ï¼Œ<code>?fn=</code> åé¢çš„æ˜¯æ–‡ä»¶å</p>
<h1 id="æå–çš„ç›´é“¾æ•´åˆ">æå–çš„ç›´é“¾æ•´åˆ</h1>
<p>å›¾ç‰‡ï¼š<code>https://p.ananas.chaoxing.com/star3/origin/093846f84d5608bb6d995a8828f4eb8b.png</code></p>
<p>è§†é¢‘ï¼š<code>https://s138.ananas.chaoxing.com/video/51/6e/5d/c13198119fd05ddc7c7966b6c20b7af7/sd.mp4</code></p>
<p>æ–‡ä»¶ï¼š<code>https://d0.ananas.chaoxing.com/download/270d7c5a4776acf040a285208c52934f?fn=Test</code></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Git æäº¤è§„èŒƒ]]></title>
        <id>https://hualiang.online/post/git-ti-jiao-gui-fan/</id>
        <link href="https://hualiang.online/post/git-ti-jiao-gui-fan/">
        </link>
        <updated>2024-06-17T14:59:48.000Z</updated>
        <summary type="html"><![CDATA[<p>ç»å¸¸çœ‹åˆ°åˆ«äººæäº¤çš„ä»£ç è®°å½•é‡Œé¢åŒ…å«ä¸€äº›featã€fixã€choreç­‰ç­‰ï¼Œè€Œæˆ‘åœ¨æäº¤æ—¶ä¹Ÿä¸ä¼šåŒºåˆ†ä»€ä¹ˆï¼Œç›´æ¥å†™ä¸‹æäº¤ä¿¡æ¯ï¼Œä»Šå¤©å°±æ¥çœ‹ä¸€ä¸‹æ€ä¹ˆä¸ªäº‹ï¼Œå°±æ‹¿ element-plus ä¸¾ä¾‹æ¥çœ‹ä¸€ä¸‹</p>
]]></summary>
        <content type="html"><![CDATA[<p>ç»å¸¸çœ‹åˆ°åˆ«äººæäº¤çš„ä»£ç è®°å½•é‡Œé¢åŒ…å«ä¸€äº›featã€fixã€choreç­‰ç­‰ï¼Œè€Œæˆ‘åœ¨æäº¤æ—¶ä¹Ÿä¸ä¼šåŒºåˆ†ä»€ä¹ˆï¼Œç›´æ¥å†™ä¸‹æäº¤ä¿¡æ¯ï¼Œä»Šå¤©å°±æ¥çœ‹ä¸€ä¸‹æ€ä¹ˆä¸ªäº‹ï¼Œå°±æ‹¿ element-plus ä¸¾ä¾‹æ¥çœ‹ä¸€ä¸‹</p>
<!-- more -->
<p>å…¶å®è¿™ä¹ˆå†™æ˜¯ä¸€ç§ä»£ç æäº¤è§„èŒƒï¼Œå½“ç„¶ä¸æ˜¯ä¸ºäº†ç‚«æŠ€ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æé«˜æäº¤è®°å½•çš„å¯è¯»æ€§å’Œè‡ªåŠ¨åŒ–å¤„ç†èƒ½åŠ›ã€‚å½“ç„¶å¦‚æœå›¢é˜Ÿæ²¡æœ‰è¦æ±‚ï¼Œä¸è¿™ä¹ˆå†™ä¹Ÿå¯ä»¥ã€‚</p>
<pre><code>commit message = subject + ï¼š+ ç©ºæ ¼ + message ä¸»ä½“
</code></pre>
<p>å¸¸è§çš„ subject ç§ç±»ä»¥åŠå«ä¹‰å¦‚ä¸‹ï¼š</p>
<ol>
<li>feat: æ–°åŠŸèƒ½ï¼ˆfeatureï¼‰
<ul>
<li>ç”¨äºæäº¤æ–°åŠŸèƒ½ã€‚</li>
<li>ä¾‹å¦‚ï¼šfeat: å¢åŠ ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½</li>
</ul>
</li>
<li>fix: ä¿®å¤ bug
<ul>
<li>ç”¨äºæäº¤ bug ä¿®å¤ã€‚</li>
<li>ä¾‹å¦‚ï¼šfix: ä¿®å¤ç™»å½•é¡µé¢å´©æºƒçš„é—®é¢˜</li>
</ul>
</li>
<li>docs: æ–‡æ¡£å˜æ›´
<ul>
<li>ç”¨äºæäº¤ä»…æ–‡æ¡£ç›¸å…³çš„ä¿®æ”¹ã€‚</li>
<li>ä¾‹å¦‚ï¼šdocs: æ›´æ–°READMEæ–‡ä»¶</li>
</ul>
</li>
<li>style: ä»£ç é£æ ¼å˜åŠ¨ï¼ˆä¸å½±å“ä»£ç é€»è¾‘ï¼‰
<ul>
<li>ç”¨äºæäº¤ä»…æ ¼å¼åŒ–ã€æ ‡ç‚¹ç¬¦å·ã€ç©ºç™½ç­‰ä¸å½±å“ä»£ç è¿è¡Œçš„å˜æ›´ã€‚</li>
<li>ä¾‹å¦‚ï¼šstyle: åˆ é™¤å¤šä½™çš„ç©ºè¡Œ</li>
</ul>
</li>
<li>refactor: ä»£ç é‡æ„ï¼ˆæ—¢ä¸æ˜¯æ–°å¢åŠŸèƒ½ä¹Ÿä¸æ˜¯ä¿®å¤bugçš„ä»£ç æ›´æ”¹ï¼‰
<ul>
<li>ç”¨äºæäº¤ä»£ç é‡æ„ã€‚</li>
<li>ä¾‹å¦‚ï¼šrefactor: é‡æ„ç”¨æˆ·éªŒè¯é€»è¾‘</li>
</ul>
</li>
<li>perf: æ€§èƒ½ä¼˜åŒ–
<ul>
<li>ç”¨äºæäº¤æå‡æ€§èƒ½çš„ä»£ç ä¿®æ”¹ã€‚</li>
<li>ä¾‹å¦‚ï¼šperf: ä¼˜åŒ–å›¾ç‰‡åŠ è½½é€Ÿåº¦</li>
</ul>
</li>
<li>test: æ·»åŠ æˆ–ä¿®æ”¹æµ‹è¯•
<ul>
<li>ç”¨äºæäº¤æµ‹è¯•ç›¸å…³çš„å†…å®¹ã€‚</li>
<li>ä¾‹å¦‚ï¼štest: å¢åŠ ç”¨æˆ·æ¨¡å—çš„å•å…ƒæµ‹è¯•</li>
</ul>
</li>
<li>chore: æ‚é¡¹ï¼ˆæ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨ï¼‰
<ul>
<li>ç”¨äºæäº¤æ„å»ºè¿‡ç¨‹ã€è¾…åŠ©å·¥å…·ç­‰ç›¸å…³çš„å†…å®¹ä¿®æ”¹ã€‚</li>
<li>ä¾‹å¦‚ï¼šchore: æ›´æ–°ä¾èµ–åº“</li>
</ul>
</li>
<li>build: æ„å»ºç³»ç»Ÿæˆ–å¤–éƒ¨ä¾èµ–é¡¹çš„å˜æ›´
<ul>
<li>ç”¨äºæäº¤å½±å“æ„å»ºç³»ç»Ÿçš„æ›´æ”¹ã€‚</li>
<li>ä¾‹å¦‚ï¼šbuild: å‡çº§webpackåˆ°ç‰ˆæœ¬5</li>
</ul>
</li>
<li>ci: æŒç»­é›†æˆé…ç½®çš„å˜æ›´
<ul>
<li>ç”¨äºæäº¤CIé…ç½®æ–‡ä»¶å’Œè„šæœ¬çš„ä¿®æ”¹ã€‚</li>
<li>ä¾‹å¦‚ï¼šci: ä¿®æ”¹GitHub Actionsé…ç½®æ–‡ä»¶</li>
</ul>
</li>
<li>revert: å›æ»š
<ul>
<li>ç”¨äºæäº¤å›æ»šä¹‹å‰çš„æäº¤ã€‚</li>
<li>ä¾‹å¦‚ï¼šrevert: å›æ»šfeat: å¢åŠ ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½</li>
</ul>
</li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[DelayQueue å®ç°ä¸´æ—¶ä¸Šä¼ æ–‡ä»¶çš„è¿‡æœŸå®šæ—¶æ¸…ç†]]></title>
        <id>https://hualiang.online/post/delayqueue-shi-xian-lin-shi-shang-chuan-wen-jian-de-ding-shi-qing-li/</id>
        <link href="https://hualiang.online/post/delayqueue-shi-xian-lin-shi-shang-chuan-wen-jian-de-ding-shi-qing-li/">
        </link>
        <updated>2024-06-07T12:49:03.000Z</updated>
        <summary type="html"><![CDATA[<p>å­¦é™¢çš„æ™ºæ…§å…šå»ºé¡¹ç›®è¦å®ç°å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼Œä¸ºäº†è§£å†³å›¾ç‰‡ä¸´æ—¶ä¸Šä¼ åçš„æ¸…ç†é—®é¢˜ï¼Œè€ƒè™‘åˆ°æ•°æ®é‡ä¸å¤§ï¼Œæˆ‘æƒ³åˆ°äº†ç”¨ Java çš„ DelayQueue å»¶è¿Ÿé˜Ÿåˆ—æ¥å¤„ç†ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>å­¦é™¢çš„æ™ºæ…§å…šå»ºé¡¹ç›®è¦å®ç°å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼Œä¸ºäº†è§£å†³å›¾ç‰‡ä¸´æ—¶ä¸Šä¼ åçš„æ¸…ç†é—®é¢˜ï¼Œè€ƒè™‘åˆ°æ•°æ®é‡ä¸å¤§ï¼Œæˆ‘æƒ³åˆ°äº†ç”¨ Java çš„ DelayQueue å»¶è¿Ÿé˜Ÿåˆ—æ¥å¤„ç†ã€‚</p>
<!-- more -->
<h1 id="éœ€æ±‚åˆ†æ">éœ€æ±‚åˆ†æ</h1>
<p>å‰ç«¯åœ¨ç¼–è¾‘å™¨é‡Œç¼–è¾‘æ–‡ç« æ—¶ï¼Œæœ‰æ—¶éœ€è¦ä¸Šä¼ æœ¬åœ°å›¾ç‰‡ï¼Œå¦‚ä¸‹ï¼š</p>
<figure data-type="image" tabindex="1"><img src="https://hualiang.online/post-images/1717766874461.png" alt="1" loading="lazy"></figure>
<p>ä¸Šä¼ å›¾ç‰‡ï¼š</p>
<figure data-type="image" tabindex="2"><img src="https://hualiang.online/post-images/1717767213521.png" alt="2" loading="lazy"></figure>
<p>è¦æ±‚ï¼š</p>
<ol>
<li>ä¸Šä¼ åˆ°åç«¯åï¼Œåç«¯éœ€è¦è¿”å›ä¸€ä¸ªå¯è®¿é—®çš„ URL é“¾æ¥ç»™å‰ç«¯ç”¨æ¥åœ¨æ–‡ç« ä¸­å¼•ç”¨</li>
<li>ä¸´æ—¶ä¸Šä¼ åˆ°åç«¯çš„å›¾ç‰‡è‹¥ä¸€å®šæ—¶é—´å†…æœªè¢«ä»»ä½•æ–‡ç« å¼•ç”¨ï¼Œéœ€è¦å®šæ—¶æ¸…ç†</li>
</ol>
<h1 id="æŠ€æœ¯é€‰å‹">æŠ€æœ¯é€‰å‹</h1>
<p>è¯´åˆ°å®šæ—¶ä»»åŠ¡ï¼Œé¦–å…ˆæƒ³åˆ°ä¸¤ç§æ–¹æ¡ˆï¼š</p>
<ol>
<li>SpringBoot æä¾›çš„å®šæ—¶ä»»åŠ¡å®ç°</li>
<li>Java æä¾›çš„å»¶è¿Ÿé˜Ÿåˆ—æ¥å®ç°</li>
</ol>
<p>è€ƒè™‘åˆ°è¯¥é¡¹ç›®åŸæœ¬å°±æ˜¯åœ¨å­¦é™¢å†…ä½¿ç”¨ï¼Œæ•°æ®é‡ä¸å¤§ã€‚è€Œä¸”å®šæ—¶ä»»åŠ¡æ—¶æ•ˆæ€§å·®ï¼Œä¸èƒ½é’ˆå¯¹å•ç‹¬æ–‡ä»¶è¿›è¡Œè®¡æ—¶ï¼Œæ•…é€‰æ‹©ç¬¬äºŒç§æ–¹æ¡ˆã€‚</p>
<h1 id="ä»£ç å®ç°">ä»£ç å®ç°</h1>
<p>å»¶è¿Ÿé˜Ÿåˆ—å®ç°çš„æ€è·¯è¿˜æ˜¯å¾ˆç®€å•çš„ï¼š</p>
<p>å°†ä¸´æ—¶ä¸Šä¼ çš„å›¾ç‰‡éƒ½æ”¾å…¥é˜Ÿåˆ—ä¸­å¹¶è®¾ç½®å¥½è¿‡æœŸæ—¶é—´ï¼Œä¸€æ—¦å›¾ç‰‡è¿‡æœŸå°±ä»é˜Ÿåˆ—ä¸­å–å‡ºå¹¶åˆ é™¤ã€‚å¦‚æœåœ¨è¿‡æœŸå‰æœ‰æ–‡ç« å¼•ç”¨äº†è¯¥å›¾ç‰‡ï¼Œé‚£ä¹ˆä»é˜Ÿåˆ—ä¸­å°†å…¶åˆ é™¤å³å¯ã€‚</p>
<h2 id="ttlfile">TTLFile</h2>
<p>æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªè¿‡æœŸæ–‡ä»¶ç±» <code>TTLFile</code> å®ç° <code>Delayed</code> æ¥å£ï¼Œè¿™é‡Œæˆ‘ä»¬å®šä¹‰çš„æ˜¯æŠ½è±¡ç±»ï¼Œå®ç°ä¸€äº›åŸºç¡€åŠŸèƒ½ï¼Œç•™ä¸‹ä¸€äº›å…³é”®åŠŸèƒ½ï¼Œå¦‚ <code>clean()</code> æ–¹æ³•ï¼Œä¾¿äºåç»­æ‹“å±•åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œç”¨äºæ¸…ç†æœ¬åœ°æ–‡ä»¶çš„ <code>LocalFile</code>ï¼Œæˆ–æ˜¯å­˜å‚¨åœ¨ Minio ä¸Šçš„ <code>MinioFile</code></p>
<pre><code class="language-java">package com.dangjian.clean;

import java.util.concurrent.Delayed;
import java.util.concurrent.TimeUnit;

import lombok.Getter;
// å»¶è¿Ÿé˜Ÿåˆ—ä¸­çš„å…ƒç´ éƒ½éœ€è¦å®ç° Delayed æ¥å£æ¥åˆ¤æ–­è¿‡æœŸæ—¶é—´
public abstract class TTLFile implements Delayed {

    protected final String uuid;

    protected long ttl; // è¿‡æœŸæ—¶é—´

    @Getter
    protected int failedCount = 0; // ä»»åŠ¡å¤±è´¥æ¬¡æ•°

    public TTLFile(String uuid, long delay) {
        this.uuid = uuid;
        this.ttl = System.currentTimeMillis() + delay;
    }

    /**
     * æŸ¥çœ‹å½“å‰ä»»åŠ¡è¿˜æœ‰å¤šä¹…åˆ°æœŸ
     * 
     * @param unit
     * @return å‰©ä½™æ—¶é—´
     */
    @Override
    public long getDelay(TimeUnit unit) {
        return unit.convert(ttl - System.currentTimeMillis(), TimeUnit.MILLISECONDS);
    }

    /**
     * å»¶è¿Ÿé˜Ÿåˆ—éœ€è¦åˆ°æœŸæ—¶é—´å‡åºå…¥é˜Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®ç°compareToè¿›è¡Œåˆ°æœŸæ—¶é—´æ¯”è¾ƒ
     * 
     * @param delayed
     * @return æ¯”è¾ƒç»“æœ
     */
    @Override
    public int compareTo(Delayed delayed) {
        return Long.compare(this.ttl, ((TTLFile) delayed).ttl);
    }

    /**
     * åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å¤±è´¥
     * 
     * @return æ˜¯å¦å¤±è´¥
     */
    public boolean isFailed() {
        return ++failedCount &gt;= 3;
    }

    /**
     * å»¶æ—¶
     */
    public void delay(long delay) {
        ttl = System.currentTimeMillis() + delay;
    }

    @Override
    public int hashCode() {
        final int prime = 31;
        int result = 1;
        result = prime * result + ((uuid == null) ? 0 : uuid.hashCode());
        return result;
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj)
            return true;
        if (obj == null)
            return false;
        if (getClass() != obj.getClass())
            return false;
        TTLFile other = (TTLFile) obj;
        if (uuid == null) {
            if (other.uuid != null)
                return false;
        } else if (!uuid.equals(other.uuid))
            return false;
        return true;
    }

    /**
     * æ¸…ç†æ–‡ä»¶
     * 
     * @return æ˜¯å¦æ¸…ç†æˆåŠŸ
     */
    public abstract boolean clean();

    /**
     * è·å–æ–‡ä»¶è·¯å¾„
     * 
     * @return æ–‡ä»¶è·¯å¾„
     */
    public abstract String getPath();

}
</code></pre>
<p>æ³¨æ„ï¼šè¿™é‡Œé‡å†™çš„ <code>hashCode()</code> å’Œ <code>equal()</code> åªå°† <code>uuid</code> ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œå› ä¸ºè¦æƒ³ä»å»¶è¿Ÿé˜Ÿåˆ—ä¸­ç§»é™¤å…ƒç´ ï¼Œæˆ‘ä»¬å°±å¿…é¡»ä¼ å…¥ä¸€ä¸ªç­‰ä»·çš„å…ƒç´ æ‰è¡Œã€‚å°† <code>uuid</code> ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œåˆ°æ—¶å€™ç§»é™¤å…ƒç´ åªéœ€è¦ä¼ å…¥ä¸€ä¸ªå…·æœ‰ç›¸åŒ <code>uuid</code> çš„å¯¹è±¡å®ä¾‹å³å¯ã€‚</p>
<p><em>p.s. ä¸€èˆ¬æƒ…å†µï¼Œæ–‡ä»¶çš„å­˜å‚¨è·¯å¾„éƒ½æ˜¯å”¯ä¸€çš„ï¼Œå¯ä»¥ç”¨æ¥ä½œä¸º uuid</em></p>
<h2 id="localfile">LocalFile</h2>
<p>å› ä¸ºä¸€å¼€å§‹è¯¥é¡¹ç›®å¹¶æœªä½¿ç”¨ Minio è¿™ç§ä¸“é—¨çš„æ–‡ä»¶å­˜å‚¨æœåŠ¡ï¼Œç›´æ¥å°†æ–‡ä»¶å­˜åœ¨æœ¬åœ°ï¼Œæ‰€ä»¥æˆ‘å…ˆå®ç°çš„æ˜¯æ¸…ç†æœ¬åœ°æ–‡ä»¶çš„åŠŸèƒ½ã€‚</p>
<p>å¾—ç›ŠäºæŠ½è±¡ç±»å·²ç»å®ç°äº†ä¸€äº›åŸºæœ¬åŠŸèƒ½ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç° <code>clean()</code> å’Œ <code>getPath()</code> å³å¯ã€‚</p>
<pre><code class="language-java">package com.dangjian.clean;

import java.io.File;

public class LocalFile extends TTLFile {

    // ä»»åŠ¡
    private File file;

    public LocalFile(String uuid, String path, long delay) {
        super(uuid, delay);
        this.file = new File(path);
    }

    /**
     * åˆ é™¤æ–‡ä»¶
     * 
     * @return æ˜¯å¦æ¸…ç†æˆåŠŸ
     */
    @Override
    public boolean clean() {
        return file.exists() ? file.delete() : true;
    }

    /**
     * è·å–æ–‡ä»¶è·¯å¾„
     * 
     * @return æ–‡ä»¶è·¯å¾„
     */
    @Override
    public String getPath() {
        return file.getPath();
    }

}
</code></pre>
<p>å†…ç½®ä¸€ä¸ª <code>File</code> ç±»ç”¨æ¥æ“ä½œæ–‡ä»¶ï¼Œ<code>clean()</code> ä¹Ÿæ˜¯åˆ¤æ–­æ–‡ä»¶å­˜åœ¨åç›´æ¥åˆ é™¤ï¼Œå®ç°èµ·æ¥å¹¶ä¸éš¾ã€‚</p>
<p>è¿™æ ·ä¸€ä¸ªå®šæ—¶æ¸…ç†æœ¬åœ°æ–‡ä»¶çš„ç±»å°±å†™å¥½äº†~</p>
<h2 id="cleaner">Cleaner</h2>
<p>æ ¹æ®ä¹‹å‰çš„æ€è·¯ï¼Œè¦æƒ³ä»å»¶è¿Ÿé˜Ÿåˆ—é‡Œä¸æ–­å–å‡ºè¿‡æœŸå…ƒç´ åˆ é™¤ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªåå°çº¿ç¨‹å¼‚æ­¥è·å–é˜Ÿåˆ—ä¸­çš„å…ƒç´ ï¼Œè€Œä¸”éœ€è¦åœ¨ SpringBoot ä¸€å¯åŠ¨å°±è¦å¼€å§‹æ‰§è¡Œã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨ SpringBoot æä¾›çš„ <code>ApplicationRunner</code> æ¥å£æ¥å®ç°ã€‚</p>
<p>åœ¨ SpringBoot åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œæœ‰æ—¶æˆ‘ä»¬éœ€è¦æ‰§è¡Œä¸€äº›ç‰¹å®šçš„ä»»åŠ¡ï¼Œå¦‚åŠ è½½é…ç½®ã€å»ºç«‹è¿æ¥ç­‰ã€‚SpringBoot æä¾›äº† <code>ApplicationRunner</code> æ¥å£ï¼Œå…è®¸æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºå®Œå…¨å¯åŠ¨åæ‰§è¡Œè‡ªå®šä¹‰çš„é€»è¾‘ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡å®ç°è¯¥æ¥å£æ¥å®šä¹‰ä¸€ä¸ªâ€œæ¸…æ´å·¥â€</p>
<pre><code class="language-java">package com.dangjian.clean;

import org.springframework.boot.ApplicationArguments;
import org.springframework.boot.ApplicationRunner;
import org.springframework.stereotype.Component;

import com.dangjian.utils.FileUtil;

import lombok.extern.slf4j.Slf4j;

import java.time.LocalTime;
import java.util.List;
import java.util.concurrent.DelayQueue;

@Slf4j
@Component
public class Cleaner implements ApplicationRunner {

    private DelayQueue&lt;TTLFile&gt; cleanQueue = new DelayQueue&lt;&gt;();

    public void addTask(TTLFile ttlFile) {
        cleanQueue.add(ttlFile);
    }

    public void addTask(List&lt;TTLFile&gt; ttlFile) {
        cleanQueue.addAll(ttlFile);
    }

    public boolean removeTask(TTLFile ttlFile) {
        return cleanQueue.remove(ttlFile);
    }

    public boolean removeTask(List&lt;TTLFile&gt; ttlFile) {
        return cleanQueue.removeAll(ttlFile);
    }

    @Override
    public void run(ApplicationArguments args) {
        Thread thread = new Thread(() -&gt; {
            while (true) {
                try {
                    TTLFile ttlFile = cleanQueue.take();
                    if (ttlFile.clean()) {
                        log.info(&quot;æˆåŠŸæ¸…ç†ï¼š{}&quot;, ttlFile.getPath());
                    } else {
                        if (ttlFile.isFailed()) {
                            log.error(&quot;æ¸…ç†å¤±è´¥ï¼Œæ–‡ä»¶è·¯å¾„ï¼š{}&quot;, ttlFile.getPath());
                            String info = String.format(&quot;[%s] - æ¸…ç†å¤±è´¥ï¼Œæ–‡ä»¶è·¯å¾„ï¼š%s&quot;, LocalTime.now(), ttlFile.getPath());
                            FileUtil.writeLog(FileUtil.getCurrentPath(), info);
                        } else {
                            log.warn(&quot;æ¸…ç†å¤±è´¥ï¼Œé‡è¯•æ¬¡æ•°ï¼š{}ï¼Œæ–‡ä»¶è·¯å¾„ï¼š{}&quot;, ttlFile.getFailedCount(), ttlFile.getPath());
                            ttlFile.delay(60000); // 1åˆ†é’Ÿåé‡è¯•
                            cleanQueue.put(ttlFile);
                        }
                    }
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        });
        thread.setName(&quot;Cleaner&quot;);
        thread.start();
    }

}
</code></pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å†…ç½®äº†ä¸€ä¸ªå»¶è¿Ÿé˜Ÿåˆ—ï¼Œè¿˜å®šä¹‰äº†ä¸€äº›å¾€é˜Ÿåˆ—é‡Œæ·»åŠ å®šæ—¶ä»»åŠ¡çš„æ–¹æ³•ã€‚</p>
<p>å…¶ä¸­ï¼Œåœ¨é‡å†™çš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥åˆ›å»ºä¸€ä¸ªæ­»å¾ªç¯çš„çº¿ç¨‹ä¸æ–­ä»é˜Ÿåˆ—ä¸­æå–ä»»åŠ¡ï¼Œè¿™é‡Œè°ƒç”¨çš„æ˜¯å»¶è¿Ÿé˜Ÿåˆ—çš„ <code>take()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨é˜Ÿåˆ—ä¸­æ²¡æœ‰å¯ä»¥å–å‡ºçš„è¿‡æœŸå…ƒç´ æ—¶ï¼Œä¼šé˜»å¡æ¶ˆè´¹è€…ï¼Œç›´åˆ°æœ‰å…ƒç´ è¿‡æœŸã€‚æ‰€ä»¥å¹¶ä¸ä¼šè¿‡å¤šæŸè€— CPU èµ„æºã€‚</p>
<p>å¯¹äºæ¸…ç†å¤±è´¥çš„æƒ…å†µï¼Œè¿˜ä¼šé€šè¿‡ <code>TTLFile</code> å†…å«çš„è®¡æ•°å­—æ®µæ¥é‡è¯• 3 æ¬¡æ¸…ç†æ“ä½œã€‚è‹¥ä¾æ—§ä¸æˆåŠŸï¼Œåˆ™è¯¥æŠ¥é”™æŠ¥é”™ï¼Œè¯¥å†™æ—¥å¿—å†™æ—¥å¿—ã€‚</p>
<h1 id="å®æˆ˜">å®æˆ˜</h1>
<p>åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œæœ‰ä¸€ä¸ªä¸“é—¨çš„ä¸´æ—¶ä¸Šä¼ æ–‡ä»¶æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¥æ”¶æ–‡ä»¶åå°†å…¶åŠ å…¥åˆ°é˜Ÿåˆ—é‡Œã€‚</p>
<pre><code class="language-java">@Operation(summary = &quot;ä¸´æ—¶ä¸Šä¼ æ–‡ä»¶&quot;)
@PostMapping(&quot;/upload&quot;)
public Result upload(@Parameter(description = &quot;ä¸Šä¼ çš„æ–‡ä»¶&quot;) @RequestPart MultipartFile file) {
    Optional.ofNullable(file).orElseThrow(() -&gt; new CustomException(&quot;ä¸Šä¼ æ–‡ä»¶ä¸ºç©ºï¼&quot;));

    String tempPath = FileUtil.tempUpload(file);
    String uuid = UUID.randomUUID().toString();
    redisTemplate.opsForValue().set(uuid, tempPath, 10, TimeUnit.MINUTES);
    
    // å°†ä¸´æ—¶è·¯å¾„ä½œä¸ºå”¯ä¸€æ ‡è¯†
    cleaner.addTask(new LocalFile(tempPath, 10 * 60 * 1000)); // 10åˆ†é’Ÿååˆ é™¤

    log.info(&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œä¸´æ—¶è·¯å¾„ï¼š{}&quot;, tempPath);
    return Result.ok(uuid);
}
</code></pre>
<p><em>p.s. Cleaner å¸¦æœ‰ @Component æ³¨è§£ï¼Œå¯ç›´æ¥æ³¨å…¥</em></p>
<p>è€Œå½“æˆ‘ä»¬å¼•ç”¨ä¸´æ—¶æ–‡ä»¶ï¼Œéœ€è¦å°†ä»–ä»é˜Ÿåˆ—ä¸­ç§»é™¤æ—¶ï¼Œåªéœ€è¦ç”¨ç›¸åŒçš„è·¯å¾„ä½œä¸ºè¡¨ç¤ºä¼ å…¥ä¸€ä¸ªæ–°å¯¹è±¡å³å¯ã€‚</p>
<p>ä¸‹é¢çš„ä»£ç æ˜¯ç”¨æ¥è®¾ç½®æ”¯éƒ¨æ´»åŠ¨é™„ä»¶ï¼Œé™„ä»¶å·²ç»ä¸´æ—¶ä¸Šä¼ åˆ°åç«¯äº†</p>
<pre><code class="language-java">@Override
public void setActivityFile(String actId, Activity activity) {
    // é€šè¿‡æ´»åŠ¨ ID ä» Redis é‡Œæ‹¿åˆ°é¢„å…ˆå­˜åœ¨é‡Œé¢çš„ä¸´æ—¶è·¯å¾„
    String path = redisTemplate.opsForValue().getAndDelete(actId);
    if (StringUtils.hasLength(path) &amp;&amp; cleaner.removeTask(new LocalFile(path, 1000))) { // ä¼ å…¥ä¸€ä¸ªå…·æœ‰ç›¸åŒä¸´æ—¶è·¯å¾„çš„å¯¹è±¡æ¥åˆ é™¤é˜Ÿåˆ—ä¸­çš„ä¸´æ—¶æ–‡ä»¶
        Optional.ofNullable(activity.getFile()).ifPresent(FileUtil::delete);
        activity.setFile(path);
    } else {
        throw new CustomException(&quot;ä¸´æ—¶ä¸Šä¼ çš„æ´»åŠ¨æ–‡ä»¶å·²è¿‡æœŸï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼&quot;);
    }
}
</code></pre>
<p>ç»æµ‹è¯•ï¼Œåœ¨ä¸å‡ºç° <code>IOException</code> çš„æƒ…å†µä¸‹ï¼Œåªè¦æå‰å°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—ï¼Œä¸€æ—¦åˆ°æœŸï¼Œä¸´æ—¶ä¸Šä¼ çš„æ–‡ä»¶å°±èƒ½è¢«æˆåŠŸåˆ é™¤ã€‚</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>æ¸…ç†æ–‡ä»¶æ—¶è®°å¾—åšå¥½å¼‚å¸¸å¤„ç†ä»¥åŠå›æ»šæœºåˆ¶ï¼Œé˜²æ­¢æ¸…ç†å¤±è´¥åæœªå°†ä»»åŠ¡é‡æ–°æ·»åŠ å›é˜Ÿåˆ—å¯¼è‡´åƒåœ¾æ–‡ä»¶å †ç§¯ã€‚</p>
<p>å»¶è¿Ÿé˜Ÿåˆ—åº•å±‚ä½¿ç”¨çš„æ— ç•Œé˜Ÿåˆ—ï¼ŒåŸºäº JVM å†…å­˜ï¼Œæ•°æ®é‡å°‘çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•ç®€å•ä¸”ä½¿ç”¨ã€‚è‹¥åœ¨ä¼ä¸šçº§åœºæ™¯ä¸‹ï¼Œå¯èƒ½æ›´å¤šçš„ä¼šä½¿ç”¨åƒ Kafkaï¼ŒRocketMQ è¿™ç§é«˜æ€§èƒ½æ¶ˆæ¯é˜Ÿåˆ—æä¾›çš„å»¶è¿Ÿé˜Ÿåˆ—æ¥å®ç°ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Vite å¤šé¡µé¢å®æˆ˜]]></title>
        <id>https://hualiang.online/post/zhen-zheng-you-ya-de-vite-duo-ye-mian-shi-zhan/</id>
        <link href="https://hualiang.online/post/zhen-zheng-you-ya-de-vite-duo-ye-mian-shi-zhan/">
        </link>
        <updated>2024-06-01T07:58:44.000Z</updated>
        <summary type="html"><![CDATA[<p>è½¬è‡ªç¨€åœŸæ˜é‡‘ â€œ<a href="https://juejin.cn/user/1099167356957885/posts">æˆ‘æƒ³å†™æ–‡ç« å•Š</a>â€ çš„<a href="https://juejin.cn/post/7128999848564981796">ã€ŠçœŸæ­£ä¼˜é›…çš„ Vite å¤šé¡µé¢å®æˆ˜ã€‹</a></p>
]]></summary>
        <content type="html"><![CDATA[<p>è½¬è‡ªç¨€åœŸæ˜é‡‘ â€œ<a href="https://juejin.cn/user/1099167356957885/posts">æˆ‘æƒ³å†™æ–‡ç« å•Š</a>â€ çš„<a href="https://juejin.cn/post/7128999848564981796">ã€ŠçœŸæ­£ä¼˜é›…çš„ Vite å¤šé¡µé¢å®æˆ˜ã€‹</a></p>
<!-- more -->
<h1 id="viteå¦‚ä½•æ”¯æŒå¤šé¡µ">Viteå¦‚ä½•æ”¯æŒå¤šé¡µï¼Ÿ</h1>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vitejs.dev%2Fguide%2Fbuild.html%23multi-page-app">cn.vitejs.dev/guide/buildâ€¦</a></p>
<p>å®˜æ–¹æ–‡æ¡£å¯¹äºå¤šé¡µæ¨¡å¼çš„æè¿°ä¸­è¯´åˆ°ï¼Œå¦‚æœæƒ³è¦æ–°å»ºä¸€ä¸ªå•é¡µï¼Œåªéœ€è¦åœ¨<strong>é¡¹ç›®æ ¹ç›®å½•</strong>ï¼ˆæ³¨æ„ï¼šä¸æ˜¯ <code>src</code> ç›®å½•ï¼ï¼‰æ–°å»ºï¼š</p>
<ul>
<li>nested
<ul>
<li><strong>index.html</strong></li>
<li><strong>main.js</strong></li>
</ul>
</li>
<li>package.json</li>
<li>vite.config.js</li>
</ul>
<p>ç„¶åé€šè¿‡è®¿é—®ï¼š<code>http://localhost:5173/nested/</code>å³å¯ã€‚</p>
<p>è¿™é‡Œè¦è¯´æ˜ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<p><em>ä¸ºä»€ä¹ˆåœ¨æ ¹ç›®å½•æ–°å»ºç›®å½•ï¼Œè€Œä¸æ˜¯ <code>src</code> ç›®å½•ï¼Ÿ</em></p>
<p>å› ä¸ºviteå¯åŠ¨æ—¶ï¼Œä¼šä»¥æ ¹ç›®å½•å¯åŠ¨ä¸€ä¸ªå¼€å‘æœåŠ¡å™¨ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºå¼€å‘æœåŠ¡å™¨æ‰˜ç®¡äº†æ•´ä¸ªé¡¹ç›®çš„æ–‡ä»¶ï¼ˆä½†å…¶å®å†…éƒ¨åšäº†ä¸€äº›å…¶ä»–å¤„ç†å¦‚å¤„ç†publicç›®å½•ç­‰ï¼‰ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨é¡¹ç›®ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œéƒ½å¯ä»¥é€šè¿‡é“¾æ¥è®¿é—®åˆ°ï¼Œä½ å¯ä»¥è®¿é—®<code>http://localhost:5173/package.json</code> è¯•è¯•ã€‚</p>
<p>æ‰€ä»¥ï¼Œä½ å¯ä»¥åœ¨ä»»æ„ç›®å½•æ”¾ç½®è‡ªå·±çš„å•é¡µï¼Œä½†æ˜¯å¼€å‘æ—¶çš„è®¿é—®åœ°å€ä¹Ÿå¿…é¡»å—é™äºå•é¡µçš„ç›®å½•ç»“æ„ï¼Œå¦‚æœä½ çš„å•é¡µå…¥å£æ–‡ä»¶æ”¾åœ¨<code>src/hello/index.html</code> ï¼Œä¹Ÿå°±åªèƒ½é€šè¿‡<code>http://localhost:5173/src/hello/</code> æ¥è¿›è¡Œè®¿é—®ã€‚</p>
<p><em>ä¸ºä»€ä¹ˆä½¿ç”¨ <code>/nested/</code> è®¿é—®è€Œä¸æ˜¯ <code>nested</code>ï¼Ÿ</em></p>
<p>è®¿é—®<code>/nested/</code> ç›¸å½“äºè®¿é—®<code>nested</code>ç›®å½•ä¸‹çš„å…¥å£æ–‡ä»¶ï¼ˆä¸€èˆ¬é™æ€æœåŠ¡å™¨éƒ½ä¼šå°† <code>index.html</code> ä½œä¸ºå…¥å£æ–‡ä»¶ï¼‰ã€‚</p>
<h1 id="å®˜æ–¹ä¾‹å­ä¸ç¬¦åˆå®é™…å¼€å‘åœºæ™¯">å®˜æ–¹ä¾‹å­ä¸ç¬¦åˆå®é™…å¼€å‘åœºæ™¯</h1>
<p>viteå®˜æ–¹ç»™å‡ºçš„é¡¹ç›®æ¨¡æ¿æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>src
<ul>
<li>main.js</li>
<li>App.vue</li>
</ul>
</li>
<li>index.html</li>
<li>package.json</li>
<li>vite.config.js</li>
</ul>
<p>æŒ‰ç…§å®˜æ–¹ä¾‹å­ï¼Œå¦‚æœè¦æ–°å¢ä¸€ä¸ªå•é¡µï¼Œéœ€è¦è¿™æ ·ç»„ç»‡ç›®å½•ç»“æ„ï¼š</p>
<ul>
<li>src
<ul>
<li>main.js</li>
<li>App.vue</li>
</ul>
</li>
<li>nested
<ul>
<li>index.html</li>
</ul>
</li>
<li>index.html</li>
<li>package.json</li>
<li>vite.config.js</li>
</ul>
<p>æ–°çš„å•é¡µå±…ç„¶ä¸<code>src</code> ç›®å½•æ˜¯å¹³è¡Œçš„ï¼è¿™æ˜¾ç„¶ä¸ç¬¦åˆæ­£å¸¸çš„é¡¹ç›®ç»“æ„ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œå¼€å‘ç›¸å…³çš„æºä»£ç éƒ½ä¼šæ”¾åœ¨<code>src</code>ç›®å½•ä¸‹ã€‚å› æ­¤ï¼Œè¿™ä¸ªæ–¹æ¡ˆä¸é€‚ç”¨ï¼ŒåºŸå¼ƒã€‚</p>
<p>é‚£ä¹ˆï¼Œè¯•è¯•çœ‹ç¬¬äºŒç§æ–¹æ¡ˆï¼š</p>
<ul>
<li>index
<ul>
<li>index.html</li>
<li>main.js</li>
<li>App.vue</li>
</ul>
</li>
<li>nested
<ul>
<li>index.html</li>
<li>main.js</li>
<li>App.vue</li>
</ul>
</li>
<li>package.json</li>
<li>vite.config.js</li>
</ul>
<p>è¿™ç§æ–¹æ¡ˆçš„å¥½å¤„æ˜¯ï¼Œå•é¡µäº’ä¸ºå¹³è¡Œå…³ç³»ï¼Œè€Œä¸”å¯ä»¥é€šè¿‡è®¿é—®<code>/index/</code>ä¸<code>/nested/</code>è®¿é—®åˆ°å¯¹åº”çš„å•é¡µã€‚</p>
<p>ä½†æ˜¯ï¼Œå…¶ç¼ºç‚¹å°±æ˜¯ï¼šå¦‚ä½•ç®¡ç†å…¬å…±èµ„æºï¼Ÿ</p>
<p>ä¾‹å¦‚ï¼Œ<code>index</code> å•é¡µä¸<code>nested</code>å•é¡µéƒ½ä½¿ç”¨åˆ°åŒä¸€æ¬¾å…¬å…±ç»„ä»¶ï¼Œåº”è¯¥æ”¾åœ¨å“ªé‡Œç®¡ç†å‘¢ï¼Ÿ</p>
<p>æ˜¾ç„¶ï¼Œè¿™ç§é¡¹ç›®ç»“æ„ç¼ºé™·æ˜æ˜¾ï¼Œå› æ­¤ï¼Œè¿™ä¸ªæ–¹æ¡ˆä¹Ÿä¸é€‚ç”¨ï¼ŒåºŸå¼ƒã€‚</p>
<h1 id="é¡¹ç›®ç»“æ„æœ€ä½³å®è·µ">é¡¹ç›®ç»“æ„æœ€ä½³å®è·µ</h1>
<p>æŒ‰ç…§ä»¥å¾€çš„å¼€å‘ç»éªŒï¼Œè¿™æ ·ç»„ç»‡é¡¹ç›®ç»“æ„å¯ä»¥è®©å¼€å‘çš„å¯æ‰©å±•è¾¾åˆ°æœ€å¥½ï¼š</p>
<ul>
<li>src
<ul>
<li>components</li>
<li>pages
<ul>
<li>index
<ul>
<li>index.html</li>
<li>main.js</li>
<li>App.vue</li>
</ul>
</li>
<li>nested
<ul>
<li>index.html</li>
<li>main.js</li>
<li>App.vue</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>package.json</li>
<li>vite.config.js</li>
</ul>
<p>è¿™ç§é¡¹ç›®ç»“æ„ï¼Œå¯ä»¥åœ¨<code>src</code>ç›®å½•ä¸‹ç®¡ç†å¤šä¸ªå•é¡µéœ€è¦ä½¿ç”¨åˆ°çš„å…¬å…±èµ„æºï¼Œå¼•ç”¨éå¸¸æ–¹ä¾¿ï¼Œå¹¶ä¸”æ‰©å±•æ–°çš„å•é¡µä¹Ÿéå¸¸æ–¹ä¾¿ã€‚</p>
<p>ä½†æ˜¯ï¼è¿™ç§ç»“æ„ä¸‹ï¼Œè®¿é—®å¯¹åº”çš„å•é¡µéœ€è¦ä½¿ç”¨<code>http://localhost:5173/src/pages/index/</code> æ¥è®¿é—®ï¼Œè¿™ç§å¼€å‘ä½“éªŒè™½è¯´ä¸å¥½ï¼Œä½†å°šä¸”èƒ½å¿å—ã€‚æœ€è‡´å‘½çš„é—®é¢˜æ˜¯ï¼Œå½“æˆ‘ä»¬åœ¨<code>vite.config.js</code>ä¸­é…ç½®å¤šé¡µæ‰“åŒ…æ—¶ï¼š</p>
<pre><code class="language-typescript">export default defineConfig({
  build: {
    rollupOptions: {
      input: {
        index: path.resolve(__dirname, 'src/pages/index/index.html'),
        nested: path.resolve(__dirname, 'src/pages/nested/index.html'),
      }
    }
  }
})
</code></pre>
<p>æ‰“å‡ºæ¥çš„åŒ…æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>dist
<ul>
<li>src
<ul>
<li>pages
<ul>
<li>index
<ul>
<li>index.html</li>
</ul>
</li>
<li>nested
<ul>
<li>index.html</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>assets</li>
</ul>
</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ä¸Šç”¨äºä¹Ÿå¿…é¡»é€šè¿‡<code>http://localhost/src/pages/index/</code> æ¥è®¿é—®ï¼è¿™æ˜¾ç„¶ä¸ç¬¦åˆé¢„æœŸï¼Œæˆ‘ä»¬é¢„æœŸçš„è¾“å‡ºåº”è¯¥æ˜¯ï¼š</p>
<ul>
<li>dist
<ul>
<li>assets</li>
<li>index.html</li>
<li>nested.html</li>
</ul>
</li>
</ul>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç½‘ä¸Šçš„ä¸€ç¯‡çƒ­é—¨æ–‡ç« ï¼Œé‡‡ç”¨äº†ä¸€ç§æ›´æ”¹æ‰“åŒ…åçš„æ–‡ä»¶è·¯å¾„çš„æ–¹æ³•æ¥è§£å†³æ­¤é—®é¢˜ï¼Œæ­¤æ–¹æ¡ˆçš„åŸºæœ¬æ€è·¯æ˜¯ï¼š</p>
<ol>
<li>å°†<code>src/pages</code>ä¸‹æ‰€æœ‰å­ç›®å½•ä¸‹çš„<code>index.html</code>æ–‡ä»¶å¤åˆ¶åˆ°æ ¹ç›®å½•ï¼Œå¹¶ä¸”æ”¹åä¸ºå…¶çˆ¶ç›®å½•çš„åç§°ï¼Œå¦‚<code>src/pages/nested/index.html</code>å¤åˆ¶åˆ°è·Ÿç›®å½•ï¼Œæ”¹åä¸º<code>nested.html</code></li>
<li>å°†<code>nested.html</code> ä¸‹çš„æ ·å¼ã€jsç­‰å¼•ç”¨æ”¹ä¸ºæ­£ç¡®çš„å¼•ç”¨è·¯å¾„ã€‚</li>
</ol>
<p>è¿™ä¸ªæ–¹æ¡ˆçœ‹ä¼¼è§£å†³äº†æ‰“åŒ…åçš„è·¯å¾„é—®é¢˜ï¼Œä½†æ˜¯ç»™å¼€å‘äººå‘˜å¸¦æ¥äº†é¢å¤–çš„è®¤çŸ¥æˆæœ¬ï¼Œè™½å‹‰å¼ºè§£å†³äº†é—®é¢˜ï¼Œä½†æ€è·¯ä¸å¤Ÿä¼˜é›…ã€‚ï¼ˆå±…ç„¶æ˜¯googleæœç´¢â€œvite å¤šé¡µé¢â€çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œæœ‰ç‚¹è¯¯äººå­å¼Ÿäº†ã€‚ï¼‰</p>
<h1 id="ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆ">ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆ</h1>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬çš„é¡¹ç›®ç»“æ„å¿…é¡»ä»¥æ­¤ä¸ºå‡†ï¼š</p>
<ul>
<li>src
<ul>
<li>pages
<ul>
<li>index</li>
<li>nested</li>
</ul>
</li>
</ul>
</li>
<li>package.json</li>
<li>vite.config.js</li>
</ul>
<p>å…¶æ¬¡ï¼Œæ‰“åŒ…å‡ºæ¥çš„ç»“æ„å¿…é¡»ä»¥æ­¤ä¸ºå‡†ï¼š</p>
<ul>
<li>dist
<ul>
<li>assets</li>
<li>index.html</li>
<li>nested.html</li>
</ul>
</li>
</ul>
<p>ä¸ºäº†å®ç°ç¬¬äºŒç‚¹ï¼Œå¿…é¡»è¦æ±‚é¡¹ç›®æ ¹ç›®å½•ä¸‹è‡³å°‘æœ‰è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>
<ul>
<li>src</li>
<li>index.html</li>
<li>nested.html</li>
<li>package.json</li>
<li>vite.config.js</li>
</ul>
<p>ç„¶åï¼Œåœ¨<code>src/pages/index</code>ç›®å½•ä¸‹ï¼Œä¸æ”¾ç½®<code>index.html</code>ï¼Œåªæ”¾<code>main.js</code>ã€<code>App.vue</code>ç­‰ï¼Œè®©<code>src/index.html</code> åå‘å¼•ç”¨<code>src/pages/index/main.js</code>å³å¯ï¼š</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;link rel=&quot;icon&quot; type=&quot;image/svg+xml&quot; href=&quot;/vite.svg&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
    &lt;title&gt;Vite + Vue + TS&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;
    &lt;script type=&quot;module&quot; src=&quot;/src/pages/index/main.js&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>è‡³æ­¤ï¼Œviteå¤šé¡µé¢æ¶æ„çš„é—®é¢˜å·²å®Œç¾è§£å†³ï¼</p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<ul>
<li>å®˜æ–¹æ–‡æ¡£è™½ç„¶æƒå¨ï¼Œä½†ä¸ä¸€å®šé€‚åˆæ‰€æœ‰åœºæ™¯</li>
<li>åœ¨æ¡†æ¶å†…è§£å†³é—®é¢˜ï¼Œå‹‰å¼ºçš„æ–¹æ¡ˆè™½èƒ½è§£å†³é—®é¢˜ï¼Œä½†åæ‚£æ— ç©·</li>
</ul>
]]></content>
    </entry>
</feed>
<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>è®°ä¸€æ¬¡å¯¹ DataX å‘ ES åŒæ­¥å¯¹è±¡å‹æ•°æ®çš„æ¢ç´¢è¿‡ç¨‹ | Hualiang&#39;s Blog</title>
<link rel="shortcut icon" href="https://hualiang.online/favicon.ico?v=1762159937976">
<link href="https://cdn.staticfile.net/remixicon/2.3.0/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://hualiang.online/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="è®°ä¸€æ¬¡å¯¹ DataX å‘ ES åŒæ­¥å¯¹è±¡å‹æ•°æ®çš„æ¢ç´¢è¿‡ç¨‹ | Hualiang&#39;s Blog - Atom Feed" href="https://hualiang.online/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="ä»Šå¤©å¼€å®Œäº§å“å®¡è®®ä¼šï¼ŒLeader è¡¨ç¤ºè®©æˆ‘æ¥è´Ÿè´£å·¥ä½œå°æ¨¡å—è‡ªå®šä¹‰åœ°ç†æŸ¥è¯¢çš„åŠŸèƒ½å¼€å‘æ—¶ï¼Œå·²ç»å­¦å®Œ ES çš„åœ°ç†æŸ¥è¯¢çš„æˆ‘å½“å³è¡¨ç¤ºè«å¾—é—®é¢˜ğŸ‘Œã€‚å¯å°±åœ¨æˆ‘æƒ³å…ˆåŒæ­¥åæ ‡åœ¨å†™ä¸šåŠ¡ä»£ç æ—¶æ‰å‘ç°ï¼Œâ€œè¿™ä¸ª DataX æ€ä¹ˆåŒæ­¥å¯¹è±¡å‹æ•°æ®å˜ï¼Ÿâ€ğŸ¤”

ä»‹ç»
D..." />
    <meta name="keywords" content="ElasticSearch,Other" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://hualiang.online">
  <img class="avatar" src="https://hualiang.online/images/avatar.png?v=1762159937976" alt="">
  </a>
  <h1 class="site-title">
    Hualiang&#39;s Blog
  </h1>
  <p class="site-description">
    <i>Unless I don't want to win, nobody can make me lose.</i><br/><br/>I always believe å¤©é“é…¬å‹¤
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
  </div>
  <div class="social-container">
    
      
        <a href="https://github.com/hualiong" target="_blank">
          <i class="ri-github-line"></i>
        </a>
      
    
      
        <a href="https://twitter.com/huoliong" target="_blank">
          <i class="ri-twitter-line"></i>
        </a>
      
    
      
        <a href="https://weibo.com" target="_blank">
          <i class="ri-weibo-line"></i>
        </a>
      
    
      
        <a href="https://zhuanlan.zhihu.com" target="_blank">
          <i class="ri-zhihu-line"></i>
        </a>
      
    
      
        <a href="https://www.facebook.com" target="_blank">
          <i class="ri-facebook-line"></i>
        </a>
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              è®°ä¸€æ¬¡å¯¹ DataX å‘ ES åŒæ­¥å¯¹è±¡å‹æ•°æ®çš„æ¢ç´¢è¿‡ç¨‹
            </h2>
            <div class="post-info">
              <span>
                2024-08-12
              </span>
              <span>
                8 min read
              </span>
              
                <a href="https://hualiang.online/tag/UXX0ydlwT/" class="post-tag">
                  # ElasticSearch
                </a>
              
                <a href="https://hualiang.online/tag/sGT3DdeWp/" class="post-tag">
                  # Other
                </a>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content" v-pre>
                <p>ä»Šå¤©å¼€å®Œäº§å“å®¡è®®ä¼šï¼ŒLeader è¡¨ç¤ºè®©æˆ‘æ¥è´Ÿè´£å·¥ä½œå°æ¨¡å—è‡ªå®šä¹‰åœ°ç†æŸ¥è¯¢çš„åŠŸèƒ½å¼€å‘æ—¶ï¼Œå·²ç»å­¦å®Œ ES çš„åœ°ç†æŸ¥è¯¢çš„æˆ‘å½“å³è¡¨ç¤ºè«å¾—é—®é¢˜ğŸ‘Œã€‚å¯å°±åœ¨æˆ‘æƒ³å…ˆåŒæ­¥åæ ‡åœ¨å†™ä¸šåŠ¡ä»£ç æ—¶æ‰å‘ç°ï¼Œâ€œè¿™ä¸ª DataX æ€ä¹ˆåŒæ­¥å¯¹è±¡å‹æ•°æ®å˜ï¼Ÿâ€ğŸ¤”</p>
<!-- more -->
<h1 id="ä»‹ç»">ä»‹ç»</h1>
<p>DataX æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€ä¸ªå¼‚æ„æ•°æ®æºç¦»çº¿åŒæ­¥å·¥å…·ï¼Œè‡´åŠ›äºå®ç°åŒ…æ‹¬å…³ç³»å‹æ•°æ®åº“(MySQLã€Oracleç­‰)ã€HDFSã€Hiveã€ODPSã€HBaseã€FTPç­‰å„ç§å¼‚æ„æ•°æ®æºä¹‹é—´ç¨³å®šé«˜æ•ˆçš„æ•°æ®åŒæ­¥åŠŸèƒ½ã€‚ä½¿ç”¨æ’ä»¶å¢å¼ºåŠŸèƒ½ï¼Œè¿™é‡Œæˆ‘éœ€è¦ä» MySQL åŒæ­¥æ•°æ®åˆ° ESï¼Œå°±è¦ç”¨åˆ° MySQL çš„è¾“å…¥ç«¯æ’ä»¶å’Œ ES çš„è¾“å‡ºç«¯æ’ä»¶ã€‚</p>
<h1 id="ç”¨æ³•">ç”¨æ³•</h1>
<p>è¿™é‡Œæ¼”ç¤ºä» MySQL åŒæ­¥åˆ° ESï¼ŒDataX çš„åŒæ­¥å¾ˆç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªé…ç½®è„šæœ¬å¹¶è¿è¡Œä¸‹é¢åœ°å‘½ä»¤å³å¯</p>
<pre><code>python /datax/bin/datax.py job.json
</code></pre>
<p>DataX å°±ä¼šè‡ªåŠ¨æŒ‰ç…§é…ç½®æ–‡ä»¶é‡Œçš„ä¿¡æ¯è¿æ¥å¯¹åº”æœåŠ¡è·å–å’ŒåŒæ­¥æ•°æ®ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-json">// job.json
{
  &quot;job&quot;: {
    &quot;setting&quot;: {
      &quot;speed&quot;: {
        &quot;channel&quot;: 2
      }
    },
    &quot;content&quot;: [
      {
        &quot;reader&quot;: {
          &quot;name&quot;: &quot;mysqlreader&quot;,
          &quot;parameter&quot;: {
            &quot;username&quot;: &quot;root&quot;,
            &quot;password&quot;: &quot;123456&quot;,
            &quot;connection&quot;: [
              {
                &quot;querySql&quot;: [&quot;select * from user_t&quot;],
                &quot;jdbcUrl&quot;: [&quot;jdbc:mysql://127.0.0.1:3306/db_user&quot;]
              }
            ]
          }
        },
        &quot;writer&quot;: {
          &quot;name&quot;: &quot;elasticsearchwriter&quot;,
          &quot;parameter&quot;: {
            &quot;endpoint&quot;: &quot;http://127.0.0.1:9200&quot;,
            &quot;accessId&quot;: &quot;elastic&quot;,
            &quot;accessKey&quot;: &quot;123456&quot;,
            &quot;index&quot;: &quot;user&quot;,
            &quot;column&quot;: [
              { &quot;name&quot;: &quot;pk&quot;, &quot;type&quot;: &quot;id&quot; },
              { &quot;name&quot;: &quot;col_ip&quot;, &quot;type&quot;: &quot;ip&quot; },
              { &quot;name&quot;: &quot;col_double&quot;, &quot;type&quot;: &quot;double&quot; },
              { &quot;name&quot;: &quot;col_long&quot;, &quot;type&quot;: &quot;long&quot; },
              { &quot;name&quot;: &quot;col_integer&quot;, &quot;type&quot;: &quot;integer&quot; },
              { &quot;name&quot;: &quot;col_keyword&quot;, &quot;type&quot;: &quot;keyword&quot; },
              { &quot;name&quot;: &quot;col_text&quot;, &quot;type&quot;: &quot;text&quot;, &quot;analyzer&quot;: &quot;ik_max_word&quot; },
              { &quot;name&quot;: &quot;col_geo_point&quot;, &quot;type&quot;: &quot;geo_point&quot; },
              { &quot;name&quot;: &quot;col_date&quot;, &quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;yyyy-MM-dd HH:mm:ss&quot; },
              { &quot;name&quot;: &quot;col_nested1&quot;, &quot;type&quot;: &quot;nested&quot; },
              { &quot;name&quot;: &quot;col_nested2&quot;, &quot;type&quot;: &quot;nested&quot; },
              { &quot;name&quot;: &quot;col_object1&quot;, &quot;type&quot;: &quot;object&quot; },
              { &quot;name&quot;: &quot;col_object2&quot;, &quot;type&quot;: &quot;object&quot; },
              { &quot;name&quot;: &quot;col_integer_array&quot;, &quot;type&quot;: &quot;integer&quot;, &quot;array&quot;: true },
              { &quot;name&quot;: &quot;col_geo_shape&quot;, &quot;type&quot;: &quot;geo_shape&quot;, &quot;tree&quot;: &quot;quadtree&quot;, &quot;precision&quot;: &quot;10m&quot; }
            ]
          }
        }
      }
    ]
  }
}
</code></pre>
<h1 id="é—®é¢˜">é—®é¢˜</h1>
<p>çœ‹èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿå¦‚æœåªæ˜¯é’ˆå¯¹æ™®é€šå­—ç¬¦ä¸²ï¼Œæ•°å­—ï¼Œæˆ–æ˜¯æ—¥æœŸå­—æ®µï¼Œé‚£ç¡®å®æ²¡å•¥é—®é¢˜ï¼Œé€šè¿‡ SQL è¯­å¥ éƒ½èƒ½æ­£ç¡®åœ°æŸ¥å‡ºå¹¶åŒæ­¥ã€‚ä½†é—®é¢˜å°±å‡ºåœ¨æœ€åä¸€ä¸ªå­—æ®µ <code>col_geo_shape</code>ï¼Œå®ƒçš„ç±»å‹æ˜¯ <code>geo_shape</code>ã€‚äº†è§£ ES çš„äººéƒ½çŸ¥é“ï¼Œè¿™æ˜¯ ES ç”¨äºåœ°ç†æŸ¥è¯¢çš„ä¸€ä¸ªé‡è¦ç±»å‹ï¼Œç”¨å®ƒæˆ‘ä»¬å¯ä»¥å®ç°åˆ¤æ–­åæ ‡å’Œåæ ‡ï¼Œåæ ‡å’ŒåŒºåŸŸä»¥åŠåŒºåŸŸå’ŒåŒºåŸŸä¹‹é—´çš„ç©ºé—´å…³ç³»ã€‚</p>
<p>ä½†é—®é¢˜æ˜¯ï¼Œåœ¨ ES ä¸­ï¼Œgeo_shape ç±»å‹çš„æ•°æ®é•¿ä¸‹é¢è¿™æ ·ï¼š</p>
<pre><code class="language-json">&quot;col_geo_shape&quot;: {
    &quot;type&quot;: &quot;point&quot;,
    &quot;coordinates&quot;: [
        108.374854,
        30.809156
    ]
}
</code></pre>
<p>æ²¡é”™ï¼Œå®ƒæ˜¯ä¸€ä¸ªéµå¾ª GeoJson æ ¼å¼çš„ Json å¯¹è±¡ï¼Œè¿™é‡Œçš„ç±»å‹é™¤äº† <code>point</code> å¤–ï¼Œè¿˜æœ‰ <code>circle</code>ï¼Œ<code>envelope</code>ï¼Œ<code>polygon</code> ç­‰ç­‰</p>
<p>å¯¹äº SQL è¯­å¥çš„æŸ¥è¯¢ç»“æœï¼Œæˆ‘ä»¬éƒ½çŸ¥é“æ˜¯ä¸€ä¸ªä¸ªå­—æ®µï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬éƒ½å¯ä»¥ä½œä¸ºå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯å¯¹åº” ES çš„ <code>keyword</code> æˆ– <code>text</code> ç±»å‹ã€‚ä½† SQL å¦‚ä½•æŸ¥å‡ºä¸€ä¸ªå¯¹è±¡ï¼Ÿ</p>
<p>æˆ‘ç›¸ä¿¡åˆ°å¤šæ•°äººçš„ç¬¬ä¸€ååº”æ‹¼å‡ºæ¥ä¸€ä¸ª json ä¸²ã€‚å¦‚æœä½ æƒ³åˆ°äº†ï¼Œé‚£ä¹ˆæ­å–œä½ ç­”å¯¹äº†ï¼å¯æƒœçš„æ˜¯ï¼Œå½“æ—¶çš„æˆ‘å¹¶æ²¡æœ‰é‚£ä¹ˆèªæ˜ï¼Œå†åŠ ä¸Šæ¯ä¸€æ¬¡æµ‹è¯•åŒæ­¥æ•°æ®éƒ½è¦ç­‰å¾ˆé•¿çš„æ—¶é—´ï¼Œæˆ‘å¯ä¸æƒ³ä¸ºäº†ä¸€ä¸ªçŒœæµ‹å»å†’è¿™ä¹ˆå¤§çš„æ—¶é—´æˆæœ¬ï¼ˆå…¶å®å°±æ˜¯æƒ³è¿½æ±‚ä¸€æ¬¡é€šè¿‡ï¼‰</p>
<p>äºæ˜¯ï¼Œæ¼«é•¿çš„æ¢ç´¢è¿‡ç¨‹å°±å¼€å§‹äº†......</p>
<h1 id="æ¢ç´¢">æ¢ç´¢</h1>
<p>åŸæœ¬æˆ‘ä»¥ä¸ºè¿™æ ·ä¸€ä¸ªå°é—®é¢˜ï¼Œå¹¿å¤§ç½‘å‹åº”è¯¥å·²ç»è¸©è¿‡å‘äº†ï¼Œå¤§ä¸äº†å®˜æ–¹æ–‡æ¡£åº”è¯¥æœ‰å†™æ€ä¹ˆç”¨å§ã€‚</p>
<p>ä½†ç›´åˆ°æˆ‘æœç´¢äº†æ— æ•°æ¬¡ï¼Œå°±æ˜¯æ²¡æœ‰æ‰¾åˆ°å‘ ES åŒæ­¥å¯¹è±¡å‹æ•°æ®çš„å…·ä½“ç¤ºä¾‹ã€‚å¤§éƒ¨åˆ†éƒ½æ˜¯åœ¨åŒæ­¥æ™®é€šç±»å‹ï¼Œå¦‚ï¼š<code>integer</code>ï¼Œ<code>date</code>ï¼Œ<code>keyword</code>ï¼Œ<code>long</code> ç­‰ç­‰ã€‚è¿˜æœ‰ä¸€äº›ä»‹ç»ä¹Ÿåªæ˜¯æäº†ä¸€å˜´èƒ½åŒæ­¥ <code>geo_shape</code> ç±»å‹ï¼Œä½†å´ä¾ç„¶æ²¡æœ‰ç»™å‡ºå…·ä½“çš„ç¤ºä¾‹ã€‚</p>
<p>è¿™æ—¶ï¼Œæˆ‘æƒ³åˆ°ï¼Œæ—¢ç„¶å®˜æ–¹æœ‰æä¾›è¿™æ ·ä¸€ä¸ªç±»å‹ï¼Œé‚£ä¹ˆä¸€å®šæœ‰åŒæ­¥å®ƒçš„åŠæ³•ã€‚æ‰€ä»¥æˆ‘å†³å®šå» GitHub æ‰¾æ‰¾<a href="https://github.com/alibaba/DataX/blob/master/elasticsearchwriter/doc/elasticsearchwriter.md">å®˜æ–¹æ–‡æ¡£</a>ã€‚ä»¤æˆ‘å¤§å¤±æ‰€æœ›çš„æ˜¯ï¼Œå®˜æ–¹ä»…æä¾›äº† ES è¾“å‡ºç«¯çš„é…ç½®ä¿¡æ¯ï¼Œæˆ‘ä»ä¸æ¸…æ¥š mysql åˆ°åº•æ€ä¹ˆåŒæ­¥å¯¹è±¡ç»™ ESã€‚</p>
<p>æœ€ç»ˆï¼Œæˆ‘å†³å®šçœ‹æºç ã€‚</p>
<h1 id="åˆ†æ">åˆ†æ</h1>
<p>ç»è¿‡ä¸€ç•ªå¯»æ‰¾ï¼Œæˆ‘æœ€ç»ˆæ‰¾åˆ°äº†ç›¸å…³çš„ä»£ç ï¼Œä½äº <a href="https://github.com/alibaba/DataX/blob/master/elasticsearchwriter/src/main/java/com/alibaba/datax/plugin/writer/elasticsearchwriter/ElasticSearchWriter.java#L301">ElasticSearchWriter.java</a> å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">// ElasticSearchWriter.java
switch (colType) {
    case STRING:
        // å…¼å®¹stringç±»å‹,ES5ä¹‹å‰ç‰ˆæœ¬
        break;
    case KEYWORD:
        // https://www.elastic.co/guide/en/elasticsearch/reference/current/tune-for-search-speed.html#_warm_up_global_ordinals
        field.put(&quot;eager_global_ordinals&quot;, jo.getBoolean(&quot;eager_global_ordinals&quot;));
        break;
    case TEXT:
        field.put(&quot;analyzer&quot;, jo.getString(&quot;analyzer&quot;));
        // ä¼˜åŒ–diskä½¿ç”¨,ä¹ŸåŒæ­¥ä¼šæé«˜indexæ€§èƒ½
        // https://www.elastic.co/guide/en/elasticsearch/reference/current/tune-for-disk-usage.html
        field.put(&quot;norms&quot;, jo.getBoolean(&quot;norms&quot;));
        field.put(&quot;index_options&quot;, jo.getBoolean(&quot;index_options&quot;));
        if(jo.getString(&quot;fields&quot;) != null) {
            field.put(&quot;fields&quot;, jo.getJSONObject(&quot;fields&quot;));
        }
        break;
    case DATE:
        if (Boolean.TRUE.equals(jo.getBoolean(&quot;origin&quot;))) {
            if (jo.getString(&quot;format&quot;) != null) {
                field.put(&quot;format&quot;, jo.getString(&quot;format&quot;));
            }
            // esåŸç”Ÿformatè¦†ç›–åŸå…ˆæ¥çš„format
            if (jo.getString(&quot;dstFormat&quot;) != null) {
                field.put(&quot;format&quot;, jo.getString(&quot;dstFormat&quot;));
            }
            if(jo.getBoolean(&quot;origin&quot;) != null) {
                columnItem.setOrigin(jo.getBoolean(&quot;origin&quot;));
            }
        } else {
            columnItem.setTimeZone(jo.getString(&quot;timezone&quot;));
            columnItem.setFormat(jo.getString(&quot;format&quot;));
        }
        break;
    case GEO_SHAPE:
        field.put(&quot;tree&quot;, jo.getString(&quot;tree&quot;));
        field.put(&quot;precision&quot;, jo.getString(&quot;precision&quot;));
        break;
    case OBJECT:
    case NESTED:
        if (jo.getString(&quot;dynamic&quot;) != null) {
            field.put(&quot;dynamic&quot;, jo.getString(&quot;dynamic&quot;));
        }
        break;
    default:
        break;
}
if (jo.containsKey(&quot;other_params&quot;)) {
    field.putAll(jo.getJSONObject(&quot;other_params&quot;));
}
</code></pre>
<p>æ³¨æ„çœ‹æœ€åä¸€ä¸ª if è¯­å¥ï¼Œå®ƒä¼šå°†é™¤å›ºå®šé…ç½®å¤–çš„å…¶ä½™å‚æ•°å½“æˆ json ä¸²è¿›è¡Œååºåˆ—åŒ–ã€‚è¿™ä¹Ÿåå®äº†ï¼Œä½ åªéœ€è¦åœ¨ SQL è¯­å¥ä¸­é€šè¿‡ <code>CONCAT</code> ç­‰å­—ç¬¦ä¸²å‡½æ•°æ‹¼å‡ºä¸€ä¸ªå­—ç¬¦ä¸²å³å¯åŒæ­¥å¯¹è±¡å‹æ•°æ®ã€‚</p>
<h1 id="ç»“å°¾">ç»“å°¾</h1>
<p>æ€»ä¹‹ï¼Œè¿™ä»¶äº‹ç»™æˆ‘çš„å¯å‘å°±æ˜¯ï¼š<strong>åœ¨è¡ŒåŠ¨å‰ä¸€å®šè¦åšå¥½å¯è¡Œæ€§åˆ†æ</strong>ï¼Œå¦åˆ™åˆ°æ—¶å€™ä»£ç å†™ä¸€åŠå‘ç°æ–¹æ³•è¡Œä¸é€šï¼Œé‚£å°±ç™½å†™äº†ğŸ¤£</p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li><a href="#%E4%BB%8B%E7%BB%8D">ä»‹ç»</a></li>
<li><a href="#%E7%94%A8%E6%B3%95">ç”¨æ³•</a></li>
<li><a href="#%E9%97%AE%E9%A2%98">é—®é¢˜</a></li>
<li><a href="#%E6%8E%A2%E7%B4%A2">æ¢ç´¢</a></li>
<li><a href="#%E5%88%86%E6%9E%90">åˆ†æ</a></li>
<li><a href="#%E7%BB%93%E5%B0%BE">ç»“å°¾</a></li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://hualiang.online/post/ji-yi-ci-wrangler-cli-chuang-jian-cloudflare-worker-mo-ban-qi-dong-shi-bai-yuan-yin/">
              <h3 class="post-title">
                è®°ä¸€æ¬¡ Wrangler CLI åˆ›å»º Cloudflare Worker æ¨¡æ¿å¯åŠ¨å¤±è´¥åŸå› 
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by&nbsp;<a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://hualiang.online/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
